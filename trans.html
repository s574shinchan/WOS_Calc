<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>StatesTrans ë°°ê²½ìƒ‰ í¬í•¨</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2px;
      background: #f4f4f4;
    }
    .card {
      background: white;
      border-radius: 10px;
      padding: 12px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
    }
    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 12px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>ğŸ“Š ì´ë¯¼ì˜ˆìƒë²”ìœ„</h2>
    <div class="text-gray-700 text-sm text-center mb-4">
      <p>ê¸°ì¤€ì¼ìëŠ” ì´ë¯¼ì±„íŒ…ì´ ì—´ë¦¬ëŠ” ì‹œì ì¸ ì¼ìš”ì¼ì„ ê¸°ì ìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤.</p>
      <p>ì˜ˆë¥¼ ë“¤ì–´ ë³¸ì¸ì„œë²„ê°€ ê¸°ì¤€ì¼ìì— 6ì„¸ëŒ€ë¼ê³  ëª…ì‹œë˜ì–´ìˆëŠ” ê²½ìš°, í•´ë‹¹ ê¸°ì¤€ì¼ ë‹¤ìŒë‚ ì¸ ì›”ìš”ì¼ì— 6ì„¸ëŒ€ ì‹œì‘ì…ë‹ˆë‹¤.</p>
      <p>ê¸°ì¤€ì¼ì´ 7ì›”ì¸ê²½ìš° 8ì›”ì˜ˆì¸¡ ë°ì´í„°ëŠ” 7ì›” ì´ë¯¼ì¢…ë£Œ ì´í›„ì— ì—…ë°ì´íŠ¸ ë  ì˜ˆì •ì…ë‹ˆë‹¤.</p>
      <p>ë˜í•œ, 4ì£¼ì¸ì§€ 6ì£¼ì¸ì§€ ê¸°ì¤€ì´ ì¡íˆì§€ ì•Šì„ ê²½ìš°ì—ëŠ” ì—…ë°ì´íŠ¸ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      <p>í•´ë‹¹ ìë£ŒëŠ” ì°¸ê³ ìë£Œì…ë‹ˆë‹¤. 100% ì •í™•í•œ ìë£Œê°€ ì•„ë‹™ë‹ˆë‹¤.</p>
      <p>ì´ì „ê¹Œì§€ì˜ ì´ë¯¼ê·¸ë£¹ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì˜ˆì¸¡ì •ë³´ì´ë¯€ë¡œ 100% ì •í™•í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
    </div>
    <div id="sheet-table">â³ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    <div class="text-gray-700 text-sm text-center mb-4">
      <p>ì´ì›ƒì™•êµ­ ë²”ìœ„ê°€ ì˜ëª»ëœ ë¶€ë¶„ì´ ìˆë‹¤ë©´ ìš°ì¸¡ìƒë‹¨ ì˜¤í”ˆì¹´í†¡ìœ¼ë¡œ ì•Œë ¤ì£¼ì‹œë©´ ë°˜ì˜í•˜ê² ìŠµë‹ˆë‹¤.</p>
    </div>
  </div>

  <script>
    function sendHeightToParent() {
      const height = document.body.scrollHeight + 10;
      window.parent.postMessage({ type: "FRAME_CHANGE", height }, "*");
    }

    // í˜ì´ì§€ ìµœì´ˆ ë¡œë“œ ì‹œ
    window.addEventListener("load", () => {
      setTimeout(sendHeightToParent, 100); // ì•½ê°„ì˜ ë Œë”ë§ ëŒ€ê¸°
    });
    
    function loadPage(page) {
      const isMobile = window.innerWidth <= 768;
      const height = isMobile ? "550px" : "345px"
        window.location.href = page;
      window.parent.postMessage({ type: "SET_FRAME_SIZE", height: height, width: "100%"}, "*");
    }
  </script>

  <script>
    const API_KEY = "AIzaSyA4Ve1ViWoYIpzhHh45wjVjbk5bkEnEmUk";
    const SPREADSHEET_ID = "1a2j650rgwXEMR_sXRRpM2-L6o_b-uC7FdoixGi34oTw";
    const RANGE = "StatesTrans";

    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}?` +
      `includeGridData=true&ranges=${RANGE}` +
      `&fields=sheets.data.rowData.values(effectiveValue,effectiveFormat(backgroundColor,textFormat.foregroundColor),userEnteredFormat.backgroundColor),sheets.merges` +
      `&key=${API_KEY}`;

    // ìƒ‰ìƒ ë³€í™˜: { red: 0.5, green: 0.7, blue: 0.2 } â†’ rgb(128,179,51)
    function toRGB(color, fallback = "#ffffff") {
      if (!color) return fallback;
      const r = Math.round((color.red ?? 0) * 255);
      const g = Math.round((color.green ?? 0) * 255);
      const b = Math.round((color.blue ?? 0) * 255);
      return `rgb(${r},${g},${b})`;
    }

    fetch(url)
      .then(res => res.json())
      .then(data => {
        const sheet = data.sheets[0];
        const merges = sheet.merges || [];
        const rows = sheet.data[0].rowData || [];

        const mergeMap = {};
        const skip = new Set();
        for (const m of merges) {
          const key = `${m.startRowIndex},${m.startColumnIndex}`;
          mergeMap[key] = {
            rowspan: m.endRowIndex - m.startRowIndex,
            colspan: m.endColumnIndex - m.startColumnIndex
          };
          for (let r = m.startRowIndex; r < m.endRowIndex; r++) {
            for (let c = m.startColumnIndex; c < m.endColumnIndex; c++) {
              if (r !== m.startRowIndex || c !== m.startColumnIndex) {
                skip.add(`${r},${c}`);
              }
            }
          }
        }

        let html = "<table><tbody>";
        rows.forEach((row, ri) => {
          html += "<tr>";
          const cells = row.values || [];
          cells.forEach((cell, ci) => {
            const key = `${ri},${ci}`;
            if (skip.has(key)) return;

            const val = cell?.effectiveValue;
            const text = val?.stringValue ?? val?.numberValue ?? val?.boolValue ?? "";

            const effectiveFmt = cell?.effectiveFormat ?? {};
            const userFmt = cell?.userEnteredFormat ?? {};
            const bg = toRGB(userFmt.backgroundColor, "#ffffff");
            const fg = toRGB(effectiveFmt.textFormat?.foregroundColor, "#000000");

            const span = mergeMap[key];
            const tag = `<td style="background:${bg}; color:${fg};"` +
              (span?.rowspan ? ` rowspan="${span.rowspan}"` : "") +
              (span?.colspan ? ` colspan="${span.colspan}"` : "") +
              `>${text}</td>`;
            html += tag;
          });
          html += "</tr>";
        });
        html += "</tbody></table>";

        document.getElementById("sheet-table").innerHTML = html;
        sendHeightToParent();
      })
      .catch(err => {
        console.error("API ì˜¤ë¥˜:", err);
        document.getElementById("sheet-table").innerText = "âŒ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
      });
  </script>
  <script>
    function setupLangSelect(id) {
      const el = document.getElementById(id);
      if (el) {
        el.addEventListener('change', function () {
          const langCode = this.value; // ì˜ˆ: index_en.html
          const lang = (langCode.split('_')[1]?.split('.')[0] || 'ko').toUpperCase();
          localStorage.setItem('lang', lang);
          window.location.href = langCode;
        });
      }
    }
  
    setupLangSelect('langSelectMobile');
    setupLangSelect('langSelectPC');
  </script>
</body>
</html>
