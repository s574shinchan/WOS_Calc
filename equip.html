
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì˜ì£¼ì¥ë¹„ ê³„ì‚°ê¸°</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6 font-sans">
  <div class="max-w-5xl mx-auto bg-white p-6 rounded shadow">
    <h2 class="text-2xl font-bold text-green-600 mb-4">ğŸ›¡ ì˜ì£¼ì¥ë¹„ ê³„ì‚°ê¸°</h2>
    <form id="equipForm" class="space-y-4">
      <table class="w-full table-auto border border-gray-300 text-center text-sm">
        <thead class="bg-green-100">
          <tr>
            <th class="border p-1">ì„ íƒ</th>
            <th class="border p-1">ì¥ë¹„</th>
            <th class="border p-1">í˜„ì¬ ë‹¨ê³„</th>
            <th class="border p-1">ëª©í‘œ ë‹¨ê³„</th>
          </tr>
        </thead>
        <tbody id="equipTableBody"></tbody>
      </table>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
        <div><label class="block font-semibold">ë³´ìœ  í•©ê¸ˆ</label><input type="number" id="own-í•©ê¸ˆ" class="w-full border rounded p-2" /></div>
        <div><label class="block font-semibold">ë³´ìœ  ê´‘íƒì œ</label><input type="number" id="own-ê´‘íƒì œ" class="w-full border rounded p-2" /></div>
        <div><label class="block font-semibold">ë³´ìœ  ì„¤ê³„ë„ë©´</label><input type="number" id="own-ì„¤ê³„ë„ë©´" class="w-full border rounded p-2" /></div>
        <div><label class="block font-semibold">ë³´ìœ  ë‹¬ë¹›ì•°ë²„</label><input type="number" id="own-ë‹¬ë¹›ì•°ë²„" class="w-full border rounded p-2" /></div>
      </div>
      <button type="button" onclick="calculateEquip()" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700">ê³„ì‚°í•˜ê¸°</button>
    </form>
    <div id="equipResult" class="mt-6"></div>
  </div>

<script>
const equipSheetID = "1vtW4diWsB4OoSK70nYa6ve1nRPHrhWg-rf76NlsRM08";
const equipSheetName = "ì˜ì£¼ì¥ë¹„ì¬ë£Œ";
const equipItems = ["ì¥ë¹„1", "ì¥ë¹„2", "ì¥ë¹„3", "ì¥ë¹„4", "ì¥ë¹„5", "ì¥ë¹„6"];
let equipStages = [], equipData = [];

async function loadEquipTable() {
  const url = `https://opensheet.elk.sh/${equipSheetID}/${equipSheetName}`;
  const res = await fetch(url);
  const data = await res.json();
  equipData = data;
  equipStages = data.map(r => r["ë‹¨ê³„"]);

  const tbody = document.getElementById("equipTableBody");
  equipItems.forEach((item, i) => {
    const options = equipStages.map(s => `<option value="${s}">${s}</option>`).join('');
    tbody.innerHTML += `
      <tr>
        <td class="border p-1"><input type="checkbox" id="equip-check-${i}" class="w-5 h-5 accent-green-500" /></td>
        <td class="border p-1">${item}</td>
        <td class="border p-1"><select id="equip-cur-${i}" class="border rounded p-1 text-sm">${options}</select></td>
        <td class="border p-1"><select id="equip-tgt-${i}" class="border rounded p-1 text-sm">${options}</select></td>
      </tr>
    `;
  });
}

async function calculateEquip() {
  let total = { í•©ê¸ˆ: 0, ê´‘íƒì œ: 0, ì„¤ê³„ë„ë©´: 0, ë‹¬ë¹›ì•°ë²„: 0 };
  const own = {
    í•©ê¸ˆ: parseFloat(document.getElementById("own-í•©ê¸ˆ").value) || 0,
    ê´‘íƒì œ: parseFloat(document.getElementById("own-ê´‘íƒì œ").value) || 0,
    ì„¤ê³„ë„ë©´: parseFloat(document.getElementById("own-ì„¤ê³„ë„ë©´").value) || 0,
    ë‹¬ë¹›ì•°ë²„: parseFloat(document.getElementById("own-ë‹¬ë¹›ì•°ë²„").value) || 0
  };

  let rows = "";

  for (let i = 0; i < equipItems.length; i++) {
    if (!document.getElementById(`equip-check-${i}`).checked) continue;

    const cur = document.getElementById(`equip-cur-${i}`).value;
    const tgt = document.getElementById(`equip-tgt-${i}`).value;
    const start = equipStages.indexOf(cur);
    const end = equipStages.indexOf(tgt);
    if (start === -1 || end === -1 || start >= end) {
      rows += `<tr><td class="border p-1 text-center text-red-600" colspan="6">âš ï¸ ${equipItems[i]}: ì˜ëª»ëœ ë‹¨ê³„ ì„ íƒ</td></tr>`;
      continue;
    }

    const subtotal = { í•©ê¸ˆ: 0, ê´‘íƒì œ: 0, ì„¤ê³„ë„ë©´: 0, ë‹¬ë¹›ì•°ë²„: 0 };
    for (let j = start + 1; j <= end; j++) {
      const row = equipData[j];
      subtotal.í•©ê¸ˆ += parseFloat(row["í•©ê¸ˆ"] || 0);
      subtotal.ê´‘íƒì œ += parseFloat(row["ê´‘íƒì œ"] || 0);
      subtotal.ì„¤ê³„ë„ë©´ += parseFloat(row["ì„¤ê³„ë„ë©´"] || 0);
      subtotal.ë‹¬ë¹›ì•°ë²„ += parseFloat(row["ë‹¬ë¹›ì•°ë²„"] || 0);
    }

    total.í•©ê¸ˆ += subtotal.í•©ê¸ˆ;
    total.ê´‘íƒì œ += subtotal.ê´‘íƒì œ;
    total.ì„¤ê³„ë„ë©´ += subtotal.ì„¤ê³„ë„ë©´;
    total.ë‹¬ë¹›ì•°ë²„ += subtotal.ë‹¬ë¹›ì•°ë²„;

    rows += `
      <tr class="text-center">
        <td class="border p-1">${equipItems[i]}</td>
        <td class="border p-1">${cur} â†’ ${tgt}</td>
        <td class="border p-1">${subtotal.í•©ê¸ˆ.toLocaleString()}</td>
        <td class="border p-1">${subtotal.ê´‘íƒì œ.toLocaleString()}</td>
        <td class="border p-1">${subtotal.ì„¤ê³„ë„ë©´.toLocaleString()}</td>
        <td class="border p-1">${subtotal.ë‹¬ë¹›ì•°ë²„.toLocaleString()}</td>
      </tr>
    `;
  }

  rows += `
    <tr class="text-center font-bold bg-green-100">
      <td colspan="2" class="border p-1">ì´í•©</td>
      <td class="border p-1">${total.í•©ê¸ˆ.toLocaleString()}</td>
      <td class="border p-1">${total.ê´‘íƒì œ.toLocaleString()}</td>
      <td class="border p-1">${total.ì„¤ê³„ë„ë©´.toLocaleString()}</td>
      <td class="border p-1">${total.ë‹¬ë¹›ì•°ë²„.toLocaleString()}</td>
    </tr>
    <tr class="text-center font-bold bg-red-50">
      <td colspan="2" class="border p-1">ê³¼ë¶€ì¡±</td>
      <td class="border p-1">${(own.í•©ê¸ˆ - total.í•©ê¸ˆ).toLocaleString()}</td>
      <td class="border p-1">${(own.ê´‘íƒì œ - total.ê´‘íƒì œ).toLocaleString()}</td>
      <td class="border p-1">${(own.ì„¤ê³„ë„ë©´ - total.ì„¤ê³„ë„ë©´).toLocaleString()}</td>
      <td class="border p-1">${(own.ë‹¬ë¹›ì•°ë²„ - total.ë‹¬ë¹›ì•°ë²„).toLocaleString()}</td>
    </tr>
  `;

  document.getElementById("equipResult").innerHTML = `
    <table class="w-full table-auto border border-gray-300 mt-4 text-sm text-center">
      <thead class="bg-gray-100">
        <tr>
          <th class="border p-1">ì¥ë¹„</th>
          <th class="border p-1">êµ¬ê°„</th>
          <th class="border p-1">í•©ê¸ˆ</th>
          <th class="border p-1">ê´‘íƒì œ</th>
          <th class="border p-1">ì„¤ê³„ë„ë©´</th>
          <th class="border p-1">ë‹¬ë¹›ì•°ë²„</th>
        </tr>
      </thead>
      <tbody>${rows}</tbody>
    </table>
  `;
}

loadEquipTable();
</script>

<script>
  document.addEventListener("contextmenu", event => event.preventDefault());
  document.addEventListener("keydown", function (e) {
    if (
      e.key === "F12" ||
      (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "J")) ||
      (e.ctrlKey && (e.key === "U" || e.key === "S"))
    ) {
      e.preventDefault();
    }
  });
</script>

</body>
</html>
