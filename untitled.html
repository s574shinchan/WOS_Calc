<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>세대별 영웅 특성</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --bg1:#003a88;
      --bg2:#6c85bd;
      --nav:#0a1634cc;
      --muted:#b9c7ff;
      --panel:#101c36f2;
      --panel2:#0f1a33f2;
      --shadow: 0 18px 40px rgba(0,0,0,.35);
      --r:14px;
    }
    *{box-sizing:border-box}
    
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;      
      background:
        radial-gradient(900px 420px at 25% 0%, #1a2f6a 0%, transparent 60%),
        linear-gradient(180deg, var(--bg2), var(--bg1));
      min-height:100vh;
    }
    
    /* ✅ 다크모드 전용 */
    body.dark-mode {
      background-image: none;
      background-color: #121212;
      color: #f0f0f0;
    }
    
    .title-grit{
      letter-spacing: .08em;
      text-shadow: 0 2px 0 rgba(0,0,0,.15);
    }
    .glass{
      background: rgba(255,255,255,.70);
      backdrop-filter: blur(6px);
    }
    
    .dark .glass{ background: rgba(15,15,15,.55); }
    .skill-chip{ font-variant-numeric: tabular-nums; }
    .dark-mode .bg-white { background-color: #2c2c2c !important; color: #f0f0f0 !important; }
    
    .dark-mode .bg-blue-300,
    .dark-mode .bg-gray-100 { background-color: #1e1e1e !important; }
  
    .dark-mode .text-gray-800,
    .dark-mode .text-gray-700,
    .dark-mode .text-gray-600 { color: #f0f0f0 !important; }
  
    .dark-mode .text-blue-700 { color: #66b0ff !important; }
    .dark-mode .text-blue-600 { color: #80caff !important; }
    .dark-mode .text-orange-500 { color: #ffa94d !important; }
    .dark-mode .text-green-600 { color: #79e68c !important; }
    .dark-mode .text-red-500 { color: #ff8080 !important; }
  
    .dark-mode table { background-color: #2c2c2c; color: #f0f0f0; }
    .dark-mode th, .dark-mode td { border-color: #444 !important; }
    .dark-mode thead th { color: #000 !important; }
    
    .dark-mode .bg-blue-100,
    .dark-mode .bg-blue-50,
    .dark-mode .bg-amber-100,
    .dark-mode .bg-orange-50,
    .dark-mode .bg-red-50,
    .dark-mode .bg-indigo-100 { background-color: #3a3a3a !important; color: #f0f0f0 !important; }
    
    .dark-mode .bg-amber-50,
    .dark-mode .bg-indigo-50 { background-color: #2d2d2d !important; }
    .dark-mode summary { background-color: #333 !important; color: #f0f0f0 !important; }
    .dark-mode ul li { color: #ddd; }
    .dark-mode .text-gray-500 { color: #9ca3af !important; }
    .dark-mode .card { background:#1f1f1f; border-color:#2a2a2a; }
    
    .dark-mode * { text-shadow: none !important; }
    /* 다크모드일 때 아이콘 */
    .dark-mode #DarkMode { color: #facc15; /* 노란색 (달 아이콘 강조) */ }
    
    .dark-mode #langSelectPC,
    .dark-mode #langSelectPC option,
    .dark-mode #langSelectPC:disabled {
      color: #f0f0f0 !important;
      background-color: #2c2c2c !important;
    }
    /* 다크모드에서 팝업 테이블 헤더 글자색을 검정으로 */
    body.dark-mode #popupContent th { color:#f0f0f0 !important; }
    
    /* 다크모드에서 총합/보유량/과부족 행 글자색을 검정으로 */
    body.dark-mode #popupContent tr.row-total  td,
    body.dark-mode #popupContent tr.row-owned  td,
    body.dark-mode #popupContent tr.row-deficit td { color:#f0f0f0 !important; }
    
    .topbar{
      color: #e8efff;
      position: sticky; top:0; z-index:50;
      padding: 10px 8px;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, var(--nav), transparent);
      border-bottom: 1px solid rgba(255,255,255,0.15);
    }
    .nav{
      max-width: none;
      margin-left: 0;
      padding-left: 8px;
      display:flex;
      align-items:center;
      gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-size: 1.6rem;
      font-weight: 900;
      letter-spacing: .2px;
      margin-right: 8px;
      user-select:none;
      white-space:nowrap;
    }
    .logo{
      width:34px; height:34px; border-radius: 12px;
      background: linear-gradient(135deg, #5fb3ff, #2a4fff);
      box-shadow: 0 10px 22px rgba(0,0,0,.35);
    }
    .navlist{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      margin-left: auto;
      padding-right: 8px;
    }
    .dd{ position: relative; }
    .dd-btn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 10px 14px;
      border-radius: 14px;
      border: 1px solid transparent;
      color: #e8efff;
      background: transparent;
      cursor:pointer;
      user-select:none;
      font-weight: 800;
      letter-spacing: .1px;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      outline: none;
      white-space:nowrap;
    }
    .dd-btn:hover{
      background: rgba(255,255,255,.07);
      transform: translateY(-1px);
    }
    .dd-btn:focus-visible{
      border-color: rgba(120,170,255,.65);
      box-shadow: 0 0 0 3px rgba(80,140,255,.25);
    }
    .dd.open .dd-btn{
      background: rgba(255,255,255,.09);
      border-color: rgba(120,170,255,.25);
    }
    .chev{
      width: 10px; height: 10px;
      border-right: 2px solid var(--muted);
      border-bottom: 2px solid var(--muted);
      transform: rotate(45deg);
      margin-top: -2px;
      transition: transform .12s ease;
    }
    .dd.open .chev{
      transform: rotate(225deg);
      margin-top: 2px;
    }
    .dd-menu{
      position:absolute;
      top: calc(100% + 10px);
      left: 0;
      min-width: 220px;
      padding: 10px;
      border-radius: var(--r);
      display:none;
      
      /* ✅ 하위메뉴 배경/테두리/그림자 */
      background: linear-gradient(180deg, var(--panel), var(--panel2));
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: var(--shadow);
    }
    .dd.open .dd-menu{ display:block; }
    .dd-item{
      display:block;
      padding: 12px 12px;
      border-radius: 12px;
      color: #e8efff;
      text-decoration:none;
      font-weight: 800;
      transition: background .12s ease;
    }
    .dd-item:hover, .dd-item:focus-visible{
      background: rgba(255,255,255,.07);
      outline: none;
    }
    
    .dd-item.active{
      background: rgba(255,255,255,.10);
      color: #57a8ff; /* 파란 글자 */
    }
    .dd-item.active::before{
      content:"";
      position:absolute;
      left: 6px;               /* 라인 위치 */
      top: 8px;
      bottom: 8px;
      width: 3px;
      border-radius: 999px;
      background: #57a8ff;     /* 파란 라인 */
    }
    
    .content{
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px 18px;
      color: rgba(232,239,255,.85);
      line-height: 1.6;
    }
    .card { 
      border:1px solid rgba(0,0,0,.1); 
      background:#fff; 
      box-shadow:0 2px 8px rgba(0,0,0,.06); 
      padding:10px 10px; 
    }

    /* ✅ 한 줄 유지 + 가로 스크롤 허용 */
    .row{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:nowrap;         /* 줄바꿈 금지 */
      white-space:nowrap;       /* 텍스트도 줄바꿈 금지 */
      overflow-x:auto;          /* 넘치면 가로 스크롤 */
      -webkit-overflow-scrolling: touch;
    }
    #hero-shard-strip{
      display:flex;
      align-items:center;
      flex-wrap:nowrap;         /* 줄바꿈 금지 */
      flex:0 0 auto;            /* 줄서기 고정 */
    }
    #hero-shard-strip img{
      width:32px; height:32px; object-fit:contain;
      flex:0 0 auto;            /* 아이콘 자체도 줄바꿈 방지 */
    }
    .dark-mode .input { width:110px; height:34px; border:1px solid #d0d5dd; border-radius:8px; padding:0 10px; outline:none; color: #121212; }
    .input { width:110px; height:34px; border:1px solid #d0d5dd; border-radius:8px; padding:0 10px; outline:none; }
    .btn   { height:34px; padding:0 14px; border:0; border-radius:8px; background:#2563eb; color:#fff; cursor:pointer; flex:0 0 auto; }
    
    
  </style>
  <script>
    /* 다크모드 유지 */
    window.addEventListener('DOMContentLoaded', () => {
      if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
      }
    });
  </script>
</head>

<body class="bg-gray-100 p-3 font-sans text-sm">
  <div class="max-w-[1500px] mx-auto bg-white p-4 rounded-xl shadow-md">
    <!-- 헤더 -->
    <div class="flex items-center justify-between gap-3 mb-4">
      <div>
        <h1 class="text-xl md:text-2xl font-extrabold">세대별 영웅 특성</h1>
        <p class="text-sm">영웅 클릭 → 이미지 스타일 상세 카드</p>
      </div>
    </div>

    <!-- 세대 탭 -->
    <div id="genTabs" class="flex flex-wrap gap-2 mb-4"></div>

    <!-- 영웅 카드 그리드 -->
    <div id="heroGrid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3"></div>
  </div>

  <!-- ====== 상세 모달 ====== -->
  <div id="modalBackdrop" class="fixed inset-0 z-[2000] hidden">
    <div class="absolute inset-0 bg-black/60"></div>

    <!-- ✅ 팝업 폭/패딩 축소 -->
    <div class="absolute inset-0 overflow-auto p-3 md:p-3">
      <div class="max-w-5xl mx-auto"> <!-- 기존 6xl -> 5xl -->
        <div class="rounded-2xl overflow-hidden shadow-2xl border bg-white">
          <!-- 상단 배경 헤더 -->
          <div id="modalHeroHeader"
               class="relative px-4 py-2 md:px-5 md:py-3 text-white"
               style="background: linear-gradient(135deg,#0ea5e9,#2563eb);">
            <div class="flex items-start justify-between gap-3">
              <div class="min-w-0">
                <div class="flex items-center gap-2 text-sm md:text-xs opacity-90">
                  <span id="hdrClass" class="inline-flex items-center gap-1">
                    <span class="w-4 h-4 rounded bg-white/20 inline-flex items-center justify-center overflow-hidden">
                      <img id="hdrClassIcon"
                           src="images/hero/icon_infantry.webp"
                           class="w-3.5 h-3.5 object-contain"
                           onerror="this.style.display='none'"/>
                    </span>
                    <span>HERO CLASS: -</span>
                  </span>
                  <span class="opacity-60">•</span>
                  <span id="hdrType" class="inline-flex items-center gap-1">
                    <span class="w-4 h-4 rounded bg-white/20 inline-flex items-center justify-center">⚔️</span>
                    <span>EXPEDITION TYPE: -</span>
                  </span>
                </div>

                <div class="mt-2">
                  <div id="hdrName" class="text-3xl md:text-4xl font-black title-grit uppercase">
                    HERO
                  </div>
                  <div id="hdrGen" class="mt-1 text-[11px] md:text-xs opacity-90">Gen -</div>
                </div>
              </div>

              <div class="flex items-center gap-2">
                <button id="closeModal"
                        class="px-3 py-2 rounded-xl bg-white/15 hover:bg-white/25 border border-white/20 text-sm">
                  닫기
                </button>
              </div>
            </div>
          </div>

          <!-- 본문: 좌/중앙/우 -->
          <div class="relative p-4 md:p-3">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-3">

              <!-- 좌: Exploration (✅ 막대 제거, 바로 표시) -->
              <div class="lg:col-span-4">
                <div class="rounded-2xl border p-3 md:p-4 h-full">
                  <h3 class="text-base md:text-lg font-extrabold">탐험 스킬</h3>
                  <div id="exploreSkills" class="mt-3 space-y-3"></div>
                </div>
              </div>

              <!-- 중앙: 캐릭터 이미지 -->
              <div class="lg:col-span-4">
                <div class="rounded-2xl border p-3 md:p-4 h-full flex flex-col">
                  <div class="flex items-center justify-between">
                    <div id="sourceText" class="text-[11px] text-gray-500"></div>
                  </div>

                  <div class="mt-3 flex-1 flex items-center justify-center">
                    <!-- ✅ 이미지 박스도 살짝 축소 -->
                    <div class="w-full max-w-[300px] aspect-[3/4] rounded-2xl border overflow-hidden flex items-center justify-center">
                      <img id="heroImg"
                           src="/images/hero/thumb/jeronimo.webp"
                           alt="hero"
                           class="w-full h-full object-contain"
                           loading="lazy"
                           onerror="this.onerror=null; this.style.display='none'; document.getElementById('heroImgFallback').classList.remove('hidden');" />
                      <div id="heroImgFallback" class="hidden text-sm text-gray-500 p-4 text-center">
                        hero image not found<br/>
                        (경로 확인)
                      </div>
                    </div>
                  </div>

                  <div id="exclusiveWrap" class="mt-3 rounded-xl border p-3 text-sm">
                    <div class="font-bold">특성버프</div>
                    <div id="exclusiveSkill" class="mt-2"></div>
                  </div>
                </div>
              </div>

              <!-- 우: Expedition (✅ 막대 제거, 바로 표시) -->
              <div class="lg:col-span-4">
                <div class="rounded-2xl border bg-white p-3 md:p-4 h-full">
                  <h3 class="text-base md:text-lg font-extrabold">원정 스킬</h3>
                  <div id="expeditionSkills" class="mt-3 space-y-3"></div>
                </div>
              </div>

              <!-- 하단 스탯 (✅ 패딩 살짝 다운) -->
              <div class="lg:col-span-12">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                  <div class="rounded-2xl border bg-white p-3 md:p-4">
                    <div class="font-extrabold">전용무기속성</div>
                    <div id="statExplore" class="mt-2 grid grid-cols-2 gap-2 text-sm"></div>
                  </div>
                  <div class="rounded-2xl border bg-white p-3 md:p-4">
                    <div class="font-extrabold">영웅 속성(원정)</div>
                    <div id="statExpedition" class="mt-2 grid grid-cols-2 gap-2 text-sm"></div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  // =========================
  // ✅ 데이터 (샘플)
  // =========================
  const HEROES = [
    {
      key: "jeronimo",
      gen: 1,
      name: "Jeronimo",
      nameKo: "제로니모",
      heroClass: "INFANTRY",
      heroClassicon: "images/hero/icon_infantry.webp",
      expeditionType: "COMBAT",
      source: "VIP팩/최강영주",
      headerGradient: ["#0891b2", "#1d4ed8"],
      thumb: "images/hero/thumb/jeronimo.webp",   // 리스트용(작은거/크롭된거)
      portrait: "images/hero/jeronimo.webp",      // 모달용(전신/큰거)
      exclusiveSkill: [
        { key:"Special", title: "타고난 지도자", desc: "카리스마가 전체 군에 영향을 미쳐 제로니모의 출정 여부와 상관없이 전체 아군 부대의 파괴력과 HP가 3%/6%/9%/12%/15% 증가합니다.",
          icon: "images/hero/skills/jeronimo/Special.webp"}
      ],
      explorationSkills: [
        { key:"L1", title:"삼단 베기", desc:"일정 범위 안의 적을 들어올려 3차례 베고, 매번 공격력 160%/176%/192%/208%/224%의 피해를 입힌다.", 
          icon:"images/hero/skills/jeronimo/L1.webp"},
        { key:"L2", title:"검기", desc:"일반 공격마다 검기를 시전해서 전방 직사각형 범위 내 적에게 공격력 15%/17%/19%/21%/23%의 피해를 입힌다.",
          icon:"images/hero/skills/jeronimo/L2.webp" },
        { key:"L3", title:"거만함", desc:"도도한 제로니모는 순풍이 불 때 더욱 강해진다. HP가 50% 이상일 때 공격력이 16%/24%/32%/40%/48% 향상된다.",
          icon:"images/hero/skills/jeronimo/L3.webp" }
      ],
      expeditionSkills: [
        { key:"R1", title:"전쟁 선언", desc:"전투 전 선혈로 전체 아군 부대가 입히는 피해가 5%/10%/15%/20%/25% 증가한다.", icon:"images/hero/skills/jeronimo/R1.webp" },
        { key:"R2", title:"검술 지도", desc:"검술의 이치를 전수해 전체 아군 부대의 공격력이 5%/10%/15%/20%/25% 상승한다.", icon:"images/hero/skills/jeronimo/R2.webp" },
        { key:"R3", title:"정밀 검술", desc:"4라운드마다 전체 아군 부대가 주는 피해를 6%/12%/18%/24%/30% 증가(2라운드 지속).", icon:"images/hero/skills/jeronimo/R3.webp" }
      ],
      stats: {
        exploration: { "방패병 파괴력": "+62.50%", 방패병HP:"+62.50%" },
        expedition: { "방패병 공격력": "+260.20%", "방패병 방어력": "+260.20%" }
      }
    },
    { 
      key: "natalia",
      gen: 1,
      name: "Natalia",
      nameKo: "나탈리아",
      heroClass: "INFANTRY",
      heroClassicon: "images/hero/icon_infantry.webp",
      expeditionType: "COMBAT",
      source: "VIP팩",
      headerGradient: ["#0891b2", "#1d4ed8"],
      thumb: "images/hero/thumb/natalia.webp",   // 리스트용(작은거/크롭된거)
      portrait: "images/hero/natalia.webp",      // 모달용(전신/큰거)
      exclusiveSkill: [
        { key:"Special", title: "타고난 지도자", desc: "카리스마가 전체 군에 영향을 미쳐 제로니모의 출정 여부와 상관없이 전체 아군 부대의 파괴력과 HP가 3%/6%/9%/12%/15% 증가합니다.",
          icon: "images/hero/skills/natalia/Special.webp"}
      ],
      explorationSkills: [
        { key:"L1", title:"비스트 어택", desc:"북극곰이 몸을 일으켰다가 강하게 땅을 내리쳐 공격력 160%/176%/192%/208%/224% 의 범위 피해를 입히고, 범위 내 모든 적을 넉백시켜 1초간 스턴시킨다." ,
          icon:"images/hero/skills/natalia/L1.webp"},
        { key:"L2", title:"채찍질 ", desc:"채찍을 휘둘러서 목표물에게 공격력 150%/165%/180%/195%/210% 의 피해를 입힌다.",
          icon:"images/hero/skills/natalia/L2.webp" },
        { key:"L3", title:"레인지 리스폰", desc:"상대하기 어려운 백곰과 그의 짝. 피해를 입을 때 나탈리아의 공격력이 10% 확률로 + 4%/6%/8%/10%/12% 향상된다. 지속시간 3초(최대 5개 중첩).",
          icon:"images/hero/skills/natalia/L3.webp" }
      ],
      expeditionSkills: [
        { key:"R1", title:"야성 수호", desc:"전투 전 선혈로 전체 아군 부대가 입히는 피해가 5%/10%/15%/20%/25% 증가한다.", icon:"images/hero/skills/natalia/R1.webp" },
        { key:"R2", title:"비스트 로드", desc:"검술의 이치를 전수해 전체 아군 부대의 공격력이 5%/10%/15%/20%/25% 상승한다.", icon:"images/hero/skills/natalia/R2.webp" },
        { key:"R3", title:"야성의 부름", desc:"4라운드마다 전체 아군 부대가 주는 피해를 6%/12%/18%/24%/30% 증가(2라운드 지속).", icon:"images/hero/skills/natalia/R3.webp" }
      ],
      stats: {
        exploration: { "방패병 파괴력": "+50.0%", 방패병HP:"+50.0%" },
        expedition: { "방패병 공격력": "+200.20%", "방패병 방어력": "+200.20%" }
      }
    },
    { 
      key: "molly",
      gen: 1,
      name: "Molly",
      nameKo: "몰리",
      heroClass: "LANCER",
      heroClassicon: "images/hero/icon_lancer.webp",
      expeditionType: "COMBAT",
      source: "VIP팩",
      headerGradient: ["#0891b2", "#1d4ed8"],
      thumb: "images/hero/thumb/natalia.webp",   // 리스트용(작은거/크롭된거)
      portrait: "images/hero/natalia.webp",      // 모달용(전신/큰거)
      explorationSkills: [
        { key:"L1", title:"비스트 어택", desc:"북극곰이 몸을 일으켰다가 강하게 땅을 내리쳐 공격력 160%/176%/192%/208%/224% 의 범위 피해를 입히고, 범위 내 모든 적을 넉백시켜 1초간 스턴시킨다." ,
          icon:"images/hero/skills/natalia/L1.webp"},
        { key:"L2", title:"채찍질 ", desc:"채찍을 휘둘러서 목표물에게 공격력 150%/165%/180%/195%/210% 의 피해를 입힌다.",
          icon:"images/hero/skills/natalia/L2.webp" },
        { key:"L3", title:"레인지 리스폰", desc:"상대하기 어려운 백곰과 그의 짝. 피해를 입을 때 나탈리아의 공격력이 10% 확률로 + 4%/6%/8%/10%/12% 향상된다. 지속시간 3초(최대 5개 중첩).",
          icon:"images/hero/skills/natalia/L3.webp" }
      ],
      expeditionSkills: [
        { key:"R1", title:"야성 수호", desc:"전투 전 선혈로 전체 아군 부대가 입히는 피해가 5%/10%/15%/20%/25% 증가한다.", icon:"images/hero/skills/natalia/R1.webp" },
        { key:"R2", title:"비스트 로드", desc:"검술의 이치를 전수해 전체 아군 부대의 공격력이 5%/10%/15%/20%/25% 상승한다.", icon:"images/hero/skills/natalia/R2.webp" },
        { key:"R3", title:"야성의 부름", desc:"4라운드마다 전체 아군 부대가 주는 피해를 6%/12%/18%/24%/30% 증가(2라운드 지속).", icon:"images/hero/skills/natalia/R3.webp" }
      ],
      stats: {
        exploration: { "방패병 파괴력": "+50.0%", 방패병HP:"+50.0%" },
        expedition: { "방패병 공격력": "+200.20%", "방패병 방어력": "+200.20%" }
      }
    },
  ];

  // =========================
  // 상태
  // =========================
  let currentGen = "ALL";
  let currentHero = null;

  // =========================
  // 유틸
  // =========================
  const $ = (id) => document.getElementById(id);
  const escapeHtml = (s) => (s ?? "").toString()
    .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
    .replaceAll('"',"&quot;").replaceAll("'","&#039;");
  const fmt = (v) => typeof v === "number" ? v.toLocaleString("ko-KR") : String(v);

  function setDarkMode(on){
    document.documentElement.classList.toggle("dark", on);
    document.body.classList.toggle("bg-slate-100", !on);
    document.body.classList.toggle("text-slate-900", !on);
    document.body.classList.toggle("bg-[#0b0f1a]", on);
    document.body.classList.toggle("text-slate-100", on);
    localStorage.setItem("WOS_HERO_DARK", on ? "1":"0");
  }

  // =========================
  // 렌더: 세대 탭
  // =========================
  function renderGenTabs(){
    const gens = Array.from(new Set(HEROES.map(h=>h.gen))).sort((a,b)=>a-b);
    const wrap = $("genTabs");
    wrap.innerHTML = "";

    const makeBtn = (label, val) => {
      const btn = document.createElement("button");
      const active = (currentGen === val);
      btn.className = "px-3 py-2 rounded-xl text-sm border shadow-sm " +
        (active ? "bg-blue-500 text-white border-blue-500" : "bg-white hover:bg-slate-50");
      btn.textContent = label;
      btn.onclick = () => { currentGen = val; renderGenTabs(); renderHeroGrid(); };
      return btn;
    };

    wrap.appendChild(makeBtn("전체", "ALL"));
    gens.forEach(g => wrap.appendChild(makeBtn(`Gen ${g}`, g)));
  }

  // =========================
  // 렌더: 영웅 리스트 카드
  // =========================
  const CLASS_ICON_MAP = {
    INFANTRY: "images/hero/icon_infantry.webp",
    LANCER: "images/hero/icon_lancer.webp",
    MARKSMAN: "images/hero/icon_marksman.webp"
  };

  function renderHeroGrid(){
    const wrap = $("heroGrid");
    wrap.innerHTML = "";

    const list = HEROES.filter(h => currentGen==="ALL" ? true : h.gen===currentGen);
    list.forEach(hero=>{
      const card = document.createElement("button");
      card.className = "text-left rounded-2xl border bg-white p-3 hover:shadow-md transition";
      card.onclick = () => openHeroModal(hero);

      const img = hero.thumb || hero.portrait || "";
      card.innerHTML = `
        <div class="flex items-center gap-3">
          <div class="w-14 h-14 rounded-2xl border overflow-hidden flex items-center justify-center shrink-0">
            <img src="${escapeHtml(img)}" class="w-full h-full object-contain"
                 onerror="this.onerror=null; this.style.display='none';" />
            <div class="text-[10px]"></div>
          </div>
          <div class="min-w-0 flex-1">
            <div class="flex items-center gap-2">
              <div class="text-lg font-extrabold truncate">${escapeHtml(hero.nameKo || hero.name)}</div>
              <div class="shrink-0">
                ${CLASS_ICON_MAP[hero.heroClass] ? `
                  <img src="${escapeHtml(CLASS_ICON_MAP[hero.heroClass])}"
                       class="w-5 h-5 object-contain opacity-90"
                       alt="${escapeHtml(hero.heroClass)}"
                       loading="lazy"
                       onerror="this.onerror=null; this.style.display='none';" />
                ` : ``}
              </div>
            </div>
            <div class="mt-0.5 text-xs">
              Gen ${hero.gen} • ${escapeHtml(hero.heroClass)} • ${escapeHtml(hero.expeditionType)}
            </div>
            <div class="mt-1 text-[11px] truncate">${escapeHtml(hero.source||"")}</div>
          </div>
        </div>
      `;
      wrap.appendChild(card);
    });

    if(list.length===0){
      wrap.innerHTML = `<div class="text-sm text-slate-500">표시할 영웅이 없습니다.</div>`;
    }
  }

  // =========================
  // 렌더: 스킬 카드(✅ 막대 없이, 바로 표시)
  // =========================
  function renderSkills(targetEl, skills){
    const wrap = $(targetEl);
    wrap.innerHTML = "";

    (skills || []).slice(0,3).forEach(sk=>{
      const lv = sk.level ?? 5;
      const val = sk.value ?? "-";

      const el = document.createElement("div");
      el.className = "rounded-xl border p-3";
      el.innerHTML = `
        <div class="flex gap-3">
          <div class="w-12 h-12 overflow-hidden flex items-center justify-center shrink-0">
            <img src="${escapeHtml(sk.icon||"")}"
                 class="w-full h-full object-contain"
                 loading="lazy"
                 onerror="this.onerror=null; this.style.display='none';" />
          </div>

          <div class="min-w-0 flex-1">
            <div class="mt-1 text-xs text-gray-700 leading-relaxed">
              ${escapeHtml(sk.desc||"")}
            </div>
          </div>
        </div>
      `;
      wrap.appendChild(el);
    });
  }

  function renderStats(){
    const s = currentHero?.stats || {};
    const ex = s.exploration || {};
    const ep = s.expedition || {};

    $("statExplore").innerHTML = Object.keys(ex).map(k => `
      <div class="rounded-xl border p-3">
        <div class="text-xs text-gray-700">${escapeHtml(k)}</div>
        <div class="text-base font-extrabold">${escapeHtml(fmt(ex[k]))}</div>
      </div>
    `).join("");

    $("statExpedition").innerHTML = Object.keys(ep).map(k => `
      <div class="rounded-xl border p-3">
        <div class="text-xs text-gray-700">${escapeHtml(k)}</div>
        <div class="text-base font-extrabold">${escapeHtml(fmt(ep[k]))}</div>
      </div>
    `).join("");
  }

  function renderExclusiveSkill(skills){
    const wrap = $("exclusiveWrap");
    const body = $("exclusiveSkill");

    // ✅ 없으면 카드(테두리 포함) 통째로 숨김
    if(!Array.isArray(skills) || skills.length === 0){
      wrap.classList.add("hidden");
      body.innerHTML = "";
      return;
    }

    // ✅ 있으면 표시
    wrap.classList.remove("hidden");
    body.innerHTML = "";

    skills.forEach(sk => {
      const el = document.createElement("div");
      el.className = "flex items-start gap-3";

      el.innerHTML = `
        <div class="w-12 h-12 rounded-xl border overflow-hidden
                    flex items-center justify-center shrink-0">
          <img src="${escapeHtml(sk.icon || "")}"
               class="w-full h-full object-contain"
               loading="lazy"
               onerror="this.onerror=null; this.style.display='none';" />
        </div>

        <div class="min-w-0 flex-1">
          <div class="font-bold text-xs mb-1">${escapeHtml(sk.title || "")}</div>
          <div class="text-xs leading-relaxed text-gray-700">
            ${escapeHtml(sk.desc || "")}
          </div>
        </div>
      `;
      body.appendChild(el);
    });
  }

  // =========================
  // 모달 열기/닫기
  // =========================
  function openHeroModal(hero){
    currentHero = hero;

    $("hdrName").textContent = (hero.nameKo || "").toUpperCase();
    $("hdrGen").textContent = `Gen ${hero.gen} • ${hero.nameKo || ""}`;
    $("hdrClass").lastElementChild.textContent = `병종구분: ${hero.heroClass || "-"}`;
    $("hdrType").lastElementChild.textContent = `영웅타입: ${hero.expeditionType || "-"}`;
    $("sourceText").textContent = hero.source ? `획득처: ${hero.source}` : "";

    const g = hero.headerGradient || ["#0ea5e9","#2563eb"];
    $("modalHeroHeader").style.background = `linear-gradient(135deg, ${g[0]}, ${g[1]})`;

    const imgEl = $("heroImg");
    imgEl.style.display = "";
    $("heroImgFallback").classList.add("hidden");
    imgEl.src = hero.portrait || hero.thumb || "";

    renderExclusiveSkill(hero.exclusiveSkill);

    renderSkills("exploreSkills", hero.explorationSkills);
    renderSkills("expeditionSkills", hero.expeditionSkills);
    renderStats();

    $("modalBackdrop").classList.remove("hidden");
    document.body.style.overflow = "hidden";
  }

  function closeHeroModal(){
    $("modalBackdrop").classList.add("hidden");
    document.body.style.overflow = "";
  }

  // =========================
  // 이벤트
  // =========================
  $("closeModal").onclick = closeHeroModal;
  $("modalBackdrop").addEventListener("click", (e)=>{
    if(e.target === $("modalBackdrop")) closeHeroModal();
  });
  window.addEventListener("keydown", (e)=>{
    if(e.key === "Escape" && !$("modalBackdrop").classList.contains("hidden")) closeHeroModal();
  });

  function applyDarkFromParent(){
    try{
      const parentDark =
        window.parent &&
        window.parent.document &&
        window.parent.document.body &&
        window.parent.document.body.classList.contains("dark-mode");

      // 자식도 동일하게 dark-mode 적용
      document.body.classList.toggle("dark-mode", !!parentDark);

      // Tailwind dark: 변형도 쓰려면 html에 dark 클래스도 같이
      document.documentElement.classList.toggle("dark", !!parentDark);
    }catch(e){
      // cross-origin이면 접근 불가 (그땐 postMessage로 해야함)
    }
  }

  // 최초 1회
  applyDarkFromParent();

  // =========================
  // 초기 실행
  // =========================
  (function init(){
    const saved = localStorage.getItem('darkMode') === 'true'
    setDarkMode(saved);
    renderGenTabs();
    renderHeroGrid();
  })();
</script>
</body>
</html>
