<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>í›ˆë ¨ ê³„ì‚°ê¸°</title>
  <script>
    (function () {
      try {
        const v = localStorage.getItem('darkMode');
        if (v === 'true') document.documentElement.classList.add('dark-mode');
      } catch (e) {}
    })();
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/common.css">
  <link rel="stylesheet" href="css/troop.css">
  <script src="js/common.js"></script>     
</head>
<body>
  <div id="navMount"></div>
  
  <div class="max-w-[1500px] mx-auto bg-white rounded shadow p-2 flex flex-col sm:flex-row gap-2">
    <div class="flex-1 bg-white rounded p-2 space-y-4 shadow">
      <div class="bg-gray-100 p-2 font-sans text-sm">
        <div class="bg-white p-4 rounded-xl shadow-md space-y-4">
          <h1 class="text-2xl font-bold text-gray-800 mb-3">ğŸ‘®â€â™‚ï¸ ë³‘ì‚¬ê³„ì‚°ê¸°</h1>
          
          <div class="exp-card">
            <div class="p-4">
              <div class="flex items-center justify-between mb-2">
                <h2 class="text-[16px] font-semibold text-yellow-700">ğŸ“˜ í›ˆë ¨ê³„ì‚°</h2>
              </div>
              <!-- ====== ì¹´ë“œ ë ˆì´ì•„ì›ƒ (2ê°œ ê°€ë¡œ) ====== -->
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-3">
                <!-- ì¹´ë“œ1: ì…ë ¥ -->
                <section class="card">
                  <h2 class="text-lg font-bold mb-3">í•„ìš” í•­ëª© ì…ë ¥</h2>

                  <!-- ì•ˆë‚´ -->
                  <div class="rounded-lg border bg-blue-50 p-2 text-[13px] text-gray-800 leading-5 mb-3">
                    <p>í›ˆë ¨ì†ë„ëŠ” <b>ì„œë²„/ê´€ì§ ë²„í”„ ì ìš© ì „</b> ìˆ˜ì¹˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
                    <p>ex) ì¼ë°˜êµìœ¡ë¶€(50%), ì„œë²„ë²„í”„(30%), í‘œì‹œì†ë„ 375% â†’ ì…ë ¥ê°’: <b>295%</b></p>
                  </div>

                  <!-- ì²´í¬ë°•ìŠ¤ -->
                  <div class="flex gap-4 flex-wrap mb-3">
                    <label class="inline-flex items-center font-semibold">
                      <input type="checkbox" id="edu1" class="mr-1" onclick="handleExclusiveCheck('edu1','edu2')" />
                      ì¼ë°˜)êµìœ¡ë¶€ì¥ê´€
                    </label>
                    <label class="inline-flex items-center font-semibold">
                      <input type="checkbox" id="edu2" class="mr-1" onclick="handleExclusiveCheck('edu2','edu1')" />
                      ìµœì§‘)êµìœ¡ë¶€ì¥ê´€
                    </label>
                    <label class="inline-flex items-center font-semibold">
                      <input type="checkbox" id="serverBuff" class="mr-1" />
                      ì„œë²„í›ˆë ¨ë²„í”„ (+30%)
                    </label>
                  </div>

                  <!-- í‹°ì–´ / ì†ë„ / í›ˆë ¨ëŸ‰ -->
                  <div class="grid grid-cols-3 gap-2 mb-3">
                    <div>
                      <label for="tier" class="block font-semibold mb-1">ë³‘ì‚¬ í‹°ì–´</label>
                      <select id="tier" class="border rounded w-full p-2">
                        <option value="T1">T1</option><option value="T2">T2</option><option value="T3">T3</option>
                        <option value="T4">T4</option><option value="T5">T5</option><option value="T6">T6</option>
                        <option value="T7">T7</option><option value="T8">T8</option><option value="T9">T9</option>
                        <option value="T10">T10</option><option value="T11" selected>T11</option>
                      </select>
                    </div>
                    <div>
                      <label for="speed" class="block font-semibold mb-1">í›ˆë ¨ì†ë„ (%)</label>
                      <input type="number" id="speed" class="border rounded w-full p-2" placeholder="0" min="0" step="0.1" />
                    </div>
                    <div>
                      <label for="amount" class="block font-semibold mb-1">1íšŒ í›ˆë ¨ëŸ‰ (ëª…)</label>
                      <input type="number" id="amount" class="border rounded w-full p-2" placeholder="0" min="0" />
                    </div>
                  </div>

                  <!-- ê°€ì† ì…ë ¥ -->
                  <div class="grid grid-cols-3 gap-2 mb-4">
                    <div>
                      <label class="block font-semibold mb-1">ê°€ì† (ì¼)</label>
                      <input type="number" id="accelDay" class="border rounded w-full p-2" placeholder="0" min="0" />
                    </div>
                    <div>
                      <label class="block font-semibold mb-1">ê°€ì† (ì‹œê°„)</label>
                      <input type="number" id="accelHour" class="border rounded w-full p-2" placeholder="0" min="0" />
                    </div>
                    <div>
                      <label class="block font-semibold mb-1">ê°€ì† (ë¶„)</label>
                      <input type="number" id="accelMinute" class="border rounded w-full p-2" placeholder="0" min="0" />
                    </div>
                  </div>

                  <button onclick="calculateTraining()"
                          class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded w-full">
                    í›ˆë ¨ ê³„ì‚°
                  </button>
                </section>
                <!-- ì¹´ë“œ2: ê²°ê³¼ -->
                <section id="rslt" class="bg-white rounded-xl shadow-md border p-4">
                  <h2 class="text-lg font-bold mb-3">ê³„ì‚° ê²°ê³¼</h2>
                  <div id="result" class="text-[13px]">
                  </div>
                </section>
              </div>
              </div>
            </div>
          
          <div class="exp-card">
            <div class="p-4">
              <div class="flex items-center justify-between mb-2">
                <h2 class="text-[16px] font-semibold text-yellow-700">ğŸ“˜ ìŠ¹ê¸‰ê³„ì‚°</h2>
              </div>
              <div id="heroEquipGridBody" class="grid grid-cols-1 md:grid-cols-4 gap-2"></div>
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-3">
                <!-- ì¢Œ: ì…ë ¥ -->
                <section class="card p-4 space-y-3">
                  <h2 class="text-lg font-semibold mb-2">ì…ë ¥ í•­ëª©</h2>
                  <!-- â–¼ ìƒˆë¡œ ì¶”ê°€: ìŠ¹ê¸‰ ëŒ€ìƒ/ëª©í‘œ ë“œë¡­ë‹¤ìš´ (1ì¤„) -->
                  <div class="grid grid-cols-2 gap-3">
                    <div>
                      <div class="label">ìŠ¹ê¸‰ëŒ€ìƒ ë³‘ì‚¬</div>
                      <select id="selFrom" class="text-sm border rounded w-full p-2">
                        <option value="T1">T1</option>
                        <option value="T2">T2</option>
                        <option value="T3">T3</option>
                        <option value="T4">T4</option>
                        <option value="T5">T5</option>
                        <option value="T6">T6</option>
                        <option value="T7">T7</option>
                        <option value="T8">T8</option>
                        <option value="T9">T9</option>
                        <option value="T10" selected>T10</option>
                        <option value="T11">T11</option>
                      </select>
                    </div>
                    <div>
                      <div class="label">ìŠ¹ê¸‰ëª©í‘œ ë³‘ì‚¬</div>
                        <select id="selTo" class="text-sm border rounded w-full p-2">
                          <option value="T1">T1</option>
                          <option value="T2">T2</option>
                          <option value="T3">T3</option>
                          <option value="T4">T4</option>
                          <option value="T5">T5</option>
                          <option value="T6">T6</option>
                          <option value="T7">T7</option>
                          <option value="T8">T8</option>
                          <option value="T9">T9</option>
                          <option value="T10">T10</option>
                          <option value="T11" selected>T11</option>
                        </select>
                      </div>
                  </div>
                  <div>
                    <div class="label">ë³´ìœ  ë³‘ì‚¬ìˆ˜</div>
                    <input id="ownedUnits" type="text" class="mono2 p-2" placeholder="0" nputmode="numeric"/>
                  </div>

                  <div class="grid grid-cols-3 gap-3">
                    <div>
                      <div class="label">1íšŒ ìŠ¹ê¸‰ëŸ‰</div>
                      <input id="perPromoQty" type="text" class="mono2 p-2" placeholder="0" nputmode="numeric"/>
                    </div>
                    <div>
                      <div class="label">ë³´ìœ ê°€ì† (D:HH:MM)</div>
                      <input id="ownedSpeedup" type="text" class="mono2 p-2" placeholder="00:00:00" inputmode="numeric"/>
                    </div>
                    <div>
                      <div class="label">ìŠ¹ê¸‰ ì†Œìš”ì‹œê°„ (HH:MM:SS)</div>
                      <input id="perPromoTime" type="text" class="mono2 p-2" placeholder="00:00:00" inputmode="numeric"//>
                    </div>
                  </div>

                  <div>
                    <div class="label">ë³´ìœ ê°€ì† ì´í•©</div>
                    <div id="outOwnedSpeedupPretty" class="out mono2">-</div>
                  </div>
                  <button id="calcBtn" class="primary w-full mt-2 hidden">ê³„ì‚°í•˜ê¸°</button>
                </section>
                <!-- ìš°: ê²°ê³¼ -->
                <section class="card p-4 space-y-3">
                  <h2 class="text-lg font-semibold mb-2">ê²°ê³¼</h2>

                  <div>
                    <div class="label">â‘  ìŠ¹ê¸‰ ì†Œìš”ì‹œê°„ (ë³´ìœ ë³‘ì‚¬ ì „ì²´ ê¸°ì¤€)</div>
                    <div id="outPromoTime" class="out mono3">-</div>
                    <div class="muted mt-1">ê³µì‹ : ceil(ë³´ìœ ë³‘ì‚¬ Ã· 1íšŒìŠ¹ê¸‰ëŸ‰) Ã— 1íšŒìŠ¹ê¸‰ì‹œê°„</div>
                  </div>

                  <div>
                    <div class="label">â‘¡ ìŠ¹ê¸‰ ê°€ëŠ¥í•œ ë³‘ì‚¬ ìˆ˜</div>
                    <div id="outCoveredUnits" class="out mono3">-</div>
                    <div class="muted mt-1">ê³µì‹ : floor(ë³´ìœ ê°€ì† Ã· 1íšŒìŠ¹ê¸‰ì‹œê°„) Ã— 1íšŒìŠ¹ê¸‰ëŸ‰</div>
                  </div>

                  <div>
                    <div class="label">â‘¢ ìŠ¹ê¸‰ ê°€ëŠ¥í•œ íšŸìˆ˜</div>
                    <div id="outCoveredBatches" class="out mono3">-</div>
                    <div class="muted mt-1">ê³µì‹ : floor(ë³´ìœ ê°€ì† Ã· 1íšŒìŠ¹ê¸‰ì‹œê°„)</div>
                  </div>

                  <div>
                    <div class="label">â‘£ ì”ì—¬ ìŠ¹ê¸‰ í•„ìš”ì‹œê°„</div>
                    <div id="outRemainingPromoTime" class="out mono3">-</div>
                    <div class="muted mt-1">ê³µì‹ : ì´ ìŠ¹ê¸‰ì‹œê°„ âˆ’ ë³´ìœ ê°€ì†</div>          
                  </div>

                  <div>
                    <div class="label">â‘¤ SVS ì ìˆ˜</div>
                    <div id="svs_score" class="out mono3">-</div>
                    <div class="muted mt-1">ê³µì‹ : (ëª©í‘œí‹°ì–´ ì ìˆ˜ âˆ’ ëŒ€ìƒí‹°ì–´ ì ìˆ˜) Ã— ì‹¤ì œ ìŠ¹ê¸‰ëœ ë³‘ì‚¬ ìˆ˜</div>
                  </div>
                </section>
              </div>
            </div>
          </div>      
                    
        </div>
      </div>
    </div>
  </div>
  
  <div id="footerMount"></div>
	
  <script>
    fetch("nav.html")
      .then(r => r.text())
      .then(html => {
        document.getElementById("navMount").innerHTML = html;
        //initNav({ mode: "iframe" });    // âœ… iframe ê³„ì† ì“¸ê±°ë©´
        initNav({ mode: "navigate" }); // âœ… í˜ì´ì§€ ì´ë™ìœ¼ë¡œ ê°ˆê±°ë©´
      });
    
    // 2) FOOTER
    fetch("footer.html").then(r=>r.text()).then(html=>{
      document.getElementById("footerMount").innerHTML = html;
      initFooter({ mode:"navigate" }); // ë˜ëŠ” "iframe"
      initAdsense({ ids:["ad1"] });    // ìŠ¬ë¡¯ idë“¤
    });
  </script>
  <!-- ====== ìŠ¤í¬ë¦½íŠ¸ ====== -->
  <script>
    const trainingTimePerTier = {
      T1:12, T2:17, T3:24, T4:32, T5:44, T6:60, T7:83, T8:113, T9:131, T10:152, T11:180
    };
    const tierScore = {
      T1:3, T2:4, T3:5, T4:8, T5:12, T6:18, T7:25, T8:35, T9:45, T10:60, T11:75
    };

    function handleExclusiveCheck(clickedId, otherId){
      const c=document.getElementById(clickedId), o=document.getElementById(otherId);
      if(c.checked) o.checked=false;
    }
    const fmt = (n)=> (isFinite(n)? n.toLocaleString() : "-");
    const toMmSs = (sec)=>{
      sec = Math.max(0, Math.floor(sec||0));
      const m = Math.floor(sec/60);
      const s = sec%60;
      return `${m.toLocaleString()}ë¶„ ${s.toString().padStart(2,'0')}ì´ˆ`;
    };

    function calculateTraining(){
      const tier = document.getElementById('tier').value;
      const baseTimeSec = trainingTimePerTier[tier];

      let speedPercent = parseFloat(document.getElementById('speed').value) || 0;
      let amountPerSession = parseInt(document.getElementById('amount').value,10) || 0;

      // ì²´í¬ë°•ìŠ¤ íš¨ê³¼ ì ìš©
      const buffs = [];
      if(document.getElementById('edu1').checked){ amountPerSession+=200; speedPercent+=50; buffs.push('í›ˆë ¨ëŸ‰ +200ëª… / í›ˆë ¨ì†ë„ +50%'); }
      if(document.getElementById('edu2').checked){ amountPerSession+=300; speedPercent+=75; buffs.push('í›ˆë ¨ëŸ‰ +300ëª… / í›ˆë ¨ì†ë„ +75%'); }
      if(document.getElementById('serverBuff').checked){ speedPercent+=30; buffs.push('í›ˆë ¨ì†ë„ +30%'); }

      const accelDay = parseInt(document.getElementById('accelDay').value,10) || 0;
      const accelHour = parseInt(document.getElementById('accelHour').value,10) || 0;
      const accelMinute = parseInt(document.getElementById('accelMinute').value,10) || 0;
      const totalAccelSec = accelDay*86400 + accelHour*3600 + accelMinute*60;

      const speedRatio = speedPercent*0.01;
      const adjustedTimePerUnitSec = baseTimeSec / (1 + speedRatio);
      const totalTimePerSessionSec = adjustedTimePerUnitSec * amountPerSession;

      const possibleTrainings = Math.floor(totalAccelSec / (totalTimePerSessionSec || 1));
      const totalProduced = possibleTrainings * amountPerSession;
      const totalScore = totalProduced * tierScore[tier];
      const oneUnitScore = tierScore[tier]; // âœ… ì„ íƒ í‹°ì–´ 1ëª… SVS

      const usedSec = possibleTrainings * totalTimePerSessionSec;
      const d = Math.floor(usedSec/86400);
      const h = Math.floor((usedSec%86400)/3600);
      const m = Math.floor((usedSec%3600)/60);

      const resultEl = document.getElementById('result');
      resultEl.innerHTML = `
        <!-- ìš”ì•½ í‘œ -->
        <table class="w-full border text-sm text-center table-auto mb-3">
          <thead class="bg-blue-100">
            <tr>
              <th class="border p-2">ë³‘ì‚¬ í‹°ì–´</th>
              <th class="border p-2">ì´ ìƒì‚° ë³‘ì‚¬ìˆ˜</th>
              <th class="border p-2">SVS ì ìˆ˜</th>
              <th class="border p-2">ì´ ì†Œìš” ì‹œê°„</th>
              <th class="border p-2">í›ˆë ¨ íšŸìˆ˜</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border p-2 font-medium">${tier}</td>
              <td class="border p-2">${fmt(totalProduced)} ëª…</td>
              <td class="border p-2">${fmt(totalScore)}</td>
              <td class="border p-2">${d}ì¼ ${h}ì‹œê°„ ${m}ë¶„</td>
              <td class="border p-2">${fmt(possibleTrainings)} íšŒ</td>
            </tr>
          </tbody>
        </table>

        <!-- âœ… ì„¸ë¶€ ê²°ê³¼ (í•­ìƒ ì—´ë¦¼) -->
        <div class="border rounded-lg p-3 bg-gray-100">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
            <div>
              <div class="font-semibold mb-1">ê¸°ë³¸ ì •ë³´</div>
              <ul class="list-disc pl-5">
                <li>1ëª… ê¸°ë³¸ í›ˆë ¨ì‹œê°„: ${baseTimeSec.toLocaleString()}ì´ˆ</li>
                <li>ìµœì¢… í›ˆë ¨ì†ë„: ${speedPercent.toFixed(1)}%</li>
                <li>1ëª…ë‹¹ SVS ì ìˆ˜: <b>${fmt(oneUnitScore)}</b></li>
              </ul>
            </div>
            <div>
              <div class="font-semibold mb-1">ì„¸ì…˜ ë° ê°€ì†</div>
              <ul class="list-disc pl-5">
                <li>1íšŒ í›ˆë ¨ëŸ‰(ë²„í”„ í¬í•¨): ${fmt(amountPerSession)}ëª…</li>
                <li>1íšŒ ì†Œìš” ì‹œê°„(ê³„ì‚°): ${toMmSs(totalTimePerSessionSec)}</li>
                <li>ë³´ìœ  ê°€ì† í•©ê³„: ${accelDay}ì¼ ${accelHour}ì‹œê°„ ${accelMinute}ë¶„</li>
              </ul>
            </div>
          </div>

          <!-- ì ìš©ëœ ë²„í”„ (ê²°ê³¼ ë°•ìŠ¤ ì•ˆì—ì„œë§Œ í‘œì‹œ) -->
          <div class="mt-3">
            <div class="font-semibold mb-1">ì ìš©ëœ ë²„í”„</div>
            <div id="activeBuffsClone" class="flex flex-wrap gap-2">
              ${
                buffs.length
                  ? buffs.map(b=>`<span class="inline-flex items-center gap-1 px-2 py-1 rounded-full border text-[12px] bg-gray-100">${b}</span>`).join('')
                  : `<span class="text-gray-500 text-[13px]">ì„ íƒëœ ë²„í”„ ì—†ìŒ</span>`
              }
            </div>
          </div>
        </div>
      `;

      sendHeightToParent();
      document.getElementById("rslt").classList.remove("hidden");
    }
  </script>
  <script>
    /* ====== TROOP SCORE (ë‚´ë¶€ìš©, í‘œì‹œ ì•ˆ í•¨) ====== */
    const TROOP_SCORE = { T1:3, T2:4, T3:5, T4:8, T5:12, T6:18, T7:25, T8:35, T9:45, T10:60, T11:75 };
    const TIERS = Object.keys(TROOP_SCORE);

    // ëŒ€ìƒ ë³€ê²½ ì‹œ +1 ìë™ ì„ íƒ(ëì´ë©´ ê·¸ëŒ€ë¡œ)
    selFrom.addEventListener('change', () => {
      const idx = TIERS.indexOf(selFrom.value);
      const nextIdx = Math.min(idx + 1, TIERS.length - 1);
      selTo.value = TIERS[nextIdx];
    });		

    // ========== ì…ë ¥ ì œì–´ ==========
    document.querySelectorAll('input[type="text"]').forEach(inp => {
      inp.addEventListener('input', e => {
        let v = e.target.value.replace(/[^\d:]/g, ''); // ìˆ«ìì™€ :ë§Œ í—ˆìš©
        if (!v) { e.target.value = ''; return; }

        // ì²œë‹¨ìœ„ ìë™ êµ¬ë¶„ (ë‹¨, ì½œë¡ ì´ ì—†ëŠ” ì…ë ¥ë§Œ)
        if (!v.includes(':')) {
          const num = v.replace(/,/g, '');
          if (!isNaN(num)) e.target.value = Number(num).toLocaleString('ko-KR');
          else e.target.value = v;
        } else {
          e.target.value = v;
        }
      });
    });
    
    function attachTimeMask(inputId, mode) {
      const el = document.getElementById(inputId);
      if (!el) return;

      el.addEventListener('input', () => {
        let raw = el.value.replace(/\D/g, '');

        if (raw.length === 0) {
          el.value = '';
          return;
        }
        
        if (mode === 'DHHMM') {
          // DD:HH:MM (6 digits)
          raw = raw.slice(0, 6);
          const d  = raw.slice(0, 2);
          const hh = raw.slice(2, 4);
          const mm = raw.slice(4, 6);
          
          let out = d;
          if (raw.length > 2) out += `:${hh}`;
          if (raw.length > 4) out += `:${mm}`;
          el.value = out;
        } else if (mode === 'HHMMSS') {
          // HH:MM:SS (6 digits)
          raw = raw.slice(0, 6);
          const hh = raw.slice(0, 2);
          const mm = raw.slice(2, 4);
          const ss = raw.slice(4, 6);
          let out = hh;
          if (raw.length > 2) out += `:${mm}`;
          if (raw.length > 4) out += `:${ss}`;
          el.value = out;
        }else {
          // ìˆ«ì ì²œë‹¨ìœ„ ì½¤ë§ˆ
          raw = raw.slice(0); // digits only
          // ë¹ˆê°’ì€ ìœ„ì—ì„œ return ì²˜ë¦¬ë¨
          el.value = Number(raw).toLocaleString('ko-KR');
        }
      });

      // ì»¤ì„œ í•­ìƒ ë
      el.addEventListener('focus', () => {
        requestAnimationFrame(() => {
          el.setSelectionRange(el.value.length, el.value.length);
        });
      });
    }

    // âœ… ì ìš©
    attachTimeMask('ownedUnits');
    attachTimeMask('perPromoQty');
    attachTimeMask('ownedSpeedup', 'DHHMM');   // 361023 -> 36:10:23 (36ì¼ 10ì‹œê°„ 23ë¶„)
    attachTimeMask('perPromoTime', 'HHMMSS');  // 123045 -> 12:30:45

    // ========== ì‹œê°„ íŒŒì‹± ==========
    function parseOwnedSpeedup_NoSS(s) {
      if (!s || typeof s !== 'string') return 0;
      const parts = s.trim().split(':').map(x => x.trim());
      const nums = parts.map(Number);
      if (nums.some(n => !Number.isFinite(n) || n < 0)) return 0;
      if (nums.length === 3) { const [d,h,m]=nums; return ((d*24+h)*60+m)*60; }
      if (nums.length === 2) { const [h,m]=nums; return (h*3600+m*60); }
      if (nums.length === 1) return nums[0]*60;
      return 0;
    }
    
    function parseHMS(s) {
      if (!s || typeof s !== 'string') return 0;
      const p = s.trim().split(':').map(x => x.trim());
      const n = p.map(Number);
      if (n.some(v=>!Number.isFinite(v)||v<0)) return 0;
      let h=0,m=0,s2=0;
      if (n.length===3)[h,m,s2]=n; else if(n.length===2)[m,s2]=n; else if(n.length===1)[s2]=n;
      return ((h*60+m)*60+s2);
    }
    
    function secondsToDHMS(sec){
      sec=Math.max(0,Math.floor(sec));
      const d=Math.floor(sec/86400);sec%=86400;
      const h=Math.floor(sec/3600);sec%=3600;
      const m=Math.floor(sec/60);const s=sec%60;
      const pad=n=>String(n).padStart(2,'0');
      return (d>0?`${d}ì¼ `:'')+`${pad(h)}ì‹œê°„ ${pad(m)}ë¶„`;
    }
    function getInt(v){ return parseInt(String(v).replace(/[^\d]/g,''))||0; }
    function prettyInt(n){ return isFinite(n)?n.toLocaleString('ko-KR'):'-'; }

    // ========== ê³„ì‚° ==========
    function calc(){
      const ownedUnits=getInt(document.getElementById('ownedUnits').value);
      const perPromoQty=getInt(document.getElementById('perPromoQty').value);
      const ownedSpeedupSec=parseOwnedSpeedup_NoSS(document.getElementById('ownedSpeedup').value||'');
      const perPromoTimeSec=parseHMS(document.getElementById('perPromoTime').value||'');
      const tPromoEff=perPromoTimeSec;
      const promoBatches=perPromoQty>0?Math.ceil(ownedUnits/perPromoQty):0;
      const totalPromoTime=promoBatches*tPromoEff;
      const coveredBatches=tPromoEff>0?Math.floor(ownedSpeedupSec/tPromoEff):0;
      const coveredUnitsRaw=coveredBatches*perPromoQty;
      const coveredUnits=Math.min(ownedUnits,isFinite(coveredUnitsRaw)?coveredUnitsRaw:0);
      const remainingPromoTime=Math.max(0,totalPromoTime-ownedSpeedupSec);

      const curTier = document.getElementById('selFrom').value;
      const tarTier = document.getElementById('selTo').value;
      // ë‹¨ì¼ ìŠ¹ê¸‰ ì ìˆ˜: ëª©í‘œ - ëŒ€ìƒ
      const singleScore = (TROOP_SCORE[tarTier] ?? 0) - (TROOP_SCORE[curTier] ?? 0);
      // ì´ SVS ì ìˆ˜: ë‹¨ì¼ ì ìˆ˜ Ã— ì‹¤ì œ ìŠ¹ê¸‰ ë³‘ì‚¬ ìˆ˜(ê°€ì†ìœ¼ë¡œ ì»¤ë²„ë˜ëŠ” ìˆ˜ ê¸°ì¤€)
      const totalScore = Math.max(0, singleScore) * coveredUnits;

      document.getElementById('outPromoTime').textContent=totalPromoTime>0?secondsToDHMS(totalPromoTime):'-';
      document.getElementById('outCoveredUnits').textContent=coveredUnits>0?prettyInt(coveredUnits):'0';
      document.getElementById('outCoveredBatches').textContent=prettyInt(Math.max(0,coveredBatches));
      document.getElementById('outRemainingPromoTime').textContent=secondsToDHMS(remainingPromoTime);
      document.getElementById('outOwnedSpeedupPretty').textContent=ownedSpeedupSec?secondsToDHMS(ownedSpeedupSec):'-';
      document.getElementById('svs_score').textContent=prettyInt(totalScore)||'-';
    }

    document.getElementById('calcBtn').addEventListener('click', calc);
    ['ownedUnits','perPromoQty','ownedSpeedup','perPromoTime'].forEach(id=>{
      document.getElementById(id).addEventListener('input',()=>{ clearTimeout(window.__deb); window.__deb=setTimeout(calc,150); });
    });
  </script>    
  <script>
    function sendHeightToParent(){
      const h=document.body.scrollHeight;
      window.parent.postMessage({type:"FRAME_CHANGE",height:h},"*");
    }
    window.addEventListener("load",()=>setTimeout(sendHeightToParent,100));

    document.addEventListener("contextmenu", e=>e.preventDefault());
    document.addEventListener("keydown", e=>{
      if(e.key==="F12"||(e.ctrlKey&&e.shiftKey&&(e.key==="I"||e.key==="J"))||(e.ctrlKey&&(e.key==="U"||e.key==="S"))) e.preventDefault();
    });

    window.addEventListener('message', (e) => {
      if (e.data?.type === 'DARK_MODE') {
        document.body.classList.toggle('dark-mode', e.data.value);
      }
    });
  </script>
</body>
</html>
