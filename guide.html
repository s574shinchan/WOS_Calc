<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>🎫 패키지구성 | WOS 계산기</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
  <body class="bg-gray-100 p-2 font-sans text-sm">
    <div class="max-w-6xl mx-auto bg-white p-2 rounded-xl shadow-md space-y-5"> 
      <!-- 뒤로가기 버튼 -->
      <button onclick="loadPage('menu.html')" class="mb-4 flex items-center text-blue-600 hover:underline">
        <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
        </svg>
        메뉴로 돌아가기
      </button>
      <h1 class="text-2xl font-bold text-gray-800 mb-4">📘 WOS 자료모음</h1>
      <div id="GuideGridBody" class="grid grid-cols-2 gap-4"></div>

      <!-- 요새보상 -->
      <details class="bg-white border border-indigo-300 rounded-md p-4">
        <summary class="cursor-pointer text-lg font-bold text-indigo-700 mb-2">🛕 요새 주차별 보상</summary>
        <div id="FortTable" class="mt-3 overflow-x-auto">
          <p class="text-gray-500 text-sm">📦 데이터 로딩 중...</p>
        </div>
      </details>

      <!-- 🧬 세대별 영웅 특성 -->
      <details class="bg-white border border-indigo-300 rounded-md p-4">
        <summary class="cursor-pointer text-lg font-bold text-indigo-700 mb-2">🧬 세대별 영웅 특성</summary>
        <div id="HeroTable" class="mt-3 overflow-x-auto">
          <p class="text-gray-500 text-sm">📦 데이터 로딩 중...</p>
        </div>
      </details>

      <!-- ⚔️ SVS_Event -->
      <details class="bg-white border border-amber-400 rounded-md p-4">
        <summary class="cursor-pointer text-lg font-bold text-amber-700 mb-2">⚔️ SVS 준비단계</summary>
        <div id="SVSTable" class="mt-3 overflow-x-auto">
          <p class="text-gray-500 text-sm">📦 데이터 로딩 중...</p>
        </div>
      </details>
      
      <!-- 🛫 이민 시스템 안내 -->
      <details class="bg-white border border-gray-300 rounded-md p-4">
        <summary class="cursor-pointer text-lg font-bold text-blue-700 mb-2">🛫 이민 시스템 안내</summary>
        <div id="Tranfer" class="mt-3 space-y-4 text-sm text-gray-800">
          <p class="text-gray-500 text-sm">📦 데이터 로딩 중...</p>
        </div>
      </details>
            
      <!-- 📦 각종 패키지 구성 섹션 -->
      <details class="bg-white border border-gray-300 rounded-md p-4">
        <summary class="cursor-pointer text-lg font-bold text-purple-700 mb-2">📦 각종 패키지 구성</summary>
        <div class="mt-3 space-y-4 text-sm text-gray-800">
          
          <!-- 패키지 요일구성 -->
          <details class="bg-white border border-purple-300 rounded-md p-4">
            <summary class="cursor-pointer text-lg font-bold text-blue-700 mb-2">📅 패키지등장 요일</summary>
            <div id="pakageYoil" class="space-y-4 text-sm text-gray-800 mt-2">
              <p class="text-gray-500 text-sm">📦 데이터 로딩 중...</p>
            </div>
          </details>
          
          <!-- 전용무기패키지 -->
          <details class="bg-white border border-purple-300 rounded-md p-4">
            <summary class="cursor-pointer text-lg font-bold text-blue-700 mb-2">🗡 전용무기 패키지</summary>
            <div id="EnhanceGear" class="space-y-4 text-sm text-gray-800 mt-2">
              <p class="text-gray-500 text-sm">📦 데이터 로딩 중...</p>
            </div>
          </details>
          
          <!-- 커스텀상자 패키지-->
          <details class="bg-white border border-orange-300 rounded-md p-4">
            <summary class="cursor-pointer text-lg font-bold text-orange-700 mb-2">📦 커스텀상자 패키지</summary>
            <div id="customContainer" class="space-y-6 mt-2">
              <p clase="text-gray-500 text-sm">📦 데이터 로딩 중...</p>
            </div>
          </details>
          
          <!-- 🛠️ 커스텀 무기상자 패키지 -->
          <details class="bg-white border border-orange-300 rounded-md p-4">
            <summary class="cursor-pointer text-lg font-bold text-orange-700 mb-2">🛠️ 커스텀 무기상자 패키지</summary>
            <div id="customweapon" class="space-y-6 mt-2">
              <p clase="text-gray-500 text-sm">📦 데이터 로딩 중...</p>
            </div>
          </details>
                    
          <!-- 💎 보석마스터 패키지 구성 -->
          <details class="bg-white border border-purple-300 rounded-md p-4">
            <summary class="cursor-pointer text-lg font-bold text-purple-700 mb-2">💎 보석마스터 패키지</summary>
            <div id="gemPakage" class="space-y-4 text-sm text-gray-800 mt-2">
              <p class="text-gray-500 text-sm">📦 데이터 로딩 중...</p>
            </div>
          </details>
  
          <!-- 💠 보석비전 패키지 -->
          <details class="bg-white border border-purple-300 rounded-md p-4">
            <summary class="cursor-pointer text-lg font-bold text-purple-700 mb-2">💠 보석비전 패키지</summary>
            <div id="visionPakage" class="mt-2">
              <p clase="text-gray-500 text-sm">📦 데이터 로딩 중...</p>
            </div>
          </details>
        </div>
      </details>
      
      <script>
        function sendHeightToParent() {
          const height = document.body.scrollHeight;
          console.log(height);
          window.parent.postMessage({ type: "FRAME_CHANGE", height }, "*");
        }

        // 페이지 최초 로드 시
        window.addEventListener("load", () => {
          setTimeout(sendHeightToParent, 100); // 약간의 렌더링 대기
        });
        
        // 각 details 토글 시 높이 재전송
        document.querySelectorAll("details").forEach(detail => {
          detail.addEventListener("toggle", () => {
            // 약간 딜레이 후 정확한 높이 측정
            setTimeout(sendHeightToParent, 300);
          });
        });
        
        function loadPage(page) {
          const isMobile = window.innerWidth <= 768;
          const height = isMobile ? "550px" : "345px"
          window.location.href = page;
          window.parent.postMessage({ type: "SET_FRAME_SIZE", height: height, width: "100%"}, "*");
        }
      </script>
      
      <script>
        const baseUrl = 'https://s574shinchan.github.io/WOS_Calc/data/';

        // [ID] => [파일명] 매핑
        const fileMap = {
          HeroTable: 'genhero.html',
          Tranfer: 'StatusTransfer.html',
          gemPakage: 'gempakage.html',
          visionPakage: 'visionpakage.html',
          customContainer: 'custompakage.html',
          SVSTable: 'SVS_Event.html',
          pakageYoil: '패키지요일.html',
          customweapon: '커스텀무기.html',
          EnhanceGear: '전용무기.html',
          FortTable: '요새보상.html'
        };

        // [ID] => 로딩 여부 저장
        const loadState = {};
        Object.keys(fileMap).forEach(id => loadState[id] = false);

        // 모든 <details> 요소에 toggle 이벤트 바인딩
        document.querySelectorAll('details').forEach(detail => {
          detail.addEventListener('toggle', async () => {
            for (const id in fileMap) {
              const target = detail.querySelector(`#${id}`);
              if (target && !loadState[id] && detail.open) {
                try {
                  const res = await fetch(`${baseUrl}${fileMap[id]}`);
                  if (!res.ok) throw new Error('파일 요청 실패');
                  const html = await res.text();
                  target.innerHTML = html;
                  loadState[id] = true;
                } catch (e) {
                  target.innerHTML = `<p class="text-red-500">⚠️ 테이블 데이터를 불러오는 데 실패했습니다.</p>`;
                }
              }
            }
          });
        });
      </script>
  
      <script>
      document.addEventListener("contextmenu", event => event.preventDefault());
      document.addEventListener("keydown", function (e) {
        if (e.key === "F12" ||
            (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "J")) ||
            (e.ctrlKey && (e.key === "U" || e.key === "S")))
        {
          e.preventDefault();
        }
      });
    </script>
  </body>
</html>
