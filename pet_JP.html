<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pet</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* ===== ë‹¤í¬ëª¨ë“œ ===== */
    body.dark-mode { background:#121212; color:#f0f0f0; }
    .dark-mode .border{ border-color:#444 !important; }
    .dark-mode .bg-white{ background:#2c2c2c !important; color:#f0f0f0 !important; }
    .dark-mode .bg-gray-100{ background:#1e1e1e !important; }
    .dark-mode .text-gray-800,.dark-mode .text-gray-700,.dark-mode .text-gray-600{ color:#dddddd !important; }
    .dark-mode select,.dark-mode input{ color:#000 !important; }
    .dark-mode table{ background:#2c2c2c; color:#f0f0f0; }
    .dark-mode th,.dark-mode td{ border-color:#444 !important; }

    /* ===== experts ì¹´ë“œ ===== */
    .exp-card{
      border:1px solid rgba(0,0,0,.08);
      border-radius:16px;
      background:#fff;
      box-shadow:0 6px 18px rgba(15,23,42,.06);
      transition: box-shadow .2s ease;
    }
    .exp-card:hover{ box-shadow:0 10px 26px rgba(15,23,42,.12); }
    .muted{ font-size:12px; color:#6b7280; }

    body.dark-mode .exp-card{ background:#2c2c2c !important; border-color:#444 !important; }
    body.dark-mode .muted{ color:#b7b7b7 !important; }
  </style>

  <!-- ë‹¤í¬ëª¨ë“œ ìƒíƒœ ìœ ì§€ -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
      }
    });
  </script>
</head>
<body class="bg-gray-100 p-2 font-sans text-sm">
  <div class="max-w-[1500px] mx-auto bg-white p-3 rounded-xl shadow-md space-y-5">
    <h1 class="text-2xl font-bold text-gray-800">ğŸ¾ Pet</h1>

    <!-- ë³´ìœ ëŸ‰ -->
    <div class="rounded-xl border border-black/10 p-3">
      <div class="flex items-center justify-between mb-2">
        <div class="font-semibold">ä¿æœ‰è³‡æº</div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
        <div class="flex items-center gap-2">
          <label class="text-[12px] text-gray-600 w-24">ãƒšãƒƒãƒˆã®é¤Œ</label>
          <input type="number" id="own-í«ë¨¹ì´"
            class="flex-1 border rounded-lg px-3 py-2 text-sm"
            placeholder="0" min="0" />
        </div>

        <div class="flex items-center gap-2">
          <label class="text-[12px] text-gray-600 w-24">ç£èª¿æ•™æ‰‹å¸³</label>
          <input type="number" id="own-ì¡°ë ¨ë§¤ë‰´ì–¼"
            class="flex-1 border rounded-lg px-3 py-2 text-sm"
            placeholder="0" min="0" />
        </div>

        <div class="flex items-center gap-2">
          <label class="text-[12px] text-gray-600 w-24">æ´»åŠ›è–¬</label>
          <input type="number" id="own-í™œë ¥ì˜ì•½"
            class="flex-1 border rounded-lg px-3 py-2 text-sm"
            placeholder="0" min="0" />
        </div>

        <div class="flex items-center gap-2">
          <label class="text-[12px] text-gray-600 w-24">å¼·åŒ–è¡€æ¸…</label>
          <input type="number" id="own-ê°•í™”í˜ˆì²­"
            class="flex-1 border rounded-lg px-3 py-2 text-sm"
            placeholder="0" min="0" />
        </div>
      </div>
    </div>    
    
    <!-- ì„¹ì…˜ë³„ ì¹´ë“œ ì»¨í…Œì´ë„ˆ (ìŠ¤í¬ë¦°ìƒ· ìŠ¤íƒ€ì¼) -->
    <div id="petSections" class="space-y-4"></div>
		
    <!-- í•˜ë‹¨ ì´í•© íŒ¨ë„ -->
    <div id="summaryPanel">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-3">
        <!-- ì´í•© -->
        <div class="rounded-xl border border-black/10 p-3">
          <div class="font-semibold mb-2">Total</div>
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div class="flex justify-between text-[13px]"><span class="text-gray-600">ãƒšãƒƒãƒˆã®é¤Œ</span><span id="sum-í«ë¨¹ì´">0</span></div>
          <div class="flex justify-between text-[13px]"><span class="text-gray-600">ç£èª¿æ•™æ‰‹å¸³</span><span id="sum-ì¡°ë ¨ë§¤ë‰´ì–¼">0</span></div>
          <div class="flex justify-between text-[13px]"><span class="text-gray-600">æ´»åŠ›è–¬</span><span id="sum-í™œë ¥ì˜ì•½">0</span></div>
          <div class="flex justify-between text-[13px]"><span class="text-gray-600">å¼·åŒ–è¡€æ¸…</span><span id="sum-ê°•í™”í˜ˆì²­">0</span></div>
          </div>              
        </div>              
        <!-- ê³¼ë¶€ì¡± -->
        <div class="rounded-xl border border-black/10 p-3">
          <div class="font-semibold mb-2">Surplus</div>
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div class="flex justify-between text-[13px]"><span class="text-gray-600">ãƒšãƒƒãƒˆã®é¤Œ</span><span id="def-í«ë¨¹ì´">0</span></div>
          <div class="flex justify-between text-[13px]"><span class="text-gray-600">ç£èª¿æ•™æ‰‹å¸³</span><span id="def-ì¡°ë ¨ë§¤ë‰´ì–¼">0</span></div>
          <div class="flex justify-between text-[13px]"><span class="text-gray-600">æ´»åŠ›è–¬</span><span id="def-í™œë ¥ì˜ì•½">0</span></div>
          <div class="flex justify-between text-[13px]"><span class="text-gray-600">å¼·åŒ–è¡€æ¸…</span><span id="def-ê°•í™”í˜ˆì²­">0</span></div>
          </div>
        </div>
      </div>
    </div>
    <div class="flex justify-end mt-2">
      <button id="btn-calc-total" class="px-4 py-2 rounded-lg bg-blue-600 text-white text-sm hover:bg-blue-700">å…¨ä½“è¨ˆç®—</button>
    </div>    
  </div>

  <!-- ===== ë°ì´í„° & ë¡œì§ ===== -->
  <script>
    // ===============================
    // âœ… ìŠ¤í¬ë¦°ìƒ· ìŠ¤íƒ€ì¼: ë“±ê¸‰(í¬ê·€ë„) ì„¹ì…˜ + í« ì¹´ë“œ
    // - í« ëª©ë¡ì´ ì•ˆë‚˜ì˜¤ëŠ” ì›ì¸(ë“±ê¸‰/ì´ë¦„ í˜¼ë™, index ê¸°ë°˜ ëˆ„ì ) ì œê±°
    // - CSVëŠ” í¬ê·€ë„ í‚¤(SSR/SR/R/N/UnKnown) ë‹¨ìœ„ë¡œ 1íšŒ ë¡œë“œ
    // - ì¹´ë“œëŠ” 'í« ì´ë¦„' ë‹¨ìœ„ë¡œ 1ì¥ë§Œ ìƒì„±
    // ===============================

    // í™”ë©´ì— í‘œì‹œí•  í« ìˆœì„œ(ìŠ¤í¬ë¦°ìƒ· ìˆœì„œ)
    const pets = [
      { name: "æ´çªŸãƒã‚¤ã‚¨ãƒŠ", rarityKey: "UnKnown" },

      { name: "åŒ—æ¥µã‚ªã‚ªã‚«ãƒŸ", rarityKey: "N" },
      { name: "Muskã‚¸ãƒ£ã‚³ã‚¦ã‚¦ã‚·", rarityKey: "N" },

      { name: "ã‚¸ãƒ£ã‚¤ã‚¢ãƒ³ãƒˆãƒã‚¯", rarityKey: "R" },
      { name: "å·¨é³¥ã‚¿ã‚¤ã‚¿ãƒ³", rarityKey: "R" },

      { name: "ã‚ªã‚ªãƒ„ãƒã‚¸ã‚«", rarityKey: "SR" },
      { name: "ãƒ¦ã‚­ãƒ’ãƒ§ã‚¦", rarityKey: "SR" },

      { name: "ãƒ›ãƒ©ã‚¢ãƒŠãƒ©ã‚¤ã‚ªãƒ³", rarityKey: "SSR" },
      { name: "ã‚¹ãƒãƒ¼ã‚¨ã‚¤ãƒ—", rarityKey: "SSR" },
      { name: "ã‚¢ã‚¤ã‚¢ãƒ³ãƒ©ã‚¤ãƒ", rarityKey: "SSR" },
      { name: "ã‚µãƒ¼ãƒ™ãƒ«ã‚¿ã‚¤ã‚¬ãƒ¼", rarityKey: "SSR" },
      { name: "ãƒãƒ³ãƒ¢ã‚¹", rarityKey: "SSR" },
      { name: "éœ§æ°·ã®å¤çŒ¿", rarityKey: "SSR" },
      { name: "å·¨å¤§ãªã‚«ãƒ¡ãƒ¬ã‚ªãƒ³", rarityKey: "SSR" },
    ];

    // âœ… DOM idì— í•œê¸€/íŠ¹ìˆ˜ë¬¸ì/%ê°€ ë“¤ì–´ê°€ë©´ querySelectorê°€ ê¹¨ì§ˆ ìˆ˜ ìˆì–´ì„œ
    //   í«ë§ˆë‹¤ ì•ˆì „í•œ ê³ ìœ í‚¤ë¥¼ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•œë‹¤.
    const petKeyByName = Object.create(null);
    pets.forEach((p, i) => { petKeyByName[p.name] = `p${i}`; });

    // í¬ê·€ë„ ì„¹ì…˜(ìŠ¤í¬ë¦°ìƒ· í—¤ë”) ë§¤í•‘
    const sectionMeta = {
      "UnKnown": { title: "Common",  dot: "bg-emerald-500", bar: "bg-emerald-200", text: "text-emerald-700" },
      "N":       { title: "Uncommon",    dot: "bg-slate-400", bar: "bg-slate-200", text: "text-slate-700" },
      "R":       { title: "Rare",      dot: "bg-blue-500", bar: "bg-blue-200", text: "text-blue-700" },
      "SR":      { title: "Epic",      dot: "bg-purple-500", bar: "bg-purple-200", text: "text-purple-700" },
      "SSR":     { title: "SSR",       dot: "bg-orange-500", bar: "bg-orange-200", text: "text-orange-800" },
    };

    // CSV ê¸°ë³¸ ê²½ë¡œ
    const CSV_BASE = "https://raw.githubusercontent.com/s574shinchan/WOS_Calc/main/data/Pet/";

    // ìºì‹œ
    const dataByRarity = {};     // rarityKey -> rows[]
    const levelsByPet = {};      // petName -> sorted levels[]

    // UI ë£¨íŠ¸
    const sectionsRoot = document.getElementById("petSections");

    // util: ì•ˆì „ split ì¤„ë°”ê¿ˆ
    function splitLines(t){ return t.replaceAll("ëŒíŒŒ","Advanced").replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n"); }

    async function fetchPetCSV(gradeKey) {
      const url = `${CSV_BASE}Pet_${gradeKey}.csv`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("CSV not found: " + url);

      const text = await res.text();
      const lines = splitLines(text)
        .filter(Boolean)
        .map(row => row.split(","));

      const headers = lines[0].map(h => h.trim());

      const rows = lines.slice(1).map(cols => {
        const obj = {};
        headers.forEach((h, i) => {
          obj[h] = (cols[i] ?? "").trim();
        });
        return obj;
      });

      return rows; // âœ… ì´ ì¤„ì´ í•µì‹¬
    }

    async function loadAll() {
      // í¬ê·€ë„ í‚¤ ê¸°ì¤€ 1íšŒ ë¡œë“œ
      const uniqueKeys = [...new Set(pets.map(p => p.rarityKey))];
      for (const key of uniqueKeys) {
        try {
          dataByRarity[key] = await fetchPetCSV(key);
        } catch (e) {
          console.warn(key, e.message);
          dataByRarity[key] = [];
        }
      }
    
      // í«ë³„ ë ˆë²¨ ëª©ë¡ ì¤€ë¹„(ì •ë ¬)
      pets.forEach(p => {
        const rows = dataByRarity[p.rarityKey] || [];
        const lvSet = new Set(rows.map(r => (r["ë ˆë²¨"] || "").trim()).filter(Boolean));
        const lvList = [...lvSet];
        const nums = lvList.map(v => Number(v));
        const allNum = nums.every(n => !Number.isNaN(n));
        levelsByPet[p.name] = allNum ? lvList.sort((a,b)=>Number(a)-Number(b)) : lvList;
      });

      renderSections();
      bindOwnedInputs();
    }

    function renderSections() {
      sectionsRoot.innerHTML = "";

      // rarityKey ìˆœì„œ = ìŠ¤í¬ë¦°ìƒ·
      const rarityOrder = ["UnKnown", "N", "R", "SR", "SSR"];

      for (const rk of rarityOrder) {
        const meta = sectionMeta[rk];
        if (!meta) continue;

        // í•´ë‹¹ í¬ê·€ë„ì— í¬í•¨ë˜ëŠ” í«
        const groupPets = pets.filter(p => p.rarityKey === rk);
        if (groupPets.length === 0) continue;

        const section = document.createElement("section");
        //section.className = "space-y-2";

        // í—¤ë” ë°”
        section.innerHTML = `
          <div class="flex items-center gap-2 px-2 py-2 rounded-lg ${meta.bar}">
            <span class="w-2.5 h-2.5 rounded-full ${meta.dot}"></span>
            <div class="font-semibold ${meta.text}">${meta.title}</div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4" data-rarity="${rk}"></div>
        `;
        sectionsRoot.appendChild(section);

        const grid = section.querySelector(`[data-rarity="${rk}"]`);
        groupPets.forEach((p) => {
          const key = `pet-${petKeyByName[p.name]}`;
          const lvList = levelsByPet[p.name] || [];
          const options = lvList.map(lv => `<option value="${lv}">${lv}</option>`).join("");

          const card = document.createElement("div");
          card.className = "exp-card";
          card.innerHTML = `
            <div class="p-4">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <div class="flex items-center gap-2 mb-2">
                    <h3 class="text-[15px] font-semibold text-gray-800">${p.name}</h3>
                  </div>
                  <div class="grid grid-cols-1 gap-2">
                    <div class="flex items-center justify-between gap-2">
                      <span class="text-[12px] text-gray-600">ç¾åœ¨</span>
                      <select id="cur-${key}" class="border rounded-lg px-2 py-1 text-sm min-w-[120px]">${options}</select>
                    </div>
                    <div class="flex items-center justify-between gap-2">
                      <span class="text-[12px] text-gray-600">ç›®æ¨™</span>
                      <select id="tgt-${key}" class="border rounded-lg px-2 py-1 text-sm min-w-[120px]">${options}</select>
                    </div>
                  </div>
                </div>
                <div class="md:pl-4">
                  <div class="font-semibold text-gray-800 mb-2">å°è¨ˆ</div>
                  <div class="grid grid-cols-[1fr_auto] gap-x-3 text-[13px]">
                    <div class="text-gray-600">ãƒšãƒƒãƒˆã®é¤Œ</div><div class="text-right tabular-nums" id="sub-food-${key}">0</div>
                    <div class="text-gray-600">ç£èª¿æ•™æ‰‹å¸³</div><div class="text-right tabular-nums" id="sub-manual-${key}">0</div>
                    <div class="text-gray-600">æ´»åŠ›è–¬</div><div class="text-right tabular-nums" id="sub-vital-${key}">0</div>
                    <div class="text-gray-600">å¼·åŒ–è¡€æ¸…</div><div class="text-right tabular-nums" id="sub-serum-${key}">0</div>
                  </div>
                </div>
              </div>
            </div>
          `;
          grid.appendChild(card);

          const curSel = document.getElementById(`cur-${key}`);
          const tgtSel = document.getElementById(`tgt-${key}`);

          const onAnyChange = () => {
            // í˜„ì¬ë¥¼ ì˜¬ë ¸ëŠ”ë° ëª©í‘œê°€ ë” ë‚®ìœ¼ë©´ ëª©í‘œë¥¼ í˜„ì¬ë¡œ ë§ì¶¤(ì˜¤ë¥˜/ì—­ì „ ë°©ì§€)
            const lvListLocal = levelsByPet[p.name] || [];
            const ci = lvListLocal.indexOf(curSel.value);
            const ti = lvListLocal.indexOf(tgtSel.value);
            if (ci !== -1 && ti !== -1 && ti < ci) tgtSel.value = curSel.value;

            updateCardSubtotal(p, key);
          };

          curSel.addEventListener("change", onAnyChange);
          tgtSel.addEventListener("change", onAnyChange);

          // ì´ˆê¸°ê°’: ì²« ë ˆë²¨
          if (lvList.length > 0) {
            curSel.value = lvList[0];
            tgtSel.value = lvList[0];
          }

          updateCardSubtotal(p, key);
        });
      }
    }

    function toNum(v){
      const n = Number(String(v ?? "").replace(/,/g, "").trim());
      return Number.isFinite(n) ? n : 0;
    }

    function updateCardSubtotal(pet, key) {
      const rows = (dataByRarity[pet.rarityKey] || []).slice();

      const lvList = levelsByPet[pet.name] || [];
      const cur = document.getElementById(`cur-${key}`)?.value ?? "";
      const tgt = document.getElementById(`tgt-${key}`)?.value ?? "";

      const s = lvList.indexOf(cur);
      const e = lvList.indexOf(tgt);

      const sum = { food:0, manual:0, vital:0, serum:0 };
      if (s >= 0 && e > s) {
        // ë ˆë²¨ ê¸°ë°˜ìœ¼ë¡œ ì •í™•íˆ ëˆ„ì (í–‰ ìˆœì„œì— ì˜ì¡´ X)
        for (let i = s + 1; i <= e; i++) {
          const lv = lvList[i];
          const r = rows.find(x => String(x["ë ˆë²¨"]).trim() === String(lv).trim());
          if (!r) continue;
          sum.food   += toNum(r["í«ë¨¹ì´"]);
          sum.manual += toNum(r["ì¡°ë ¨ë§¤ë‰´ì–¼"]);
          sum.vital  += toNum(r["í™œë ¥ì˜ì•½"]);
          sum.serum  += toNum(r["ê°•í™”í˜ˆì²­"]);
        }
      }

      const a = document.getElementById(`sub-food-${key}`);
      const b = document.getElementById(`sub-manual-${key}`);
      const c = document.getElementById(`sub-vital-${key}`);
      const d = document.getElementById(`sub-serum-${key}`);
      if (a) a.textContent = sum.food.toLocaleString();
      if (b) b.textContent = sum.manual.toLocaleString();
      if (c) c.textContent = sum.vital.toLocaleString();
      if (d) d.textContent = sum.serum.toLocaleString();
    }

    function calculateTotals() {
      const totals = { food:0, manual:0, vital:0, serum:0 };

      pets.forEach(p => {
        const key = `pet-${petKeyByName[p.name]}`;
        const lvList = levelsByPet[p.name] || [];
        const cur = document.getElementById(`cur-${key}`)?.value ?? "";
        const tgt = document.getElementById(`tgt-${key}`)?.value ?? "";

        const s = lvList.indexOf(cur);
        const e = lvList.indexOf(tgt);
        if (s === -1 || e === -1 || s >= e) return;

        const rows = dataByRarity[p.rarityKey] || [];

        for (let i = s + 1; i <= e; i++) {
          const lv = lvList[i];
          const r = rows.find(x => String(x["ë ˆë²¨"]).trim() === String(lv).trim());
          if (!r) continue;
          totals.food   += toNum(r["í«ë¨¹ì´"]);
          totals.manual += toNum(r["ì¡°ë ¨ë§¤ë‰´ì–¼"]);
          totals.vital  += toNum(r["í™œë ¥ì˜ì•½"]);
          totals.serum  += toNum(r["ê°•í™”í˜ˆì²­"]);
        }
      });

      return totals;
    }

    function renderSummary() {
      const total = calculateTotals();
      const owned = {
        food:   parseFloat(document.getElementById("own-í«ë¨¹ì´").value)||0,
        manual: parseFloat(document.getElementById("own-ì¡°ë ¨ë§¤ë‰´ì–¼").value)||0,
        vital:  parseFloat(document.getElementById("own-í™œë ¥ì˜ì•½").value)||0,
        serum:  parseFloat(document.getElementById("own-ê°•í™”í˜ˆì²­").value)||0,
      };
      const deficit = {
        food: owned.food - total.food,
        manual: owned.manual - total.manual,
        vital: owned.vital - total.vital,
        serum: owned.serum - total.serum,
      };

			document.getElementById("sum-í«ë¨¹ì´").textContent = total["food"].toLocaleString();
      document.getElementById("sum-ì¡°ë ¨ë§¤ë‰´ì–¼").textContent = total["manual"].toLocaleString();
			document.getElementById("sum-í™œë ¥ì˜ì•½").textContent = total["vital"].toLocaleString();
			document.getElementById("sum-ê°•í™”í˜ˆì²­").textContent = total["serum"].toLocaleString();
      
      const defA = document.getElementById("def-í«ë¨¹ì´");
      const defB = document.getElementById("def-ì¡°ë ¨ë§¤ë‰´ì–¼");
      const defC = document.getElementById("def-í™œë ¥ì˜ì•½");
      const defD = document.getElementById("def-ê°•í™”í˜ˆì²­");

      defA.textContent = ( (parseFloat(document.getElementById("own-í«ë¨¹ì´").value||0) - total["food"]) ).toLocaleString();
      defB.textContent = ( (parseFloat(document.getElementById("own-ì¡°ë ¨ë§¤ë‰´ì–¼").value||0) - total["manual"]) ).toLocaleString();
			defC.textContent = ( (parseFloat(document.getElementById("own-í™œë ¥ì˜ì•½").value||0) - total["vital"]) ).toLocaleString();
			defD.textContent = ( (parseFloat(document.getElementById("own-ê°•í™”í˜ˆì²­").value||0) - total["serum"]) ).toLocaleString();

      defA.classList.toggle("text-red-600", parseFloat(defA.textContent.replace(/,/g,'')) < 0);
      defB.classList.toggle("text-red-600", parseFloat(defB.textContent.replace(/,/g,'')) < 0);
			defC.classList.toggle("text-red-600", parseFloat(defC.textContent.replace(/,/g,'')) < 0);
			defD.classList.toggle("text-red-600", parseFloat(defD.textContent.replace(/,/g,'')) < 0);
    }

    // ë””ë°”ìš´ìŠ¤
    let calcTimer = null;
    function scheduleCalc() {
      if (calcTimer) clearTimeout(calcTimer);
      calcTimer = setTimeout(renderSummary, 120);
    }

    function bindOwnedInputs() {

    }

    // ì‹œì‘
    loadAll();
    function sendHeightToParent() {
      const height = document.body.scrollHeight + 160;
      window.parent.postMessage({ type: "FRAME_CHANGE", height }, "*");
    }
    document.getElementById("btn-calc-total")?.addEventListener("click", () => {renderSummary();});
    window.addEventListener("load", () => setTimeout(sendHeightToParent, 100));
  </script>
  <script>
    // F12, Ctrl+Shift+I, Ctrl+U ë“± ë°©ì§€
    document.onkeydown = function (e) {
      if (
        e.keyCode === 123 || // F12
        (e.ctrlKey && e.shiftKey && e.keyCode === 73) || // Ctrl+Shift+I
        (e.ctrlKey && e.shiftKey && e.keyCode === 74) || // Ctrl+Shift+J
        (e.ctrlKey && e.keyCode === 85) // Ctrl+U
      ) {
        e.preventDefault();
        return false;
      }
    };
  
    // ìš°í´ë¦­ ë°©ì§€
    document.addEventListener("contextmenu", (e) => e.preventDefault());
  </script>
  <script>
    window.addEventListener('message', (e) => {
      if (e.data?.type === 'DARK_MODE') {
        document.body.classList.toggle('dark-mode', e.data.value);
      }
    });
  </script>
</body>
</html>
