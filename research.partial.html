<meta charset="UTF-8" />
<div class="max-w-[1500px] mx-auto bg-white rounded shadow p-2 flex flex-col sm:flex-row gap-2">
  <div class="flex-1 bg-white rounded p-2 space-y-4 shadow">
    <div class="bg-gray-100 p-2 font-sans text-sm">
      <div class="bg-white p-4 rounded-xl shadow-md space-y-4">
        <h1 class="text-xl md:text-2xl font-bold text-gray-800">ğŸ§ª ì—°êµ¬ ê³„ì‚°ê¸°</h1>

        <!-- ì—°êµ¬ì†ë„/ë²„í”„ ì¹´ë“œ -->
        <div class="bg-white border rounded-xl shadow-sm p-3">
          <h2 class="text-base font-bold text-gray-800 mb-2">ì—°êµ¬ ì†ë„ / ë²„í”„</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4">
            <!-- ë¶€ì§‘í–‰ê´€ -->
            <div>
              <div class="text-sm font-medium mb-1">ë¶€ì§‘í–‰ê´€ ê´€ì§ ë²„í”„</div>
              <div class="flex flex-wrap gap-2">
                <button type="button"
                        class="w-[125px] px-3 py-2 rounded-xl border font-semibold text-sm toggle-btn"
                        data-toggle="chkVP10" data-group="vp" data-mode="single">
                  10%
                </button>
                <button type="button"
                        class="w-[125px] px-3 py-2 rounded-xl border font-semibold text-sm toggle-btn"
                        data-toggle="chkVP15" data-group="vp" data-mode="single">
                  15%
                </button>
              </div>
              <input type="checkbox" id="chkVP10" hidden>
              <input type="checkbox" id="chkVP15" hidden>
            </div>
            <!--ì„œë²„ë²„í”„-->
            <div>
              <div class="text-sm font-medium mb-1">ì„œë²„ë²„í”„ (10%)</div>
              <div class="flex flex-wrap gap-2">
                <button type="button"
                        class="w-full px-3 py-2 rounded-xl border font-semibold text-sm toggle-btn"
                        data-toggle="chkServerBuff" data-group="server" data-mode="single">
                  í™œì„±í™”
                </button>
              </div>
              <input type="checkbox" id="chkServerBuff" hidden>
            </div>        
            <!-- ì—°êµ¬ì†ë„ -->
            <div>
              <label for="speedPercent" class="block text-sm mb-1">ì—°êµ¬ì†ë„ (%)</label>
              <input type="number" id="speedPercent" class="border rounded p-2 text-sm w-24 text-right" placeholder="0" min="0" />
            </div>         
          </div>
        </div>

        <!-- ì „íˆ¬/ê²½ì œ/ë°œì „ ì¹´ë“œ 3ê°œ -->
        <div class="grid md:grid-cols-3 gap-3">
          <!-- ì „íˆ¬ -->
          <div class="bg-white border rounded-xl shadow-sm p-3">
            <h2 class="text-base font-bold text-blue-700 mb-2">[ì „íˆ¬]</h2>
            <div class="grid grid-cols-[64px_1fr] gap-x-3 gap-y-2">
              <div class="text-[15px] text-gray-600 font-semibold self-center">ì—°êµ¬í•­ëª©</div>
              <select class="border rounded p-2 text-sm w-full" id="researchType"></select>

              <div class="text-[15px] text-gray-600 font-semibold self-center">í˜„ì¬</div>
              <select class="border rounded p-2 text-sm w-full" id="currentLevel"></select>

              <div class="text-[15px] text-gray-600 font-semibold self-center">ëª©í‘œ</div>
              <select class="border rounded p-2 text-sm w-full" id="targetLevel"></select>
            </div>
            <button type="button"
              class="w-full add-btn mt-3 bg-gray-200 text-sm px-3 py-2 rounded hover:bg-blue-300 text-black"
              data-section="battle">ì¶”ê°€</button>
          </div>

          <!-- ê²½ì œ -->
          <div class="bg-white border rounded-xl shadow-sm p-3">
            <h2 class="text-base font-bold text-green-700 mb-2">[ê²½ì œ]</h2>
            <div class="grid grid-cols-[64px_1fr] gap-x-3 gap-y-2">
              <div class="text-[15px] text-gray-600 font-semibold self-center">ì—°êµ¬í•­ëª©</div>
              <select class="border rounded p-2 text-sm w-full" id="economyType"></select>

              <div class="text-[15px] text-gray-600 font-semibold self-center">í˜„ì¬</div>
              <select class="border rounded p-2 text-sm w-full" id="economyCurrent"></select>

              <div class="text-[15px] text-gray-600 font-semibold self-center">ëª©í‘œ</div>
              <select class="border rounded p-2 text-sm w-full" id="economyTarget"></select>
            </div>
            <button type="button"
              class="w-full add-btn mt-3 bg-gray-200 text-sm px-3 py-2 rounded hover:bg-blue-300 text-black"
              data-section="economy">ì¶”ê°€</button>
          </div>

          <!-- ë°œì „ -->
          <div class="bg-white border rounded-xl shadow-sm p-3">
            <h2 class="text-base font-bold text-purple-700 mb-2">[ë°œì „]</h2>
            <div class="grid grid-cols-[64px_1fr] gap-x-3 gap-y-2">
              <div class="text-[15px] text-gray-600 font-semibold self-center">ì—°êµ¬í•­ëª©</div>
              <select class="border rounded p-2 text-sm w-full" id="growthType"></select>

              <div class="text-[15px] text-gray-600 font-semibold self-center">í˜„ì¬</div>
              <select class="border rounded p-2 text-sm w-full" id="growthCurrent"></select>

              <div class="text-[15px] text-gray-600 font-semibold self-center">ëª©í‘œ</div>
              <select class="border rounded p-2 text-sm w-full" id="growthTarget"></select>
            </div>
            <button type="button"
              class="w-full add-btn mt-3 bg-gray-200 text-sm px-3 py-2 rounded hover:bg-blue-300 text-black"
              data-section="growth">ì¶”ê°€</button>
          </div>
        </div>

        <!-- ì¢Œ: ì„ íƒëª©ë¡ / ìš°: ê²°ê³¼ -->
        <div class="grid md:grid-cols-2 gap-3">
          <div class="bg-white border rounded-xl shadow-sm p-3" id="addedList">
            <div class="flex justify-between items-center mb-2">
              <h2 class="text-base font-bold text-gray-700">ğŸ“‹ ì„ íƒëœ ì—°êµ¬ ëª©ë¡</h2>
              <div class="flex gap-x-2">
                <button id="calculateFromList" class="text-blue-500 text-sm hover:underline">ğŸ“Š ê³„ì‚°í•˜ê¸°</button>
                <button id="clearList" class="text-sm text-red-600 hover:underline">ğŸ§¹ ëª©ë¡ ì´ˆê¸°í™”</button>
              </div>
            </div>
            <div class="space-y-1 text-sm" id="listContainer"></div>
          </div>

          <div class="bg-white border rounded-xl shadow-sm p-3" id="resultCard">
            <div class="flex items-center justify-between">
              <h2 class="text-base font-bold text-gray-700">ğŸ“ˆ ê³„ì‚° ê²°ê³¼</h2>
            </div>
            <div id="resultContainer" class="mt-2 overflow-auto">
              <div class="text-sm text-gray-600">í•­ëª©ì„ ì¶”ê°€í•˜ê³  <span class="font-semibold">[ğŸ“Š ê³„ì‚°í•˜ê¸°]</span>ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<script>
  (function () {
    // âœ… SPA ì¬ì§„ì…/ì¬ë¡œë“œ ì‹œ ì´ë²¤íŠ¸ ì¤‘ë³µ ë°”ì¸ë”© ë°©ì§€
    if (window.__RESEARCH_INIT_BOUND__) {
      // ì´ë¯¸ ì´ˆê¸°í™”ëœ ìƒíƒœë©´ ê·¸ëƒ¥ ì‹¤í–‰ë§Œ(í•„ìš” ì‹œ)
      window.ResearchInit?.();
      return;
    }
    window.__RESEARCH_INIT_BOUND__ = true;

    window.ResearchInit = function ResearchInit() {

      // =========================
      //  Toggle Buttons
      // =========================
      function setBtn(btn, on) {
        btn.classList.toggle('is-on', !!on);
        btn.setAttribute('aria-pressed', on ? 'true' : 'false');
      }

      function syncGroup(group) {
        document.querySelectorAll(`.toggle-btn[data-group="${group}"]`).forEach(b => {
          const c = document.getElementById(b.dataset.toggle);
          if (c) setBtn(b, c.checked);
        });
      }

      document.querySelectorAll('.toggle-btn').forEach(btn => {
        // ì´ˆê¸° í‘œì‹œ ë™ê¸°í™”
        const initChk = document.getElementById(btn.dataset.toggle);
        if (initChk) setBtn(btn, initChk.checked);

        btn.addEventListener('click', () => {
          const chk = document.getElementById(btn.dataset.toggle);
          if (!chk) return;

          const group = btn.dataset.group || '';

          // âœ… vp: íƒ1(ë¼ë””ì˜¤ì²˜ëŸ¼) + ë‹¤ì‹œ ëˆ„ë¥´ë©´ í•´ì œ ê°€ëŠ¥
          if (group === 'vp') {
            const wasOn = chk.checked;

            // ì „ì²´ OFF
            document.querySelectorAll('.toggle-btn[data-group="vp"]').forEach(b => {
              const c = document.getElementById(b.dataset.toggle);
              if (c) c.checked = false;
              setBtn(b, false);
            });

            // ì´ì „ OFFë©´ ON, ì´ì „ ONì´ë©´ OFF
            chk.checked = !wasOn;
            setBtn(btn, chk.checked);

            chk.dispatchEvent(new Event('change', { bubbles: true }));
            syncGroup('vp');
            return;
          }

          // âœ… server: ë‹¨ì¼ í† ê¸€(ì¬í´ë¦­ í•´ì œ)
          if (group === 'server') {
            chk.checked = !chk.checked;
            setBtn(btn, chk.checked);
            chk.dispatchEvent(new Event('change', { bubbles: true }));
            return;
          }

          // âœ… ê¸°íƒ€: ì¼ë°˜ í† ê¸€
          chk.checked = !chk.checked;
          setBtn(btn, chk.checked);
          chk.dispatchEvent(new Event('change', { bubbles: true }));
        });
      });

      // =========================
      //  Common Helpers
      // =========================
      function setupAutoTargetLevel(currentId, targetId) {
        const cur = document.getElementById(currentId);
        const tgt = document.getElementById(targetId);
        if (!cur || !tgt) return;

        cur.addEventListener("change", () => {
          const currentVal = parseInt(cur.value, 10);
          const options = Array.from(tgt.options).map(opt => parseInt(opt.value, 10));
          const nextVal = options.find(val => val > currentVal);
          if (nextVal !== undefined) tgt.value = String(nextVal);
        });
      }

      function fetchResearchCSV(url, typeId, currentId, targetId) {
        const map = new Map();
        const selectType = document.getElementById(typeId);
        const selectCurrent = document.getElementById(currentId);
        const selectTarget = document.getElementById(targetId);
        if (!selectType || !selectCurrent || !selectTarget) return;

        fetch(url)
          .then(res => res.text())
          .then(text => {
            const lines = text.split("\n").map(l => l.trim()).filter(Boolean);
            if (!lines.length) return;

            const headers = lines[0].split(",");
            const nameIdx = headers.indexOf("ì—°êµ¬");
            if (nameIdx < 0) return;

            for (let i = 1; i < lines.length; i++) {
              const cols = lines[i].split(",");
              const fullName = cols[nameIdx];
              if (!fullName || !fullName.includes("-")) continue;

              const [type, levelStr] = fullName.split("-");
              const level = parseInt(levelStr, 10);
              if (!type || !Number.isFinite(level)) continue;

              if (!map.has(type)) map.set(type, []);
              const levels = map.get(type);
              if (!levels.includes(level)) levels.push(level);
            }

            selectType.innerHTML = "";
            Array.from(map.keys()).forEach(type => selectType.appendChild(new Option(type, type)));

            function fillLevels() {
              const levels = (map.get(selectType.value) || []).sort((a, b) => a - b);
              selectCurrent.innerHTML = "";
              selectTarget.innerHTML = "";
              levels.forEach(lv => {
                selectCurrent.appendChild(new Option(lv, lv));
                selectTarget.appendChild(new Option(lv, lv));
              });
            }

            selectType.addEventListener("change", fillLevels);
            selectType.dispatchEvent(new Event("change"));
          })
          .catch(() => { /* ignore */ });
      }

      function cleanInt(str) {
        return parseInt((str || "0").replace(/,/g, ""), 10) || 0;
      }

      function formatResource(value) {
        value = Number(value) || 0;
        if (value >= 1_000_000_000) return (value / 1_000_000_000).toFixed(2).replace(/\.00$/, '') + 'B';
        if (value >= 1_000_000) return (value / 1_000_000).toFixed(2).replace(/\.00$/, '') + 'M';
        if (value >= 1_000) return value.toLocaleString();
        return String(value);
      }

      function parseTimeToSeconds(timeStr) {
        // í˜•ì‹: "Xd HH:MM:SS" ë˜ëŠ” "X HH:MM:SS"
        const parts = (timeStr || "").trim().split(" ");
        let d = 0, hms = "00:00:00";

        if (parts.length === 2) {
          d = parseInt(parts[0], 10) || 0;
          hms = parts[1] || "00:00:00";
        } else if (parts.length === 1) {
          // í˜¹ì‹œ "0d 00:00:00" ê°™ì´ ë“¤ì–´ì˜¬ ë•Œ ëŒ€ë¹„
          if (parts[0].includes(":")) hms = parts[0];
          else d = parseInt(parts[0], 10) || 0;
        }

        const [h, m, s] = (hms || "00:00:00").split(":").map(x => parseInt(x, 10) || 0);
        return d * 86400 + h * 3600 + m * 60 + s;
      }

      function formatTime(sec) {
        sec = Math.max(0, Math.round(Number(sec) || 0));
        const d = Math.floor(sec / 86400); sec %= 86400;
        const h = Math.floor(sec / 3600); sec %= 3600;
        const m = Math.floor(sec / 60);
        const s = sec % 60;
        return `${d}d ${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
      }

      // sendHeightToParent ì—†ìœ¼ë©´ ì•ˆì „í•˜ê²Œ noop
      const sendHeightToParentSafe = (typeof window.sendHeightToParent === "function")
        ? window.sendHeightToParent
        : function () { };

      // =========================
      //  Data Binding (CSV)
      // =========================
      fetchResearchCSV(
        "https://raw.githubusercontent.com/s574shinchan/WOS_Calc/refs/heads/main/data/research/Battle.csv",
        "researchType", "currentLevel", "targetLevel"
      );
      setupAutoTargetLevel("currentLevel", "targetLevel");

      fetchResearchCSV(
        "https://raw.githubusercontent.com/s574shinchan/WOS_Calc/refs/heads/main/data/research/Economy.csv",
        "economyType", "economyCurrent", "economyTarget"
      );
      setupAutoTargetLevel("economyCurrent", "economyTarget");

      fetchResearchCSV(
        "https://raw.githubusercontent.com/s574shinchan/WOS_Calc/refs/heads/main/data/research/Growth.csv",
        "growthType", "growthCurrent", "growthTarget"
      );
      setupAutoTargetLevel("growthCurrent", "growthTarget");

      // =========================
      //  Add / Remove List Items
      // =========================
      document.querySelectorAll(".add-btn").forEach(button => {
        button.addEventListener("click", () => {
          const section = button.dataset.section;
          let typeSelect, currentSelect, targetSelect, sectionLabel;

          if (section === "battle") {
            typeSelect = document.getElementById("researchType");
            currentSelect = document.getElementById("currentLevel");
            targetSelect = document.getElementById("targetLevel");
            sectionLabel = "ì „íˆ¬";
          } else if (section === "economy") {
            typeSelect = document.getElementById("economyType");
            currentSelect = document.getElementById("economyCurrent");
            targetSelect = document.getElementById("economyTarget");
            sectionLabel = "ê²½ì œ";
          } else if (section === "growth") {
            typeSelect = document.getElementById("growthType");
            currentSelect = document.getElementById("growthCurrent");
            targetSelect = document.getElementById("growthTarget");
            sectionLabel = "ë°œì „";
          } else return;

          const type = typeSelect?.value;
          const current = currentSelect?.value;
          const target = targetSelect?.value;

          if (!type || !current || !target || parseInt(current, 10) >= parseInt(target, 10)) {
            alert("ìœ íš¨í•œ ì—°êµ¬ í•­ëª©ê³¼ ë ˆë²¨ì„ ì„ íƒí•˜ì„¸ìš”.");
            return;
          }

          // ì¤‘ë³µ ë°©ì§€
          const exists = Array.from(document.querySelectorAll("#listContainer span"))
            .some(el => el.textContent === `[${sectionLabel}] ${type} : ${current} â†’ ${target}`);
          if (exists) { alert("ì´ë¯¸ ì¶”ê°€ëœ í•­ëª©ì…ë‹ˆë‹¤."); return; }

          const row = document.createElement("div");
          row.className = "flex justify-between items-center p-2 rounded border";
          row.innerHTML = `
            <span class="font-semibold">[${sectionLabel}] ${type} : ${current} â†’ ${target}</span>
            <button type="button" class="text-xs text-red-500 hover:underline remove-btn">ì‚­ì œ</button>
          `;
          document.getElementById("listContainer")?.appendChild(row);

          row.querySelector(".remove-btn")?.addEventListener("click", () => {
            row.remove();
            sendHeightToParentSafe();
          });

          sendHeightToParentSafe();
        });
      });

      // =========================
      //  Clear
      // =========================
      document.getElementById("clearList")?.addEventListener("click", () => {
        const list = document.getElementById("listContainer");
        const result = document.getElementById("resultContainer");
        if (list) list.innerHTML = "";
        if (result) {
          result.innerHTML =
            `<div class="text-sm text-gray-500">í•­ëª©ì„ ì¶”ê°€í•˜ê³  <span class="font-semibold">[ğŸ“Š ê³„ì‚°í•˜ê¸°]</span>ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>`;
        }
        sendHeightToParentSafe();
      });

      // =========================
      //  Calculate
      // =========================
      document.getElementById("calculateFromList")?.addEventListener("click", () => {
        const rows = document.querySelectorAll("#listContainer div");
        if (!rows.length) { alert("ê³„ì‚°í•  ì—°êµ¬ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤."); return; }

        let total = { ê³ ê¸°: 0, ëª©ì¬: 0, ì„íƒ„: 0, ì² ê´‘: 0, ì² ê°•ì¬: 0, ì‹œê°„: 0 };
        const tasks = [];

        // ì†ë„(ì‹œê°„ ë‹¨ì¶•) ê³„ìˆ˜
        let factor = (parseFloat(document.getElementById("speedPercent")?.value) || 0) * 0.01 + 1;
        if (document.getElementById("chkVP10")?.checked) factor += 0.10;
        if (document.getElementById("chkVP15")?.checked) factor += 0.15;
        if (document.getElementById("chkServerBuff")?.checked) factor += 0.10;

        rows.forEach(row => {
          const text = row.querySelector("span")?.textContent || "";
          const m = text.match(/\[(.*?)\]\s(.*?)\s:\s(\d+)\sâ†’\s(\d+)/);
          if (!m) return;

          const [, section, type, start, end] = m;
          const s = parseInt(start, 10);
          const e = parseInt(end, 10);

          const urlMap = { "ì „íˆ¬": "Battle.csv", "ê²½ì œ": "Economy.csv", "ë°œì „": "Growth.csv" };
          const file = urlMap[section];
          if (!file) return;

          const url = `https://raw.githubusercontent.com/s574shinchan/WOS_Calc/refs/heads/main/data/research/${file}`;

          tasks.push(
            fetch(url)
              .then(res => res.text())
              .then(text => {
                const lines = text.split("\n").map(l => l.trim()).filter(Boolean);
                if (!lines.length) return "";

                const headers = lines[0].split(",");
                const idx = {
                  ì—°êµ¬: headers.indexOf("ì—°êµ¬"),
                  ê³ ê¸°: headers.indexOf("ê³ ê¸°"),
                  ëª©ì¬: headers.indexOf("ëª©ì¬"),
                  ì„íƒ„: headers.indexOf("ì„íƒ„"),
                  ì² ê´‘: headers.indexOf("ì² ê´‘"),
                  ì² ê°•ì¬: headers.indexOf("ì² ê°•ì¬"),
                  ì‹œê°„: headers.indexOf("ì‹œê°„")
                };
                if (idx.ì—°êµ¬ < 0) return "";

                let sum = { ê³ ê¸°: 0, ëª©ì¬: 0, ì„íƒ„: 0, ì² ê´‘: 0, ì² ê°•ì¬: 0, ì‹œê°„: 0 };

                for (let i = 1; i < lines.length; i++) {
                  const cols = lines[i].split(",");
                  const name = cols[idx.ì—°êµ¬];
                  if (!name) continue;

                  const m2 = name.match(/^(.*)-(\d+)$/);
                  if (!m2) continue;

                  const fullType = m2[1];
                  const level = parseInt(m2[2], 10);
                  if (fullType !== type) continue;

                  if (level > s && level <= e) {
                    sum.ê³ ê¸° += cleanInt(cols[idx.ê³ ê¸°]);
                    sum.ëª©ì¬ += cleanInt(cols[idx.ëª©ì¬]);
                    sum.ì„íƒ„ += cleanInt(cols[idx.ì„íƒ„]);
                    sum.ì² ê´‘ += cleanInt(cols[idx.ì² ê´‘]);
                    sum.ì² ê°•ì¬ += cleanInt(cols[idx.ì² ê°•ì¬]);
                    sum.ì‹œê°„ += parseTimeToSeconds(cols[idx.ì‹œê°„]);
                  }
                }

                total.ê³ ê¸° += sum.ê³ ê¸°;
                total.ëª©ì¬ += sum.ëª©ì¬;
                total.ì„íƒ„ += sum.ì„íƒ„;
                total.ì² ê´‘ += sum.ì² ê´‘;
                total.ì² ê°•ì¬ += sum.ì² ê°•ì¬;
                total.ì‹œê°„ += sum.ì‹œê°„;

                return `
                  <tr class="bg-white">
                    <td class="border p-1 font-medium">${type}</td>
                    <td class="border p-1">${s} â†’ ${e}</td>
                    <td class="border p-1">${formatResource(sum.ê³ ê¸°)}</td>
                    <td class="border p-1">${formatResource(sum.ëª©ì¬)}</td>
                    <td class="border p-1">${formatResource(sum.ì„íƒ„)}</td>
                    <td class="border p-1">${formatResource(sum.ì² ê´‘)}</td>
                    <td class="border p-1">${formatResource(sum.ì² ê°•ì¬)}</td>
                    <td class="border p-1">${formatTime(sum.ì‹œê°„)}</td>
                    <td class="border p-1">${formatTime(Math.round(sum.ì‹œê°„ / factor))}</td>
                  </tr>`;
              })
              .catch(() => "")
          );
        });

        Promise.all(tasks).then(tableRows => {
          const html = `
            <table class="w-full border text-sm text-center table-auto">
              <thead class="bg-blue-100">
                <tr>
                  <th class="border p-1">ì—°êµ¬í•­ëª©</th>
                  <th class="border p-1">ë ˆë²¨</th>
                  <th class="border p-1">ê³ ê¸°</th>
                  <th class="border p-1">ëª©ì¬</th>
                  <th class="border p-1">ì„íƒ„</th>
                  <th class="border p-1">ì² ê´‘</th>
                  <th class="border p-1">ì² ê°•ì¬</th>
                  <th class="border p-1">ì—°êµ¬ì‹œê°„</th>
                  <th class="border p-1">ì ìš©ì‹œê°„</th>
                </tr>
              </thead>
              <tbody>${tableRows.filter(Boolean).join("")}</tbody>
              <tfoot class="bg-gray-100 font-semibold">
                <tr>
                  <td class="border p-1" colspan="2">ì´í•©</td>
                  <td class="border p-1">${formatResource(total.ê³ ê¸°)}</td>
                  <td class="border p-1">${formatResource(total.ëª©ì¬)}</td>
                  <td class="border p-1">${formatResource(total.ì„íƒ„)}</td>
                  <td class="border p-1">${formatResource(total.ì² ê´‘)}</td>
                  <td class="border p-1">${formatResource(total.ì² ê°•ì¬)}</td>
                  <td class="border p-1">${formatTime(total.ì‹œê°„)}</td>
                  <td class="border p-1">${formatTime(Math.round(total.ì‹œê°„ / factor))}</td>
                </tr>
              </tfoot>
            </table>
          `;
          const result = document.getElementById("resultContainer");
          if (result) result.innerHTML = html;
          sendHeightToParentSafe();
        });
      });
    };

    // âœ… ì¦‰ì‹œ ì‹¤í–‰
    window.ResearchInit();
  })();
</script>
