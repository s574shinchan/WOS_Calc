<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ê³°ì‚¬ëƒ¥ ë¶€ëŒ€ ê³„ì‚°ê¸°</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* ë‹¤í¬ëª¨ë“œ (ì„ íƒ) */
    body.dark-mode { background:#121212; color:#f0f0f0; }
    .dark-mode .card { background:#1f1f1f; border-color:#2a2a2a; }
    .dark-mode input, .dark-mode select { color:#000; }
    /* ì¹´ë“œ ê³µí†µ */
    .card{
      background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:14px;
      box-shadow:0 6px 18px rgba(15,23,42,.06)
    }
    .section-title{ font-weight:700; color:#334155 }
    .subtle{ color:#64748b; font-size:12px }
    .field-label{ font-size:12px; color:#475569 }
    .num{ font-variant-numeric: tabular-nums }
  </style>

  <script>
    // ë‹¤í¬ëª¨ë“œ ìœ ì§€(ì˜µì…˜)
    window.addEventListener('DOMContentLoaded', () => {
      if (localStorage.getItem('darkMode') === 'true') document.body.classList.add('dark-mode');
    });
  </script>
</head>
<body class="bg-gray-100 p-2 font-sans text-sm">
  <div class="max-w-[1500px] mx-auto bg-white p-3 rounded-xl shadow-md">
    <h1 class="text-2xl font-bold text-gray-800 mb-4">ğŸ» ê³°ì‚¬ëƒ¥ ë¶€ëŒ€ ê³„ì‚°ê¸°</h1>

    <!-- ìƒ: ì‚¬ìš©ì ì…ë ¥í•­ëª© -->
    <section class="card p-4 mb-2">
      <h2 class="section-title mb-3">ì‚¬ìš©ì ì…ë ¥</h2>
    
      <!-- ìœ—ì¤„: 4ì¹¸ -->
      <div class="grid grid-cols-1 lg:grid-cols-4 gap-4">
        <div>
          <label class="field-label">ì¶œì •ë¶€ëŒ€ ìˆ˜ìš©ëŸ‰(ê¸°ë³¸)</label>
          <input id="baseMarch" type="text"
                 class="w-full border rounded-md p-2"
                 oninput="UI.formatNumberInput(this); Calc.updateCapacityAndTable()"/>
        </div>
    
        <div>
          <label class="field-label">ì´ ë³´ìœ  ë°©íŒ¨ë³‘</label>
          <input id="ownInf" type="text"
                 class="w-full border rounded-md p-2"
                 oninput="UI.formatNumberInput(this); Calc.updateTableOnly()"/>
        </div>
    
        <div>
          <label class="field-label">ì´ ë³´ìœ  ì°½ë³‘</label>
          <input id="ownLan" type="text"
                 class="w-full border rounded-md p-2"
                 oninput="UI.formatNumberInput(this); Calc.updateTableOnly()"/>
        </div>
    
        <div>
          <label class="field-label">ì´ ë³´ìœ  ê¶ë³‘</label>
          <input id="ownMar" type="text"
                 class="w-full border rounded-md p-2"
                 oninput="UI.formatNumberInput(this); Calc.updateTableOnly()"/>
        </div>
      </div>
    
      <!-- ì•„ë«ì¤„: 4ì¹¸ -->
      <div class="grid grid-cols-1 lg:grid-cols-5 gap-4 mt-3">
        <div>
          <label class="field-label">ì´ í–‰êµ° ìˆ˜</label>
          <input id="marchCount" type="text"
                 class="w-full border rounded-md p-2"
                 oninput="UI.formatNumberInput(this); Calc.updateTableOnly()"/>
        </div>
    
        <div>
          <label class="field-label">ì ìš© ë¹„ìœ¨ ì„ íƒ</label>
          <select id="ratioPreset" class="w-full border rounded-md p-2"
                  onchange="UI.onPresetChange()">
            <option value="34/33/33">34 / 33 / 33</option>
            <option value="20/40/40">20 / 40 / 40</option>
            <option value="10/10/80">10 / 10 / 80</option>
            <option value="60/40/0">60 / 40 / 0</option>
            <option value="50/20/30">50 / 20 / 30</option>
            <option value="custom">ì‚¬ìš©ì ì§€ì •</option>
          </select>
        </div>
    
        <div>
          <label class="field-label">ë°©íŒ¨(%)</label>
          <input id="ratioInf" type="text"
                 class="w-full border rounded-md p-2"
                 oninput="UI.formatNumberInput(this); Calc.updateTableOnly()" disabled/>
        </div>
    
        <div>
          <label class="field-label">ì°½(%)</label>
          <input id="ratioLan" type="text"
                 class="w-full border rounded-md p-2"
                 oninput="UI.formatNumberInput(this); Calc.updateTableOnly()" disabled/>
        </div>
        <div>
          <label class="field-label">ê¶(%)</label>
          <input id="ratioMar" type="text"
                 class="w-full border rounded-md p-2"
                 oninput="UI.formatNumberInput(this); Calc.updateTableOnly()" disabled/>
        </div>
      </div>
    </section>

    <!-- ì¤‘: ë²„í”„ ì„ íƒ -->
    <section class="card p-4  mb-2">
      <h2 class="section-title mb-3">ë²„í”„ ì„ íƒ</h2>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- ë„ì‹œ ë²„í”„ -->
        <div class="space-y-2">
          <div class="font-semibold text-slate-800">ë„ì‹œ ë²„í”„</div>
          <label class="flex items-center gap-2">
            <input type="radio" name="cityBuff" value="0" checked
                   onchange="Calc.updateCapacityAndTable()"/>
            ì—†ìŒ
          </label>
          <label class="flex items-center gap-2">
            <input type="radio" name="cityBuff" value="10"
                   onchange="Calc.updateCapacityAndTable()"/>
            ì¶œì • ìˆ˜ìš©ëŸ‰ ì¦ê°€ 2h (+10%)
          </label>
          <label class="flex items-center gap-2">
            <input type="radio" name="cityBuff" value="20"
                   onchange="Calc.updateCapacityAndTable()"/>
            ì¶œì • ìˆ˜ìš©ëŸ‰ ì¦ê°€ 12h (+20%)
          </label>
        </div>

        <!-- í”„ë¡œìŠ¤íƒ€ ê³ ë¦´ë¼ -->
        <div class="space-y-2">
          <div class="font-semibold text-slate-800">í« ë²„í”„</div>
          <label class="flex items-center gap-2">
            <input id="chkGorilla" type="checkbox"
	         onchange="UI.toggle('gorillaWrap', this.checked); Calc.updateCapacityAndTable()"/>
            í”„ë¡œìŠ¤íƒ€ ê³ ë¦´ë¼ ë²„í”„
          </label>
          <div id="gorillaWrap" class="grid grid-cols-2 gap-2 hidden">
            <select id="gorillaLv" class="border rounded-md p-2"
                    onchange="Calc.updateCapacityAndTable()">
              <option value="0">Lv.0</option>
              <option value="1">Lv.1</option>
              <option value="2">Lv.2</option>
              <option value="3">Lv.3</option>
              <option value="4">Lv.4</option>
              <option value="5">Lv.5</option>
              <option value="6">Lv.6</option>
              <option value="7">Lv.7</option>
              <option value="8">Lv.8</option>
              <option value="9">Lv.9</option>
              <option value="10" selected>Lv.10</option>
            </select>
          </div>
        </div>

        <!-- ì „ë¬¸ê°€(í‚¤ë¦´) -->
        <div class="space-y-2">
          <div class="font-semibold text-slate-800">ì „ë¬¸ê°€ ë²„í”„</div>
          <div class="flex items-center gap-2">
            <input id="chkExpert" type="checkbox"
                   onchange="UI.toggle('expertBox', this.checked); Calc.updateCapacityAndTable()"/>
            <div class="font-semibold text-slate-800">ì „ë¬¸ê°€(í‚¤ë¦´)</div>
          </div>

          <div id="expertBox" class="grid gap-3 mt-1 hidden">
            <!-- ê³°ì˜ì²œì  (ì¶œì • ìˆ˜ìš©ëŸ‰ +n) -->
            <div class="grid grid-cols-2 gap-2">
              <div class="self-center">ê³°ì˜ì²œì </div>
              <select id="nemLv" class="border rounded-md p-2"
                      onchange="Calc.updateCapacityAndTable()">
                <option value="0" selected>Lv.0</option>
                <option value="1">Lv.1</option>
                <option value="2">Lv.2</option>
                <option value="3">Lv.3</option>
                <option value="4">Lv.4</option>
                <option value="5">Lv.5</option>
                <option value="6">Lv.6</option>
                <option value="7">Lv.7</option>
                <option value="8">Lv.8</option>
                <option value="9">Lv.9</option>
                <option value="10">Lv.10</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- í•˜: ê²°ê³¼ -->
    <section class="card p-4">
      <h2 class="section-title mb-3">ê²°ê³¼</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-2">
        <div>
          <label class="field-label">ì¶œì •ë¶€ëŒ€ ìˆ˜ìš©ëŸ‰ (ë²„í”„ ì ìš©)</label>
          <input id="finalMarch" type="text" readonly
                 class="w-full border rounded-md p-2 bg-gray-100 num"/>
        </div>
        <div>
          <label class="field-label">ì¶œì • ìˆ˜ìš©ëŸ‰ ë³´ë„ˆìŠ¤ (í‚¤ë¦´Â·ê³°ì˜ì²œì )</label>
          <input id="MarchBonus" type="text" readonly
                 class="w-full border rounded-md p-2 bg-gray-100 num" />
        </div>
      </div>

      <div class="overflow-x-auto">
        <table class="w-full border border-gray-200">
          <thead class="bg-orange-50 text-slate-700">
            <tr class="text-center">
              <th class="border px-2 py-1">í–‰êµ°</th>
              <th class="border px-2 py-1">ë°©íŒ¨ë³‘</th>
              <th class="border px-2 py-1">ì°½ë³‘</th>
              <th class="border px-2 py-1">ê¶ë³‘</th>
            </tr>
          </thead>
          <tbody id="resultTbody">
            <tr><td class="border text-center p-2" colspan="4">ê²°ê³¼ ì—†ìŒ</td></tr>
          </tbody>
        </table>
      </div>
    </section>
  </div>

  <!-- ========================= ìŠ¤í¬ë¦½íŠ¸ ========================= -->
  <script>
    /* ------------------------- ìƒìˆ˜/í…Œì´ë¸” ------------------------- */
    const GorillaPerLevel = 1500; // ì„¤ëª… í…ìŠ¤íŠ¸ìš©(ì„ì˜ í‘œì‹œ)
    const ExpertNemesis = { // ê³°ì˜ì²œì (ì¶œì • ìˆ˜ìš©ëŸ‰ +)
      0:0, 1:3000, 2:6000, 3:9000, 4:12000, 5:15000,6:18000, 7:21000, 8:24000, 9:27000, 10:30000
    };

    /* ------------------------- UI ìœ í‹¸ ------------------------- */
    const UI = {
      // "1,234" í˜•ì‹ ì…ë ¥ ë³´ì •
      formatNumberInput(el){
        const raw = (el.value || '').replace(/,/g,'').replace(/[^\d]/g,'');
        if (raw === '') { el.value = ''; return; }
        el.value = Number(raw).toLocaleString();
      },
      // ë³´ì´ê¸°/ìˆ¨ê¸°ê¸°
      toggle(id, show){ document.getElementById(id).classList.toggle('hidden', !show); },
      // í”„ë¦¬ì…‹ ë³€ê²½ ì‹œ ì‚¬ìš©ì ì…ë ¥ í™œì„±/ë¹„í™œì„±
      onPresetChange(){
        const val = document.getElementById('ratioPreset').value;
        const custom = (val === 'custom');
        ['ratioInf','ratioLan','ratioMar'].forEach(id=>{
          const el = document.getElementById(id);
          el.disabled = !custom;
          if (!custom) el.value = '';
        });
        // í”„ë¦¬ì…‹ì´ë©´ ë°”ë¡œ í…Œì´ë¸” ì—…ë°ì´íŠ¸
        Calc.updateTableOnly();
      }
    };

    /* ------------------------- ê³„ì‚° ë¡œì§ ------------------------- */
    const Calc = {
      // í˜„ì¬ ì„ íƒëœ ë¹„ìœ¨(%) ë°˜í™˜
      getRatios(){
        const preset = document.getElementById('ratioPreset').value;
        if (preset !== 'custom'){
          const [i,l,m] = preset.split('/').map(Number);
          return { inf:i, lan:l, mar:m };
        }
        const inf = Number((document.getElementById('ratioInf').value||'').replace(/,/g,''))||0;
        const lan = Number((document.getElementById('ratioLan').value||'').replace(/,/g,''))||0;
        const mar = Number((document.getElementById('ratioMar').value||'').replace(/,/g,''))||0;
        // 100% ì•ˆì „ì¥ì¹˜
        const sum = inf+lan+mar;
        return sum>0 ? {inf,lan,mar} : {inf:34,lan:33,mar:33};
      },

      // ë„ì‹œ ë²„í”„ ë°°ìˆ˜
      cityMultiplier(){
        const sel = document.querySelector('input[name="cityBuff"]:checked');
        const pct = sel ? Number(sel.value) : 0;
        return 1 + (pct/100);
      },

      // ìµœì¢… 'ì¶œì •ë¶€ëŒ€ ìˆ˜ìš©ëŸ‰' ê³„ì‚°
      finalMarchCapacity(){
        const base = Number((document.getElementById('baseMarch').value||'').replace(/,/g,''))||0;
        const gorillaOn = document.getElementById('chkGorilla').checked;
        const gorillaLv = Number(document.getElementById('gorillaLv').value||0);

        const expertOn = document.getElementById('chkExpert').checked;
        const nemLv = Number(document.getElementById('nemLv').value||0);
        const expertMarchBonus = expertOn ? ExpertNemesis[nemLv] : 0;

        // ì„¤ëª…ì—ëŠ” ê³ ë¦´ë¼ê°€ "í‘œì‹œìš©"ì´ë¼ í–ˆì§€ë§Œ, íš¨ê³¼ë¥¼ ì¶œì • ìˆ˜ìš©ëŸ‰ì— ë”í•´ë„ ë¬´ë°©í•˜ë©´ ì•„ë˜ ì£¼ì„ì„ í•´ì œ.
        const gorillaFlat = gorillaOn ? gorillaLv*GorillaPerLevel : 0;

        // ë„ì‹œ ë²„í”„ ë°°ìˆ˜
        const mult = Calc.cityMultiplier();

        // ìµœì¢…: (ê¸°ë³¸ + ì „ë¬¸ê°€ ë³´ë„ˆìŠ¤) * ë„ì‹œë°°ìˆ˜
        // í•„ìš” ì‹œ + gorillaFlat ì¶”ê°€ ê°€ëŠ¥
        return Math.floor((base + gorillaFlat +expertMarchBonus) * mult);
      },

      // í‘œ ë Œë”
      renderTable(capacity){
        const tbody = document.getElementById('resultTbody');
        const marches = Number((document.getElementById('marchCount').value||'').replace(/,/g,''))||0;
        if (!capacity || !marches){
          tbody.innerHTML = `<tr><td class="border text-center p-2" colspan="4">ê²°ê³¼ ì—†ìŒ</td></tr>`;
          return;
        }

        const {inf,lan,mar} = Calc.getRatios();
        let html = '', sumI=0,sumL=0,sumM=0;

        for (let i=1;i<=marches;i++){
          const vI = Math.floor(capacity * inf / 100);
          const vL = Math.floor(capacity * lan / 100);
          const vM = Math.floor(capacity * mar / 100);
          sumI+=vI; sumL+=vL; sumM+=vM;

          html+=`<tr class="text-center">
            <td class="border px-2 py-1">${i}</td>
            <td class="border px-2 py-1 num">${vI.toLocaleString()}</td>
            <td class="border px-2 py-1 num">${vL.toLocaleString()}</td>
            <td class="border px-2 py-1 num">${vM.toLocaleString()}</td>
          </tr>`;
        }

        // í•©ê³„ & ë‚¨ì€ê°’
        const ownI = Number((document.getElementById('ownInf').value||'').replace(/,/g,''))||0;
        const ownL = Number((document.getElementById('ownLan').value||'').replace(/,/g,''))||0;
        const ownM = Number((document.getElementById('ownMar').value||'').replace(/,/g,''))||0;

        html+=`<tr class="bg-gray-100 font-semibold text-center">
          <td class="border px-2 py-1">í•©ê³„</td>
          <td class="border px-2 py-1 num">${sumI.toLocaleString()}</td>
          <td class="border px-2 py-1 num">${sumL.toLocaleString()}</td>
          <td class="border px-2 py-1 num">${sumM.toLocaleString()}</td>
        </tr>
        <tr class="bg-yellow-50 font-semibold text-center">
          <td class="border px-2 py-1">ë‚¨ì€ê°’</td>
          <td class="border px-2 py-1 num">${(ownI-sumI).toLocaleString()}</td>
          <td class="border px-2 py-1 num">${(ownL-sumL).toLocaleString()}</td>
          <td class="border px-2 py-1 num">${(ownM-sumM).toLocaleString()}</td>
        </tr>`;

        tbody.innerHTML = html;
      },

      // ìƒë‹¨/ì¤‘ë‹¨ ë³€ê²½ ì‹œ ì „ì²´ ê°±ì‹ 
      updateCapacityAndTable(){
        const cap = Calc.finalMarchCapacity();
        document.getElementById('finalMarch').value = cap.toLocaleString();

        // ë³´ë„ˆìŠ¤ í‘œì‹œ
        const nm = document.getElementById('chkExpert').checked
          ? ExpertNemesis[ Number(document.getElementById('nemLv').value||0) ] : 0;
        document.getElementById('MarchBonus').value = nm.toLocaleString();

        Calc.renderTable(cap);
      },

      // í‘œë§Œ ê°±ì‹ (ë¹„ìœ¨/ë³´ìœ  ë³€ê²½ ë“±)
      updateTableOnly(){
        const cap = Calc.finalMarchCapacity();
        document.getElementById('finalMarch').value = cap.toLocaleString();
        Calc.renderTable(cap);
      }
    };

    /* ------------------------- ì´ë²¤íŠ¸ ë°”ì¸ë”© ------------------------- */
    // ì´ˆê¸° í”„ë¦¬ì…‹(34/33/33)
    document.addEventListener('DOMContentLoaded', ()=>{
      Calc.updateCapacityAndTable();

      // ì…ë ¥/ì„ íƒ ë³€í™” ì‹œ ìë™ ë°˜ì˜
      [
        'baseMarch','marchCount','ownInf','ownLan','ownMar',
        'ratioInf','ratioLan','ratioMar','gorillaLv','nemLv'
      ].forEach(id=>{
        const el = document.getElementById(id);
        if (el) el.addEventListener('input', ()=>Calc.updateCapacityAndTable());
        if (el) el.addEventListener('change', ()=>Calc.updateCapacityAndTable());
      });
    });
  </script>
  <script>
	  /* ìœ í‹¸ */
	  function sendHeightToParent(){ 
		  const h=document.body.scrollHeight+10; 
		  window.parent?.postMessage({type:"FRAME_CHANGE",height:h},"*"); 
	  }
    
    window.addEventListener("load", ()=> setTimeout(sendHeightToParent,100));
	  
    // F12, Ctrl+Shift+I, Ctrl+U ë“± ë°©ì§€
    document.onkeydown = function (e) {
      if (
        e.keyCode === 123 || // F12
        (e.ctrlKey && e.shiftKey && e.keyCode === 73) || // Ctrl+Shift+I
        (e.ctrlKey && e.shiftKey && e.keyCode === 74) || // Ctrl+Shift+J
        (e.ctrlKey && e.keyCode === 85) // Ctrl+U
      ) {
        e.preventDefault();
        return false;
      }
    };
  
    // ìš°í´ë¦­ ë°©ì§€
    document.addEventListener("contextmenu", (e) => e.preventDefault());
  </script>
</body>
</html>
