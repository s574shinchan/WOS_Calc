<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />  
  <script src="https://cdn.tailwindcss.com"></script>
  <title>ê³°ì‚¬ëƒ¥ ë¶€ëŒ€ ê³„ì‚°ê¸°</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f6f8;
      padding: 30px;
    }

    .container {
      max-width: 1000px;
      margin: auto;
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }

    .input-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      border: 2px solid #000;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
    }

    label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }

    input[type="text"], select {
      width: 100%;
      padding: 10px 15px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 14px;
      box-sizing: border-box;
    }

    input[readonly] {
      background-color: #f0f0f0;
    }

    .bottom-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 30px;
    }

    .ratio-inputs {
      background: #e9f0f7;
      padding: 10px;
      border-radius: 5px;
      margin-top: 10px;
    }

    .warning {
      color: red;
      font-weight: bold;
      display: none;
      margin-top: 5px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }

    th {
      background-color: #f0f0f0;
    }

    button {
      background-color: #3498db;
      color: white;
      padding: 12px 24px;
      border: none;
      font-size: 16px;
      margin-top: 10px;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #2c80b4;
    }

    @media (max-width: 768px) {
      .input-grid, .bottom-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body class="bg-gray-100 p-2 font-sans text-sm">
  <div class="max-w-6xl mx-auto bg-white p-2 rounded-xl shadow-md"> 
    <h1 class="text-2xl font-bold text-gray-800 mb-4">ğŸ» ê³°ì‚¬ëƒ¥ ë¶€ëŒ€ ê³„ì‚°ê¸°</h1>
    <div class="input-grid">
      <div>
        <label>ì¶œì •ë¶€ëŒ€ ìˆ˜ìš©ëŸ‰</label>
        <input type="text" id="baseMarch" oninput="formatInput(this); updateCalculatedCapacity()">
        <label>ì¶œì •ë¶€ëŒ€ ìˆ˜ìš©ëŸ‰ (ë²„í”„ì ìš© - ìë™ê³„ì‚°)</label>
        <input type="text" id="finalMarch" readonly>
        <label>ì´ í–‰êµ°ìˆ˜</label>
        <input type="text" id="marchCount" oninput="formatInput(this)">
      </div>
      <div>
        <label>ì´ ë³´ìœ  ë°©íŒ¨ë³‘</label>
        <input type="text" id="Infantry" oninput="formatInput(this)">
        <label>ì´ ë³´ìœ  ì°½ë³‘</label>
        <input type="text" id="Lancer" oninput="formatInput(this)">
        <label>ì´ ë³´ìœ  ê¶ë³‘</label>
        <input type="text" id="Marksmen" oninput="formatInput(this)">
        <label>ì´ ë³´ìœ  í—¬ë¦¬ì˜¤ìŠ¤ ë°©íŒ¨ë³‘</label>
        <input type="text" id="heliosInfantry" oninput="formatInput(this)">
        <label>ì´ ë³´ìœ  í—¬ë¦¬ì˜¤ìŠ¤ ì°½ë³‘</label>
        <input type="text" id="heliosLancer" oninput="formatInput(this)">
        <label>ì´ ë³´ìœ  í—¬ë¦¬ì˜¤ìŠ¤ ê¶ë³‘</label>
        <input type="text" id="heliosMarksmen" oninput="formatInput(this)">
      </div>
    </div>
    <div class="bottom-grid">
      <div>
        <strong>ë¹„ìœ¨ì ìš©</strong><br>
        <label><input type="radio" name="strategy" value="equal" checked onclick="toggleCustom(false)"> 34/33/33</label>
        <label><input type="radio" name="strategy" value="20/40/40" onclick="toggleCustom(false)"> 20/40/40</label>
        <label><input type="radio" name="strategy" value="10/30/60" onclick="toggleCustom(false)"> 10/30/60</label>
        <label><input type="radio" name="strategy" value="custom" onclick="toggleCustom(true)"> ì‚¬ìš©ìì§€ì •ë¹„ìœ¨</label>
  
        <div class="ratio-inputs" id="customRatio" style="display: none;">
          <label>ë°©íŒ¨ë³‘ (%)</label>
          <input type="text" id="ratioInf" oninput="formatInput(this); validateCustomRatio()">
          <label>ì°½ë³‘ (%)</label>
          <input type="text" id="ratioLan" oninput="formatInput(this); validateCustomRatio()">
          <label>ê¶ë³‘ (%)</label>
          <input type="text" id="ratioMar" oninput="formatInput(this); validateCustomRatio()">
          <div class="warning" id="ratioWarning">âš  ì´ 100%ê°€ ë˜ì–´ì•¼í•©ë‹ˆë‹¤.</div>
        </div>
      </div>

      <div>
        <strong>ë²„í”„</strong><br>
        <label><input type="checkbox" id="buffTumbling" onchange="toggleTumbling()">í”„ë¡œìŠ¤íƒ€ ê³ ë¦´ë¼ ë²„í”„</label>
        <div id="tumblingLevelGroup" style="display:none; margin-left: 0;">
          <label>ë²„í”„ë ˆë²¨</label>
          <select id="tumblingLevel" onchange="updateCalculatedCapacity()">
            <option value="0">ë²„í”„ì—†ìŒ</option>
            <option value="1">Lv.1</option>
            <option value="2">Lv.2</option>
            <option value="3">Lv.3</option>
            <option value="4">Lv.4</option>
            <option value="5">Lv.5</option>
            <option value="6">Lv.6</option>
            <option value="7">Lv.7</option>
            <option value="8">Lv.8</option>
            <option value="9">Lv.9</option>
            <option value="10">Lv.10</option>
          </select>
        </div>
        <label><input type="radio" name="cityBuff" value="0" checked> ë„ì‹œë²„í”„ ì—†ìŒ</label>
        <label><input type="radio" name="cityBuff" value="10"> ì¶œì • ìˆ˜ìš©ëŸ‰ì¦ê°€ 2h (+10%)</label>
        <label><input type="radio" name="cityBuff" value="20"> ì¶œì • ìˆ˜ìš©ëŸ‰ì¦ê°€ 12h (+20%)</label>
        <button type="button" onclick="calculate()" class="bg-blue-500 text-white mt-2 p-4 py-2 rounded hover:bg-blue-600">ê³„ì‚°í•˜ê¸°</button>
      </div>
  
      <div>
        <strong>ê²°ê³¼</strong>
        <table>
          <thead>
          <tr><th>í–‰êµ°</th><th>ë°©íŒ¨ë³‘</th><th>ì°½ë³‘</th><th>ê¶ë³‘</th></tr>
          </thead>
          <tbody id="resultBody">
          <tr><td colspan="4">ê²°ê³¼ ì—†ìŒ</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
  <script>
    function cleanValue(val) {
      return val.replace(/,/g, '');
    }
  
    function formatInput(el) {
      const value = cleanValue(el.value);
      if (!value) return el.value = '';
      el.value = parseInt(value).toLocaleString();
    }
  
    function toggleCustom(show) {
      document.getElementById('customRatio').style.display = show ? 'block' : 'none';
      document.getElementById('ratioWarning').style.display = 'none';
    }
  
    function validateCustomRatio() {
      const inf = parseFloat(cleanValue(document.getElementById('ratioInf').value)) || 0;
      const lan = parseFloat(cleanValue(document.getElementById('ratioLan').value)) || 0;
      const mar = parseFloat(cleanValue(document.getElementById('ratioMar').value)) || 0;
      document.getElementById('ratioWarning').style.display = (inf + lan + mar === 100) ? 'none' : 'block';
    }
  
    function toggleTumbling() {
      const show = document.getElementById("buffTumbling").checked;
      document.getElementById("tumblingLevelGroup").style.display = show ? "block" : "none";
      updateCalculatedCapacity();
    }
  
    function getTumblingValue() {
      if (!document.getElementById("buffTumbling").checked) return 0;
      const level = parseInt(document.getElementById("tumblingLevel").value) || 0;
      return level * 1500;
    }
  
    function getCityBuffMultiplier() {
      const selected = document.querySelector('input[name="cityBuff"]:checked');
      return selected ? 1 + (parseFloat(selected.value) / 100) : 1;
    }
  
    function updateCalculatedCapacity() {
      const baseInput = document.getElementById('baseMarch');
      const base = parseInt(cleanValue(baseInput.value)) || 0;
      let capacity = base + getTumblingValue();
      capacity *= getCityBuffMultiplier();
      document.getElementById('finalMarch').value = Math.floor(capacity).toLocaleString();
    }
  
    function calculate() {
      const base = parseInt(cleanValue(document.getElementById('baseMarch').value)) || 0;
      const marches = parseInt(cleanValue(document.getElementById('marchCount').value)) || 0;
  
      let capacity = base + getTumblingValue();
      capacity *= getCityBuffMultiplier();
      capacity = Math.floor(capacity);
      document.getElementById('finalMarch').value = capacity.toLocaleString();
  
      const strategy = document.querySelector('input[name="strategy"]:checked').value;
      let inf = 0, lan = 0, mar = 0;
  
      if (strategy === "equal") {
        inf = 34; lan = 33; mar = 33;
      } else if (strategy === "20/40/40") {
        inf = 20; lan = 40; mar = 40;
      } else if (strategy === "10/30/60") {
        inf = 10; lan = 30; mar = 60;
      } else {
        inf = parseFloat(cleanValue(document.getElementById('ratioInf').value)) || 0;
        lan = parseFloat(cleanValue(document.getElementById('ratioLan').value)) || 0;
        mar = parseFloat(cleanValue(document.getElementById('ratioMar').value)) || 0;
        if (inf + lan + mar !== 100) {
          alert("ì‚¬ìš©ì ì§€ì • ë¹„ìœ¨ì˜ í•©ì´ 100%ì—¬ì•¼ í•©ë‹ˆë‹¤.");
          return;
        }
      }
  
      let html = '';
      for (let i = 1; i <= marches; i++) {
        html += `<tr>
          <td>${i}</td>
          <td>${Math.floor(capacity * inf / 100).toLocaleString()}</td>
          <td>${Math.floor(capacity * lan / 100).toLocaleString()}</td>
          <td>${Math.floor(capacity * mar / 100).toLocaleString()}</td>
        </tr>`;
      }
      document.getElementById('resultBody').innerHTML = html;
    }
  </script>

  <script>
    function sendHeightToParent() {
      const height = document.body.scrollHeight;
      window.parent.postMessage({ type: "FRAME_CHANGE", height }, "*");
    }

    // í˜ì´ì§€ ìµœì´ˆ ë¡œë“œ ì‹œ
    window.addEventListener("load", () => {
      setTimeout(sendHeightToParent, 100); // ì•½ê°„ì˜ ë Œë”ë§ ëŒ€ê¸°
    });
    
    // ê° details í† ê¸€ ì‹œ ë†’ì´ ì¬ì „ì†¡
    document.querySelectorAll("details").forEach(detail => {
      detail.addEventListener("toggle", () => {
        // ì•½ê°„ ë”œë ˆì´ í›„ ì •í™•í•œ ë†’ì´ ì¸¡ì •
        setTimeout(sendHeightToParent, 300);
      });
    });
    
    function loadPage(page) {
      const isMobile = window.innerWidth <= 768;
      const height = isMobile ? "550px" : "345px"
      window.location.href = page;
      window.parent.postMessage({ type: "SET_FRAME_SIZE", height: height, width: "100%"}, "*");
    }
    
    document.addEventListener("contextmenu", event => event.preventDefault());
    document.addEventListener("keydown", function (e) {
      if (e.key === "F12" ||
          (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "J")) ||
          (e.ctrlKey && (e.key === "U" || e.key === "S")))
      {
        e.preventDefault();
      }
    });
  </script>
  
</body>
</html>
