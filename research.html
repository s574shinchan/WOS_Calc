<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì—°êµ¬ ê³„ì‚°ê¸°</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-2 font-sans text-sm">
  <div class="max-w-6xl mx-auto bg-white p-2 rounded-xl shadow-md">
    <button onclick="loadPage('menu.html')" class="mb-4 flex items-center text-blue-600 hover:underline">
      <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
      </svg>
      ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°
    </button>
    <h1 class="text-2xl font-bold text-gray-800 mb-6">ğŸ§ª í—¬ë¦¬ì˜¤ìŠ¤ ì—°êµ¬ ê³„ì‚°ê¸°</h1>
    <div class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-6" id="researchGrid"></div>
    <div class="grid grid-cols-2 gap-4 mb-4">
      <div><label class="block font-semibold">ë³´ìœ  ê°€ë£¨</label>
        <input type="number" id="own-ê°€ë£¨" class="w-full border rounded p-2" />
      </div>
      <div><label class="block font-semibold">ë³´ìœ  ì² ê°•ì¬</label>
        <input type="number" id="own-ì² ê°•ì¬" class="w-full border rounded p-2" />
      </div>
    </div>
    <button onclick="calculateResearch()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 rounded-lg">ê³„ì‚°í•˜ê¸°</button>
  </div>

  <script>
    function loadPage(page) {
      window.location.href = page;
      window.parent.postMessage({ type: "SET_FRAME_SIZE", height: "550px", width: "100%"}, "*");
    }
    
      const researchData = {
      "I": [
        { level: 1, ê°€ë£¨: 16, ì² ê°•ì¬: 5000 },
        { level: 2, ê°€ë£¨: 25, ì² ê°•ì¬: 8000 },
        { level: 3, ê°€ë£¨: 41, ì² ê°•ì¬: 13000 },
        { level: 4, ê°€ë£¨: 68, ì² ê°•ì¬: 21000 },
        { level: 5, ê°€ë£¨: 102, ì² ê°•ì¬: 33000 },
      ],
      "II-A": [
        { level: 1, ê°€ë£¨: 40, ì² ê°•ì¬: 10000 },
        { level: 2, ê°€ë£¨: 56, ì² ê°•ì¬: 14000 },
        { level: 3, ê°€ë£¨: 74, ì² ê°•ì¬: 18000 },
        { level: 4, ê°€ë£¨: 102, ì² ê°•ì¬: 25000 },
        { level: 5, ê°€ë£¨: 136, ì² ê°•ì¬: 24000 },
        { level: 6, ê°€ë£¨: 184, ì² ê°•ì¬: 46000 },
        { level: 7, ê°€ë£¨: 248, ì² ê°•ì¬: 62000 },
        { level: 8, ê°€ë£¨: 334, ì² ê°•ì¬: 83000 },
      ],
      "II-B": [
        { level: 1, ê°€ë£¨: 40, ì² ê°•ì¬: 10000 },
        { level: 2, ê°€ë£¨: 56, ì² ê°•ì¬: 14000 },
        { level: 3, ê°€ë£¨: 74, ì² ê°•ì¬: 18000 },
        { level: 4, ê°€ë£¨: 102, ì² ê°•ì¬: 25000 },
        { level: 5, ê°€ë£¨: 136, ì² ê°•ì¬: 24000 },
        { level: 6, ê°€ë£¨: 184, ì² ê°•ì¬: 46000 },
        { level: 7, ê°€ë£¨: 248, ì² ê°•ì¬: 62000 },
        { level: 8, ê°€ë£¨: 334, ì² ê°•ì¬: 83000 },
      ],
      "III": [
        { level: 1, ê°€ë£¨: 83, ì² ê°•ì¬: 23000 },
        { level: 2, ê°€ë£¨: 102, ì² ê°•ì¬: 28000 },
        { level: 3, ê°€ë£¨: 125, ì² ê°•ì¬: 34000 },
        { level: 4, ê°€ë£¨: 150, ì² ê°•ì¬: 41000 },
        { level: 5, ê°€ë£¨: 184, ì² ê°•ì¬: 51000 },
        { level: 6, ê°€ë£¨: 225, ì² ê°•ì¬: 62000 },
        { level: 7, ê°€ë£¨: 276, ì² ê°•ì¬: 76000 },
        { level: 8, ê°€ë£¨: 334, ì² ê°•ì¬: 93000 },
        { level: 9, ê°€ë£¨: 418, ì² ê°•ì¬: 110000 },
        { level: 10, ê°€ë£¨: 502, ì² ê°•ì¬: 130000 },
        { level: 11, ê°€ë£¨: 602, ì² ê°•ì¬: 160000 },
        { level: 12, ê°€ë£¨: 744, ì² ê°•ì¬: 200000 },
      ],
      "IV-A": [
        { level: 1, ê°€ë£¨: 54, ì² ê°•ì¬: 15000 },
        { level: 2, ê°€ë£¨: 66, ì² ê°•ì¬: 18000 },
        { level: 3, ê°€ë£¨: 81, ì² ê°•ì¬: 22000 },
        { level: 4, ê°€ë£¨: 97, ì² ê°•ì¬: 27000 },
        { level: 5, ê°€ë£¨: 118, ì² ê°•ì¬: 33000 },
        { level: 6, ê°€ë£¨: 145, ì² ê°•ì¬: 40000 },
        { level: 7, ê°€ë£¨: 178, ì² ê°•ì¬: 49000 },
        { level: 8, ê°€ë£¨: 216, ì² ê°•ì¬: 60000 },
        { level: 9, ê°€ë£¨: 270, ì² ê°•ì¬: 75000 },
        { level: 10, ê°€ë£¨: 324, ì² ê°•ì¬: 90000 },
        { level: 11, ê°€ë£¨: 388, ì² ê°•ì¬: 100000 },
        { level: 12, ê°€ë£¨: 480, ì² ê°•ì¬: 130000 },
      ],
      "IV-B": [
        { level: 1, ê°€ë£¨: 54, ì² ê°•ì¬: 15000 },
        { level: 2, ê°€ë£¨: 66, ì² ê°•ì¬: 18000 },
        { level: 3, ê°€ë£¨: 81, ì² ê°•ì¬: 22000 },
        { level: 4, ê°€ë£¨: 97, ì² ê°•ì¬: 27000 },
        { level: 5, ê°€ë£¨: 118, ì² ê°•ì¬: 33000 },
        { level: 6, ê°€ë£¨: 145, ì² ê°•ì¬: 40000 },
        { level: 7, ê°€ë£¨: 178, ì² ê°•ì¬: 49000 },
        { level: 8, ê°€ë£¨: 216, ì² ê°•ì¬: 60000 },
        { level: 9, ê°€ë£¨: 270, ì² ê°•ì¬: 75000 },
        { level: 10, ê°€ë£¨: 324, ì² ê°•ì¬: 90000 },
        { level: 11, ê°€ë£¨: 388, ì² ê°•ì¬: 100000 },
        { level: 12, ê°€ë£¨: 480, ì² ê°•ì¬: 130000 },
      ],
      "V": [
        { level: 1, ê°€ë£¨: 2236, ì² ê°•ì¬: 1000000 },
      ],
      "Healing": [
        { level: 1, ê°€ë£¨: 102, ì² ê°•ì¬: 30000 },
        { level: 2, ê°€ë£¨: 137, ì² ê°•ì¬: 40000 },
        { level: 3, ê°€ë£¨: 188, ì² ê°•ì¬: 55000 },
        { level: 4, ê°€ë£¨: 255, ì² ê°•ì¬: 75000 },
        { level: 5, ê°€ë£¨: 341, ì² ê°•ì¬: 100000 },
        { level: 6, ê°€ë£¨: 459, ì² ê°•ì¬: 130000 },
        { level: 7, ê°€ë£¨: 612, ì² ê°•ì¬: 180000 },
        { level: 8, ê°€ë£¨: 836, ì² ê°•ì¬: 240000 },
        { level: 9, ê°€ë£¨: 1122, ì² ê°•ì¬: 330000 },
        { level: 10, ê°€ë£¨: 1530, ì² ê°•ì¬: 450000 },
      ],
      "Training": [
        { level: 1, ê°€ë£¨: 102, ì² ê°•ì¬: 30000 },
        { level: 2, ê°€ë£¨: 137, ì² ê°•ì¬: 40000 },
        { level: 3, ê°€ë£¨: 188, ì² ê°•ì¬: 55000 },
        { level: 4, ê°€ë£¨: 255, ì² ê°•ì¬: 75000 },
        { level: 5, ê°€ë£¨: 341, ì² ê°•ì¬: 100000 },
        { level: 6, ê°€ë£¨: 459, ì² ê°•ì¬: 130000 },
        { level: 7, ê°€ë£¨: 612, ì² ê°•ì¬: 180000 },
        { level: 8, ê°€ë£¨: 836, ì² ê°•ì¬: 240000 },
        { level: 9, ê°€ë£¨: 1122, ì² ê°•ì¬: 330000 },
        { level: 10, ê°€ë£¨: 1530, ì² ê°•ì¬: 450000 },
      ],
      "HealingTime": [
        { level: 1, ê°€ë£¨: 51, ì² ê°•ì¬: 15000 },
        { level: 2, ê°€ë£¨: 68, ì² ê°•ì¬: 20000 },
        { level: 3, ê°€ë£¨: 94, ì² ê°•ì¬: 27000 },
        { level: 4, ê°€ë£¨: 127, ì² ê°•ì¬: 37000 },
        { level: 5, ê°€ë£¨: 170, ì² ê°•ì¬: 50000 },
        { level: 6, ê°€ë£¨: 229, ì² ê°•ì¬: 67000 },
        { level: 7, ê°€ë£¨: 306, ì² ê°•ì¬: 90000 },
        { level: 8, ê°€ë£¨: 418, ì² ê°•ì¬: 120000 },
        { level: 9, ê°€ë£¨: 561, ì² ê°•ì¬: 160000 },
        { level: 10, ê°€ë£¨: 765, ì² ê°•ì¬: 220000 },
      ]
    };
    
    const researchList = Object.entries(researchData).map(([key, value]) => ({
      key,
      label: {
        "Healing": "ì¹˜ìœ  ì—°êµ¬",
        "Training": "í›ˆë ¨ ì—°êµ¬",
        "HealingTime": "ì¹˜ìœ ì‹œê°„ ì—°êµ¬"
      }[key] || `ì—°êµ¬ ${key.replace('-', ' ')}`,
      max: Math.max(...value.map(v => v.level))
    }));

    function createLevelOptions(max) {
      return Array.from({ length: max + 1 }, (_, i) => `<option value="${i}">${i}</option>`).join('');
    }
    
    function renderResearchCards() {
      const container = document.getElementById("researchGrid");
      researchList.forEach(item => {
        const div = document.createElement("div");
        div.innerHTML += `
          <div class="border p-2 rounded bg-orange-50 text-xs">
            <label for="check-${item.key}" class="flex items-center text-sm font-semibold mb-1">
            <input type="checkbox" id="check-${item.key}" class="mr-1 w-4 h-4 ">${item.label}
            </label>
            <div class="flex items-center gap-2 mb-1">
              <label class="text-sm whitespace-nowrap">í˜„ì¬</label>
              <select id="current-${item.key}" class="w-full border rounded py-1 px-2 text-sm">
                ${createLevelOptions(item.max)}
              </select>
            </div>
            <div class="flex items-center gap-2 mb-1">
              <label class="text-sm whitespace-nowrap">ëª©í‘œ</label>
              <select id="target-${item.key}" class="w-full border rounded py-1 px-2 text-sm">
                ${createLevelOptions(item.max)}
              </select>
            </div>
          </div>
          `;
        container.appendChild(div);
      });
    }
    
    function calcResearchMaterials(key, current, target) {
      const data = researchData[key] || [];
      const filtered = data.filter(row => row.level > current && row.level <= target);

      const subtotal = {};
      filtered.forEach(row => {
        for (let [resource, value] of Object.entries(row)) {
          if (resource === "level") continue;
          subtotal[resource] = (subtotal[resource] || 0) + parseFloat(value);
        }
      });
      return subtotal;
    }
    
    function calculateResearch() {
      let total = { ê°€ë£¨: 0, ì² ê°•ì¬: 0 };
      let rows = "";

      researchList.forEach(item => {
        const checked = document.getElementById(`check-${item.key}`).checked;
        if (!checked) return;

        const cur = parseInt(document.getElementById(`current-${item.key}`).value);
        const tgt = parseInt(document.getElementById(`target-${item.key}`).value);
        if (cur >= tgt) return;

        const data = researchData[item.key];
        const subtotal = { ê°€ë£¨: 0, ì² ê°•ì¬: 0 };

        for (let i = cur + 1; i <= tgt; i++) {
          const row = data.find(r => r.level === i);
          if (!row) continue;
          subtotal.ê°€ë£¨ += parseFloat(row.ê°€ë£¨ || 0);
          subtotal.ì² ê°•ì¬ += parseFloat(row.ì² ê°•ì¬ || 0);
        }

        total.ê°€ë£¨ += subtotal.ê°€ë£¨;
        total.ì² ê°•ì¬ += subtotal.ì² ê°•ì¬;

        const owned = {
          ê°€ë£¨: parseFloat(document.getElementById("own-ê°€ë£¨").value) || 0,
          ì² ê°•ì¬: parseFloat(document.getElementById("own-ì² ê°•ì¬").value) || 0,
        };
        
        rows += `
          <tr class="text-center">
            <td class="border p-1">${item.label}</td>
            <td class="border p-1">${cur} â†’ ${tgt}</td>
            <td class="border p-1">${subtotal.ê°€ë£¨.toLocaleString()}</td>
            <td class="border p-1">${subtotal.ì² ê°•ì¬.toLocaleString()}</td>
          </tr>
          <tr class="text-center font-bold bg-red-50">
          <td class="border p-1" colspan="2">ê³¼ë¶€ì¡±</td>
          <td class="border p-1">${(owned.ê°€ë£¨ - total.ê°€ë£¨).toLocaleString()}</td>
          <td class="border p-1">${(owned.ì² ê°•ì¬ - total.ì² ê°•ì¬).toLocaleString()}</td>
          </tr>
        `;
      });

      rows += `
        <tr class="text-center font-bold bg-purple-100">
          <td class="border p-1" colspan="2">ì´í•©</td>
          <td class="border p-1">${total.ê°€ë£¨.toLocaleString()}</td>
          <td class="border p-1">${total.ì² ê°•ì¬.toLocaleString()}</td>
        </tr>
      `;

      const resultHTML = `
        <table class="w-full table-auto border text-sm text-center mt-4">
          <thead class="bg-gray-100">
            <tr>
              <th class="border p-1">ì—°êµ¬</th>
              <th class="border p-1">ë ˆë²¨</th>
              <th class="border p-1">ê°€ë£¨</th>
              <th class="border p-1">ì² ê°•ì¬</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      `;
      //alert("ì´ í•„ìš”í•œ ìì›:\n" + Object.entries(total).map(([k, v]) => `${k}: ${v.toLocaleString()}`).join("\n"));
      window.parent.postMessage({ type: "RESULT_POPUP", html: resultHTML }, "*");
    }

    renderResearchCards();
  </script>
  <script>
    document.addEventListener("contextmenu", event => event.preventDefault());
    document.addEventListener("keydown", function (e) {
      if (e.key === "F12" || (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "J")) ||
        (e.ctrlKey && (e.key === "U" || e.key === "S"))) 
      {
        e.preventDefault();
      }
    });
  </script>
</body>
</html>
