<meta charset="UTF-8" />
<!-- partial: 이전 기록 선택 -->

<div class="px-4 pb-10" id="transferHistoryChoiceRoot">
  <h1 style="font-size: 3.25rem; font-weight: 800; text-align: center; margin: 3rem 0 3.5rem;">
    이전 기록
  </h1>

  <!-- 상단 안내 -->
  <div style="max-width: 1600px; margin: 0 auto 2rem;">
    <div class="bg-white border rounded-2xl p-5">
      <div class="text-lg font-semibold mb-1">연도를 선택하세요</div>
      <div class="muted text-sm leading-relaxed">
        클릭하면 해당 연도의 월별 이민 히스토리를 확인 할 수 있습니다.
      </div>
    </div>
  </div>

  <!-- 연도 카드 그리드 -->
  <div id="yearGrid"
       style="display:grid; grid-template-columns: repeat(2, 1fr); gap: 1.75rem; width:100%; max-width:1600px; margin:0 auto;">
  </div>
</div>

<style>
  .muted{color:#6b7280}
  .pill{padding:.35rem .6rem;border:1px solid #d1d5db;border-radius:.75rem;background:#fff;color:#111827}
  .inline-label{display:flex;align-items:center;gap:.5rem}
  .tabular-nums{font-variant-numeric: tabular-nums}
  select.pill{height:32px}
  .err{color:#b45309}

  /* 다크모드 */
  body.dark-mode{background-color:#121212;color:#f0f0f0}
  .dark-mode .border{border-color:#444!important}
  .dark-mode .bg-white{background-color:#2c2c2c!important;color:#f0f0f0!important}
  .dark-mode .bg-gray-100{background-color:#1e1e1e!important}
  .dark-mode .text-gray-800,.dark-mode .text-gray-700,.dark-mode .text-gray-600{color:#dddddd!important}
  .dark-mode .bg-purple-50,.dark-mode .bg-orange-50,.dark-mode .bg-red-50{background-color:#2e2e2e!important}
  .dark-mode select option{color:#000!important}
  .dark-mode select{color:#000!important}
  .dark-mode input{color:#000!important}
</style>

<script>
  (function () {
    // ==========================
    // 유틸: NAVIGATE_FRAME / 높이 전송
    // ==========================
    function openPage(url, css){
      // ✅ common.js가 받는 SPA 이동 이벤트로 넘김
      document.dispatchEvent(new CustomEvent("SPA_NAVIGATE", {
        detail: { url, css }
      }));
    }

    function sendHeightToParent(){
      const h = document.body.scrollHeight + 50;
      // partial은 iframe일 수도 있고 아닐 수도 있으니 안전하게
      if (window.parent && window.parent !== window) {
        window.parent.postMessage({type:"FRAME_CHANGE", height:h}, "*");
      }
    }

    // ==========================
    // 다크모드: localStorage 유지 + 부모 메시지 수신
    // ==========================
    // (partial이라도 DOMContentLoaded가 이미 지난 뒤 삽입될 수 있어서 즉시 체크)
    try {
      if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
      }
    } catch (_) {}

    window.addEventListener('message', (e) => {
      if (e.data?.type === 'DARK_MODE') {
        document.body.classList.toggle('dark-mode', e.data.value);
      }
    });

    // ==========================
    // 연도 카드 구성
    // ==========================
    const years = [
      { year: 2026, title: "이전 기록", desc: "2026년 기록 확인", badge: "NEW" },
      { year: 2025, title: "이전 기록", desc: "2025년 기록 확인", badge: "" },
      { year: 2024, title: "이전 기록", desc: "2024년 기록 확인", badge: "" },
    ];

    function cardGradientByIndex(i){
      const grads = [
        "linear-gradient(135deg, rgba(59,130,246,0.12), rgba(147,197,253,0.05))",
        "linear-gradient(135deg, rgba(239,68,68,0.12), rgba(252,165,165,0.05))",
        "linear-gradient(135deg, rgba(168,85,247,0.12), rgba(216,180,254,0.06))",
        "linear-gradient(135deg, rgba(16,185,129,0.12), rgba(167,243,208,0.06))",
        "linear-gradient(135deg, rgba(245,158,11,0.12), rgba(253,230,138,0.06))",
      ];
      return grads[i % grads.length];
    }

    function renderYearCards(){
      const grid = document.getElementById('yearGrid');
      if (!grid) return;

      grid.innerHTML = "";

      years.forEach((y, idx) => {
        const url = `transferHistory${y.year}.partial.html`;

        const section = document.createElement('section');
        section.style.cursor = 'pointer';
        section.onclick = () => {
          if (typeof loadPage === "function") {
            openPage(url);   // 네 SPA partial 로더
          } else {
            window.location.href = url;
          }
        };

        const wrap = document.createElement('div');
        wrap.style.position = 'relative';
        wrap.style.borderRadius = '1.25rem';
        wrap.style.overflow = 'hidden';
        wrap.style.cursor = 'pointer';
        wrap.style.transition = '0.25s';
        wrap.style.boxShadow = 'rgba(0,0,0,0.15) 0px 12px 24px';
        wrap.className = "bg-white border";

        const top = document.createElement('div');
        top.style.padding = '1.25rem 1.5rem';
        top.style.background = cardGradientByIndex(idx);

        const yearText = document.createElement('div');
        yearText.className = "tabular-nums";
        yearText.style.fontSize = '3.25rem';
        yearText.style.fontWeight = '800';
        yearText.style.lineHeight = '1';
        yearText.textContent = y.year;

        const badge = document.createElement('div');
        if (y.badge) {
          badge.textContent = y.badge;
          badge.style.position = "absolute";
          badge.style.top = "14px";
          badge.style.right = "14px";
          badge.style.fontSize = "0.75rem";
          badge.style.fontWeight = "800";
          badge.style.padding = ".35rem .75rem";
          badge.style.borderRadius = "999px";

          badge.style.background = "#16a34a";   // 초록 배경
          badge.style.color = "#facc15";        // 노란 글씨
          badge.style.border = "none";
          badge.style.boxShadow = "0 4px 10px rgba(0,0,0,0.25)";
          badge.style.letterSpacing = "0.5px";
        }

        top.appendChild(yearText);

        const bottom = document.createElement('div');
        bottom.style.padding = '1.25rem 1.5rem';

        const h2 = document.createElement('h2');
        h2.style.fontSize = '1.5rem';
        h2.style.fontWeight = '600';
        h2.style.marginBottom = '.35rem';
        h2.textContent = y.title;

        const p = document.createElement('p');
        p.style.fontSize = '1rem';
        p.style.lineHeight = '1.6';
        p.className = "muted";
        p.textContent = y.desc;

        bottom.appendChild(h2);
        bottom.appendChild(p);

        wrap.appendChild(top);
        wrap.appendChild(bottom);
        if (y.badge) wrap.appendChild(badge);

        wrap.addEventListener("mouseenter", () => {
          wrap.style.transform = "translateY(-2px)";
          wrap.style.boxShadow = "rgba(0,0,0,0.22) 0px 16px 30px";
        });
        wrap.addEventListener("mouseleave", () => {
          wrap.style.transform = "translateY(0px)";
          wrap.style.boxShadow = "rgba(0,0,0,0.15) 0px 12px 24px";
        });

        section.appendChild(wrap);
        grid.appendChild(section);
      });

      setTimeout(sendHeightToParent, 60);
    }

    // partial은 삽입 타이밍이 애매하니까: 즉시 + 한 번 더
    renderYearCards();
    setTimeout(renderYearCards, 0);

    // 높이도 초기 1회
    setTimeout(sendHeightToParent, 80);

    // ==========================
    // 우클릭/개발자도구 키 막기(기존 유지)
    // ==========================
    document.addEventListener("contextmenu", event => event.preventDefault());
    document.addEventListener("keydown", function (e) {
      if (e.key === "F12" ||
          (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "J")) ||
          (e.ctrlKey && (e.key === "U" || e.key === "S"))) {
        e.preventDefault();
      }
    });
  })();
</script>
