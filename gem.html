
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì˜ì£¼ë³´ì„ ê³„ì‚°ê¸°</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6 font-sans">
  <div class="max-w-5xl mx-auto bg-white p-6 rounded shadow">
    <h2 class="text-2xl font-bold text-purple-600 mb-4">ğŸ’ ì˜ì£¼ë³´ì„ ê³„ì‚°ê¸°</h2>
    <form id="gemForm" class="space-y-6">
      <div id="gemTableBody" class="grid grid-cols-12 gap-2"></div>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div><label class="block font-semibold">ë³´ìœ  ë§¤ë‰´ì–¼</label><input type="number" id="own-ë§¤ë‰´ì–¼" class="w-full border rounded p-2" /></div>
        <div><label class="block font-semibold">ë³´ìœ  ë„ë©´</label><input type="number" id="own-ë„ë©´" class="w-full border rounded p-2" /></div>
        <div><label class="block font-semibold">ë³´ìœ  ë¹„ì „</label><input type="number" id="own-ë¹„ì „" class="w-full border rounded p-2" /></div>
      </div>
      <button type="button" onclick="calculateGems()" class="w-full bg-purple-500 text-white py-2 rounded hover:bg-purple-600">ê³„ì‚°í•˜ê¸°</button>
    </form>
    <div id="gemResult" class="mt-6"></div>
  </div>

<script>
const gemSheetID = "1vtW4diWsB4OoSK70nYa6ve1nRPHrhWg-rf76NlsRM08";
const gemSheetName = "ì˜ì£¼ë³´ì„ì¬ë£Œ";
const gemSlots = ["ë°©íŒ¨A", "ë°©íŒ¨B", "ë°©íŒ¨C", "ë°©íŒ¨D", "ë°©íŒ¨E", "ë°©íŒ¨F", 
  "ì°½ë³‘A", "ì°½ë³‘B", "ì°½ë³‘C", "ì°½ë³‘D", "ì°½ë³‘E", "ì°½ë³‘F",
  "ê¶ë³‘A", "ê¶ë³‘B", "ê¶ë³‘C", "ê¶ë³‘D", "ê¶ë³‘E", "ê¶ë³‘F"];
let gemLevels = [];

async function createGemUI() {
  const grid = document.getElementById("gemTableBody");
  const url = `https://opensheet.elk.sh/${gemSheetID}/${gemSheetName}`;
  const res = await fetch(url);
  const data = await res.json();
  gemLevels = data.map(d => d["ë ˆë²¨"]);

  gemSlots.forEach((slot, i) => {
    const options = gemLevels.map(lv => `<option value="${lv}">${lv}</option>`).join("");
    grid.innerHTML += `
      <div class="col-span-2 border p-2 rounded bg-purple-50">
        <label class="flex items-center text-sm font-semibold mb-1">
          <input type="checkbox" id="gem-check-${i}" class="w-5 h-5 mr-1 accent-purple-500" />
          ${slot}
        </label>
        <select id="gem-cur-${i}" class="w-full border rounded text-sm p-2 mb-1">${options}</select>
        <select id="gem-tgt-${i}" class="w-full border rounded text-sm p-2">${options}</select>
      </div>
    `;
  });
}

async function calculateGems() {
  const url = `https://opensheet.elk.sh/${gemSheetID}/${gemSheetName}`;
  const res = await fetch(url);
  const data = await res.json();
  const levels = data.map(d => d["ë ˆë²¨"]);

  let total = { ë§¤ë‰´ì–¼: 0, ë„ë©´: 0, ë¹„ì „: 0 };
  let rows = "";

  for (let i = 0; i < gemSlots.length; i++) {
    if (!document.getElementById(`gem-check-${i}`).checked) continue;

    const cur = document.getElementById(`gem-cur-${i}`).value;
    const tgt = document.getElementById(`gem-tgt-${i}`).value;
    const start = levels.indexOf(cur);
    const end = levels.indexOf(tgt);

    if (start === -1 || end === -1 || start >= end) {
      rows += `<tr><td class="border p-1 text-center text-red-600" colspan="5">âš ï¸ ${gemSlots[i]}: ì˜ëª»ëœ ë ˆë²¨ ì„ íƒ</td></tr>`;
      continue;
    }

    let subtotal = { ë§¤ë‰´ì–¼: 0, ë„ë©´: 0, ë¹„ì „: 0 };
    for (let j = start + 1; j <= end; j++) {
      subtotal.ë§¤ë‰´ì–¼ += parseFloat(data[j]["ë§¤ë‰´ì–¼"] || 0);
      subtotal.ë„ë©´ += parseFloat(data[j]["ë„ë©´"] || 0);
      subtotal.ë¹„ì „ += parseFloat(data[j]["ë¹„ì „"] || 0);
    }

    total.ë§¤ë‰´ì–¼ += subtotal.ë§¤ë‰´ì–¼;
    total.ë„ë©´ += subtotal.ë„ë©´;
    total.ë¹„ì „ += subtotal.ë¹„ì „;

    rows += `
      <tr class="text-center">
        <td class="border p-1">${gemSlots[i]}</td>
        <td class="border p-1">${cur} â†’ ${tgt}</td>
        <td class="border p-1">${subtotal.ë§¤ë‰´ì–¼.toLocaleString()}</td>
        <td class="border p-1">${subtotal.ë„ë©´.toLocaleString()}</td>
        <td class="border p-1">${subtotal.ë¹„ì „.toLocaleString()}</td>
      </tr>
    `;
  }

  const owned = {
    ë§¤ë‰´ì–¼: parseFloat(document.getElementById("own-ë§¤ë‰´ì–¼").value) || 0,
    ë„ë©´: parseFloat(document.getElementById("own-ë„ë©´").value) || 0,
    ë¹„ì „: parseFloat(document.getElementById("own-ë¹„ì „").value) || 0,
  };

  rows += `
    <tr class="text-center font-bold bg-purple-100">
      <td class="border p-1" colspan="2">ì´í•©</td>
      <td class="border p-1">${total.ë§¤ë‰´ì–¼.toLocaleString()}</td>
      <td class="border p-1">${total.ë„ë©´.toLocaleString()}</td>
      <td class="border p-1">${total.ë¹„ì „.toLocaleString()}</td>
    </tr>
    <tr class="text-center font-bold bg-red-50">
      <td class="border p-1" colspan="2">ê³¼ë¶€ì¡±</td>
      <td class="border p-1">${(owned.ë§¤ë‰´ì–¼ - total.ë§¤ë‰´ì–¼).toLocaleString()}</td>
      <td class="border p-1">${(owned.ë„ë©´ - total.ë„ë©´).toLocaleString()}</td>
      <td class="border p-1">${(owned.ë¹„ì „ - total.ë¹„ì „).toLocaleString()}</td>
    </tr>
  `;

  document.getElementById("gemResult").innerHTML = `
    <table class="table-auto w-full border mt-4 text-sm text-center">
      <thead class="bg-gray-100">
        <tr>
          <th class="border p-1">ìŠ¬ë¡¯</th>
          <th class="border p-1">ë ˆë²¨</th>
          <th class="border p-1">ë§¤ë‰´ì–¼</th>
          <th class="border p-1">ë„ë©´</th>
          <th class="border p-1">ë¹„ì „</th>
        </tr>
      </thead>
      <tbody>${rows}</tbody>
    </table>
  `;
}

createGemUI();
</script>

<script>
  document.addEventListener("contextmenu", event => event.preventDefault());
  document.addEventListener("keydown", function (e) {
    if (
      e.key === "F12" ||
      (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "J")) ||
      (e.ctrlKey && (e.key === "U" || e.key === "S"))
    ) {
      e.preventDefault();
    }
  });
</script>

</body>
</html>
