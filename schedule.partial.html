<meta charset="UTF-8" />

<div class="max-w-[1500px] mx-auto bg-white rounded shadow p-2 flex flex-col sm:flex-row gap-2">
  <div class="flex-1 bg-white rounded p-2 space-y-4 shadow">
    <div class="bg-gray-100 p-2 font-sans text-sm">
      <div class="bg-white p-4 rounded-xl shadow-md space-y-4">
        <h1 class="text-2xl font-bold text-gray-800 mb-2">ğŸ“… ì£¼ìš” ì´ë²¤íŠ¸ ì¼ì •</h1>

        <!-- ìë™ ê³„ì‚°ëœ ì£¼ì°¨ ì•ˆë‚´-->
        <div id="currentWeekInfo" class="mb-4 text-xs text-gray-600 border rounded-lg p-3 bg-gray-100"></div>

        <!-- Week Blocks (ì¹´ë“œ + ì£¼ê°„í‘œ) -->
        <div class="space-y-3">            
          <!-- Week 1 -->
          <div id="week-1" data-week="1"
               class="week-block border border-gray-200 rounded-xl p-3 bg-white">
            <div class="flex flex-col gap-2">
              <div class="flex items-center gap-2">
                <span class="text-xl font-semibold text-gray-800">1ì£¼ì°¨</span>
              </div>
              <span class="text-[12px] text-gray-600" data-week-range="1"></span>          
              <p class="text-[12px] text-gray-600">ì—°ë§¹ëŒ€ì‘ì „ (ì›”~í† )<br>ë¬´ê¸°ê³µì¥ (ì¼)</p>

              <!-- ì£¼ê°„ í‘œ -->
              <div class="week-grid mt-1 grid grid-cols-7 text-[12px] border border-gray-200 rounded-md overflow-hidden">
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>

                <div class="day-slot border-t border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
              </div>
            </div>
          </div>

          <!-- Week 2 -->
          <div id="week-2" data-week="2"
               class="week-block border border-gray-200 rounded-xl p-3 bg-white">
            <div class="flex flex-col gap-2">
              <!-- ìƒë‹¨ ì œëª©/ì„¤ëª… -->
              <div class="flex items-center gap-2">
                <span class="text-xl font-semibold text-gray-800">2ì£¼ì°¨</span>
              </div>
              <!-- ì—¬ê¸° ë‚ ì§œ ë²”ìœ„ ìë™ í‘œê¸° -->
              <span class="text-[12px] text-gray-600" data-week-range="2"></span>
              <p class="text-[12px] text-gray-600">ë¹™ì›ì˜ ì™• (ì›”~ê¸ˆ)<br>ë‚´ë¶€ì†”ë¼ (í† )</p>

              <!-- í•˜ë‹¨: ì£¼ê°„ í‘œ -->
              <div class="week-grid mt-1 grid grid-cols-7 text-[11px] border border-gray-200 rounded-md overflow-hidden">
                <!-- ë‚ ì§œ(ìš”ì¼) í—¤ë” (JSë¡œ ì±„ì›€) -->
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>

                <!-- ì´ë²¤íŠ¸ ë¸Œë¦¿ì§€ (JSë¡œ ì±„ì›€) -->
                <div class="day-slot border-t border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
              </div>
            </div>
          </div>

          <!-- Week 2 -->
          <div id="week-3" data-week="3"
               class="week-block border border-gray-200 rounded-xl p-3 bg-white">
            <div class="flex flex-col gap-2">
              <div class="flex items-center gap-2">
                <span class="text-xl font-semibold text-gray-800">3ì£¼ì°¨</span>            
              </div>
              <span class="text-[12px] text-gray-600" data-week-range="3"></span>
              <p class="text-[12px] text-gray-600">ì—°ë§¹ì´ë™ì› (ì›”~ê¸ˆ)<br>í˜‘ê³¡ (í† )<br>ë¬´ê¸°ê³µì¥ (ì¼)</p>

              <!-- ì£¼ê°„ í‘œ -->
              <div class="week-grid mt-1 grid grid-cols-7 text-[11px] border border-gray-200 rounded-md overflow-hidden">
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>

                <div class="day-slot border-t border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
              </div>
            </div>
          </div>

          <!-- Week 4 -->
          <div id="week-4" data-week="4"
               class="week-block border border-gray-200 rounded-xl p-3 bg-white">
            <div class="flex flex-col gap-2">
              <div class="flex items-center gap-2">
                <span class="text-xl font-semibold text-gray-800">4ì£¼ì°¨</span>            
              </div>
              <span class="text-[12px] text-gray-600" data-week-range="4"></span>
              <p class="text-[12px] text-gray-600">SVS ì¤€ë¹„ë‹¨ê³„ (ì›”~ê¸ˆ)<br>SVS ì „ìŸë‹¨ê³„ (í† )</p>

              <!-- ì£¼ê°„ í‘œ -->
              <div class="week-grid mt-1 grid grid-cols-7 text-[11px] border border-gray-200 rounded-md overflow-hidden">
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>
                <div class="day-header bg-gray-50 text-center py-1 font-medium dark:text-gray-800"></div>

                <div class="day-slot border-t border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
                <div class="day-slot border-t border-l border-gray-200 text-center py-1"></div>
              </div>
            </div>
          </div>

        </div>

      </div>
    </div>
  </div>
</div>

<script>
(function(){
  // âœ… SPA ì¬ì§„ì…/ì¬ë¡œë“œ ì‹œ ì´ë²¤íŠ¸ ì¤‘ë³µ ë°”ì¸ë”© ë°©ì§€
  if (window.__SCHEDILE_INIT_BOUND__) {
    // ì´ë¯¸ ì´ˆê¸°í™”ëœ ìƒíƒœë©´ ê·¸ëƒ¥ ì‹¤í–‰ë§Œ(í•„ìš” ì‹œ)
    window.ScheduleInit?.();
    return;
  }
  window.__SCHEDILE_INIT_BOUND__ = true;
    
  window.ScheduleInit = function ScheduleInit(){  
    // â˜… ì‹œì‘ì¼ê³¼ ì‹œì‘ ì£¼ì°¨ë¥¼ ë„¤ê°€ ì§€ì •í•˜ëŠ” ë¶€ë¶„
    function getCurrentWeekMonday() {
      const today = new Date();
      const day = today.getDay(); // 0=ì¼
      const diff = (day === 0 ? -6 : 1) - day; // ì›”ìš”ì¼ ë³´ì •
      const monday = new Date(today);
      monday.setDate(today.getDate() + diff);
      monday.setHours(0,0,0,0);
      return monday;
    }
    const START_DATE = getCurrentWeekMonday();
    const START_WEEK = 1;                       // 1~4    
    const dayNames = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "];

    // ì£¼ì°¨ë³„ ì´ë²¤íŠ¸ ê¸°ê°„ ì •ì˜ (0=ì›” ~ 6=ì¼)
    // startDay / endDay ì— ë§ê²Œ ë¸Œë¦¿ì§€ê°€ ì±„ì›Œì§
    const WEEK_EVENTS = {
      1: [
        { name: "ì—°ë§¹ëŒ€ì‘ì „", startDay: 0, endDay: 5, type: "showdown" }, // ì›”~í† 
        { name: "ë¬´ê¸°ê³µì¥",   startDay: 6, endDay: 6, type: "weapon" } // ì¼
      ],
      2: [
        { name: "ë¹™ì›ì˜ ì™•", startDay: 0, endDay: 4, type: "king" },   // ì›”~ê¸ˆ
        { name: "ë‚´ë¶€ì†”ë¼",   startDay: 5, endDay: 5, type: "solar" }   // í† 
      ],
      3: [
        { name: "ì—°ë§¹ì´ë™ì›", startDay: 0, endDay: 4, type: "alliance" }, // ì›”~ê¸ˆ
        { name: "í˜‘ê³¡",       startDay: 5, endDay: 5, type: "canyon" },   // í† 
        { name: "ë¬´ê¸°ê³µì¥",   startDay: 6, endDay: 6, type: "weapon" }    // ì¼
      ],
      4: [
        { name: "SVS ì¤€ë¹„ë‹¨ê³„", startDay: 0, endDay: 4, type: "svs-pre" }, // ì›”~ê¸ˆ
        { name: "SVS ì „ìŸë‹¨ê³„", startDay: 5, endDay: 5, type: "svs-war" }  // í† 
      ]
    };

    // íƒ€ì…ë³„ ìƒ‰ìƒ/ìŠ¤íƒ€ì¼ ë§¤í•‘
    function getEventClasses(type) {
      switch (type) {
        case "showdown":      // ì—°ë§¹ëŒ€ì‘ì „
          return { cell: "bg-blue-50", badge: "bg-blue-100 text-blue-700 border border-blue-200" };
        case "weapon":    // ë¬´ê¸°ê³µì¥
          return { cell: "bg-neutral-50", badge: "bg-neutral-100 text-neutral-700 border border-neutral-200" };
        case "king":      // ë¹™ì›ì˜ ì™•
          return { cell: "bg-orange-50", badge: "bg-orange-100 text-orange-700 border border-orange-200" };
        case "solar":     // ë‚´ë¶€ì†”ë¼
          return { cell: "bg-cyan-50", badge: "bg-cyan-100 text-cyan-700 border border-cyan-200" };
        case "alliance":  // ì—°ë§¹ì´ë™ì›
          return { cell: "bg-purple-50", badge: "bg-purple-100 text-purple-700 border border-purple-200" };
        case "canyon":    // í˜‘ê³¡
          return { cell: "bg-orange-50", badge: "bg-orange-100 text-orange-700 border border-orange-200" };
        case "svs-pre":   // SVS ì¤€ë¹„ë‹¨ê³„
          return { cell: "bg-red-50", badge: "bg-red-100 text-red-700 border border-red-200" };
        case "svs-war":   // SVS ì „ìŸë‹¨ê³„
          return { cell: "bg-pink-50", badge: "bg-pink-100 text-pink-800 border border-pink-200" };
        default:
          return { cell: "bg-gray-50", badge: "bg-gray-100 text-gray-800 border border-gray-200" };
      }
    }

    // íŠ¹ì • ì£¼ì°¨ì˜ íŠ¹ì • ìš”ì¼ ë‚ ì§œ ê³„ì‚°
    // weekIndex: 0~3 (1ì£¼ì°¨=0), dayIndex: 0~6 (ì›”~ì¼)
    function getDateOfWeek(weekIndex, dayIndex) {
      const base = new Date(START_DATE);
      const daysToAdd = (weekIndex * 7) + dayIndex;
      base.setDate(base.getDate() + daysToAdd);
      return base;
    }

    // "11.10 [ì›”]" í˜•ì‹ìœ¼ë¡œ í¬ë§·
    function formatDateLabel(d) {
      const mm = (d.getMonth() + 1).toString().padStart(2, "0");
      const dd = d.getDate().toString().padStart(2, "0");
      const day = dayNames[d.getDay()];
      return `${mm}.${dd} [${day}]`;
    }

    // íŠ¹ì • ì£¼ì°¨ì˜ ì‹œì‘/ë ë‚ ì§œ ê³„ì‚° (weekIndex: 0~3)
    function getWeekRange(weekIndex) {
      const start = getDateOfWeek(weekIndex, 0); // ì›”
      const end   = getDateOfWeek(weekIndex, 6); // ì¼
      return { start, end };
    }

    // ===============================
    //   í˜„ì¬ ì£¼ì°¨ ìë™ ê³„ì‚°
    // ===============================
    function applyDynamicWeek() {

      const today = new Date();
      const msWeek = 7 * 24 * 60 * 60 * 1000;
      const diffWeeks = Math.floor((today - START_DATE) / msWeek);
      const currentWeek = ((START_WEEK - 1 + diffWeeks) % 4) + 1;

      // ì•ˆë‚´ ë°•ìŠ¤ ì¶œë ¥
      document.getElementById("currentWeekInfo").innerHTML =
        `ì˜¤ëŠ˜ ë‚ ì§œ: <b>${today.toISOString().slice(0,10)}</b><br>
         í˜„ì¬ ìë™ ê³„ì‚°ëœ ì£¼ì°¨: <b style="color:#0074ff">${currentWeek}ì£¼ì°¨</b><br>
         ì—°ë§¹ëŒ€ì‘ì „ì´ ì‹œì‘ë˜ëŠ” ì›”ìš”ì¼ì˜ í•´ë‹¹ ì£¼ë¥¼ 1ì£¼ì°¨ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤.`;

      // ì£¼ì°¨ ê°•ì¡° + "í˜„ì¬ ì£¼" ë±ƒì§€
      document.querySelectorAll(".week-block").forEach(el => {
        const w = Number(el.dataset.week);
        el.classList.remove("bg-sky-50", "ring-2", "ring-sky-400");
        const existingBadge = el.querySelector(".current-week-badge");
        if (existingBadge) existingBadge.remove();

        if (w === currentWeek) {
          el.classList.add("bg-sky-50", "ring-2", "ring-sky-400");
          const badge = document.createElement("span");
          badge.textContent = "í˜„ì¬ ì£¼";
          badge.className =
            "current-week-badge ml-2 px-2 py-0.5 rounded-full bg-sky-600 text-white text-[12px] font-semibold";
          const titleRow = el.querySelector("div > div.flex.items-center.gap-2");
          if (titleRow) titleRow.appendChild(badge);
        }
      });

      // ê° ì£¼ ì œëª© ì˜†ì— ë‚ ì§œ ë²”ìœ„ ë„£ê¸°
      insertWeekRanges();
    }

    // ===============================
    //   ê° ì£¼ ì œëª© ì˜†ì— (ì‹œì‘ì¼ ~ ì¢…ë£Œì¼) í‘œì‹œ
    // ===============================
    function insertWeekRanges() {
      for (let week = 1; week <= 4; week++) {
        const span = document.querySelector(`[data-week-range="${week}"]`);
        if (!span) continue;

        const { start, end } = getWeekRange(week - 1);
        span.textContent = `(${formatDateLabel(start)} ~ ${formatDateLabel(end)})`;
      }
    }

    // ===============================
    //   ì£¼ê°„í‘œ í—¤ë”ì— ë‚ ì§œ(ìš”ì¼) ìë™ ì‚½ì…
    // ===============================
    function insertDayHeaders() {
      for (let week = 1; week <= 4; week++) {
        const grid = document.querySelector(`#week-${week} .week-grid`);
        if (!grid) continue;

        const headers = grid.querySelectorAll(".day-header"); // 7ê°œ
        headers.forEach((header, i) => {
          const d = getDateOfWeek(week - 1, i); // i: 0~6 (ì›”~ì¼)
          header.textContent = formatDateLabel(d); // "11.10 [ì›”]"
        });
      }
    }

    // ===============================
    //   ì£¼ê°„í‘œ ì´ë²¤íŠ¸ ë¸Œë¦¿ì§€ ì±„ìš°ê¸° (SPAN ë²„ì „)
    // ===============================
    function insertEventBridges() {
      for (let week = 1; week <= 4; week++) {
        const grid = document.querySelector(`#week-${week} .week-grid`);
        if (!grid) continue;

        // ê¸°ì¡´ day-slot(ì¹¸)ë“¤ì€ ì œê±° (í—¤ë” ì œì™¸í•œ row ì´ˆê¸°í™”)
        const oldSlots = grid.querySelectorAll(".event-bar");
        oldSlots.forEach(el => el.remove());

        // ì´ë²¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°
        const events = WEEK_EVENTS[week] || [];
        events.forEach(ev => {
          const { cell, badge } = getEventClasses(ev.type);

          // SPAN í•˜ë‚˜ ìƒì„±
          const bar = document.createElement("div");

          // col-start / col-span ê³„ì‚°
          const colStart = ev.startDay + 1;         // gridëŠ” 1ë¶€í„° ì‹œì‘
          const colSpan = ev.endDay - ev.startDay + 1;

          bar.className = `
            event-bar 
            col-start-${colStart} 
            col-span-${colSpan} 
            border-t border-gray-200 
            flex items-center justify-center py-1 
            ${cell}
          `.replace(/\s+/g, " ").trim();

          // í…ìŠ¤íŠ¸ ì¶”ê°€ (í•œ ë²ˆë§Œ!)
          bar.innerHTML = `
            <span class="px-2 py-0.5 rounded-full text-[12px] font-semibold inline-block ${badge}">
              ${ev.name}
            </span>
          `;

          grid.appendChild(bar);
        });
      }
    }

    // ===============================
    //   ë¡œë“œ ì‹œ ì‹¤í–‰
    // ===============================
    applyDynamicWeek();
    insertDayHeaders();
    insertEventBridges();
  };
  window.ScheduleInit();
})();
</script>
