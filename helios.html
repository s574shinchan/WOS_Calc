<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì—°êµ¬ ê³„ì‚°ê¸°</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
     /* âœ… ë‹¤í¬ëª¨ë“œ ì „ìš© */
    body.dark-mode {
      background-color: #121212;
      color: #f0f0f0;
    }
    
    .dark-mode .border { border-color: #444 !important; }
    .dark-mode .bg-white { background-color: #2c2c2c !important; color: #f0f0f0 !important; }
    .dark-mode .bg-gray-100 { background-color: #1e1e1e !important; }
  
    .dark-mode .text-gray-800,
    .dark-mode .text-gray-700,
    .dark-mode .text-gray-600 { color: #dddddd !important; }
  
    .dark-mode .text-blue-700 { color: #66b0ff !important; }
    .dark-mode .text-blue-600 { color: #80caff !important; }
    .dark-mode .text-orange-500 { color: #ffa94d !important; }
    .dark-mode .text-green-600 { color: #79e68c !important; }
    .dark-mode .text-red-500 { color: #ff8080 !important; }
    .dark-mode .text-gray-500 { color: #aaa !important; }    
    
    .dark-mode .text-gray-800, 
    .dark-mode .text-gray-600 { color: #e0e0e0 !important; }
    
    .dark-mode table { background-color: #2c2c2c; color: #f0f0f0; }
    .dark-mode th, .dark-mode td { border-color: #444 !important; }
    .dark-mode thead th { color: #000 !important; }
    
    .dark-mode .bg-amber-100,    
    .dark-mode .bg-green-100,
    .dark-mode .bg-indigo-100 { background-color: #3a3a3a !important; color: #f0f0f0 !important; }
    
    .dark-mode .bg-white { background-color: #2c2c2c !important; color: #f0f0f0 !important; }
    .dark-mode .bg-gray-100 { background-color: #1e1e1e !important; }
    
    .dark-mode .bg-amber-50,
    .dark-mode .bg-indigo-50 { background-color: #2d2d2d !important; }

    .dark-mode .bg-blue-100,
    .dark-mode .bg-blue-50,
    .dark-mode .bg-orange-50,
    .dark-mode .bg-purple-50,
    .dark-mode .bg-yellow-50,
    .dark-mode .bg-red-50 { background-color: #2e2e2e !important; }
    
    .dark-mode summary { background-color: #333 !important; color: #fff !important; }
    .dark-mode ul li { color: #ddd; }
    
    .dark-mode select option { color: #000 !important; }
    .dark-mode select { color: #000 !important; }
    .dark-mode input { color: #000 !important; }
  </style>

  <!-- âœ… ë‹¤í¬ëª¨ë“œ ìƒíƒœ ìœ ì§€ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
      }
    });
  </script>
</head>
<body class="bg-gray-100 p-2 font-sans text-sm">
  <div class="max-w-6xl mx-auto bg-white p-2 rounded-xl shadow-md">
    <h1 class="text-2xl font-bold text-gray-800 mb-6">ğŸ§ª í—¬ë¦¬ì˜¤ìŠ¤ ì—°êµ¬ ê³„ì‚°ê¸°</h1>
    <!-- ì„¤ëª… ì¶”ê°€ -->
    <div class="text-gray-600 mb-4 text-sm">
      <div class="mb-6">
        <p>ì´ í˜ì´ì§€ëŠ” í—¬ë¦¬ì˜¤ìŠ¤ ë³‘ì‚¬ì—°êµ¬ì— í•„ìš”í•œ ìì›(ë¶ˆìˆ˜ê°€ë£¨, ì² ê°•ì¬)ë¥¼ ê³„ì‚°í•˜ëŠ” í™”ë©´ì…ë‹ˆë‹¤.</p>
        <p>ì—°êµ¬í•­ëª©ë³„ë¡œ ê°œë³„ ì„ íƒì´ ê°€ëŠ¥í•˜ë©° ë³´ìœ  ì¤‘ì¸ ìì›ì„ ì…ë ¥í•˜ë©´ ì¶”ê°€ë¡œ í•„ìš”í•œ ìˆ˜ëŸ‰ë§Œì„ ì •í™•íˆ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        <p>ê²°ê³¼ëŠ” ìì›ë³„ í•©ê³„ì™€ í•¨ê»˜ í‘œì‹œë˜ë©°, ì†Œìš”ì‹œê°„ì€ ì •í™•í•˜ì§€ ì•Šì•„ì„œ ì œì™¸ë˜ì—ˆìŠµë‹ˆë‹¤..</p>
      </div>
      
      <div class="grid grid-cols-6 gap-x-4 px-0 text-center">
        <div class="flex items-center text-sm font-semibold leading-tight">
          <input type="checkbox" id="chkInf" checked = true onchange="handleCheck('chkInf')" class="mr-1 w-4 h-4" /> ë°©íŒ¨ë³‘
        </div>
        <div class="flex items-center text-sm font-semibold leading-tight">
          <input type="checkbox" id="chkLan" onchange="handleCheck('chkLan')" class="mr-1 w-4 h-4" /> ì°½ë³‘
        </div>
        <div class="flex items-center text-sm font-semibold leading-tight">
          <input type="checkbox" id="chkMask" onchange="handleCheck('chkMask')" class="mr-1 w-4 h-4" /> ê¶ë³‘
        </div>
      </div>
      <div class="grid grid-cols-2 md:flex md:flex-wrap md:items-center gap-4">
        <label class="inline-flex items-center font-semibold">
          <input type="checkbox" id="chkVP10" onchange="handleVPCheck('chkVP10')" class="mr-2 w-4 h-4">ì¼ë°˜)ë¶€ì§‘í–‰ê´€ (10%)
        </label>
        <label class="inline-flex items-center font-semibold">
          <input type="checkbox" id="chkVP15" onchange="handleVPCheck('chkVP15')" class="mr-2 w-4 h-4">ìµœì§‘)ë¶€ì§‘í–‰ê´€ (15%)
        </label>
        <label class="inline-flex items-center font-semibold">
          <input type="checkbox" id="chkServerBuff" class="mr-2 w-4 h-4">ì—°êµ¬ì„œë²„ë²„í”„ (10%)
        </label>
        <div class="flex items-center gap-2">
          <label for="speedPercent" class="font-semibold whitespace-nowrap">ì—°êµ¬ì†ë„ (%)</label>
          <input type="number" id="speedPercent" class="border rounded p-2 text-sm w-24 text-right" placeholder="0" min="0" />
        </div>
      </div>
    </div>
    
    <div class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-6" id="researchGrid"></div>
    <div class="grid grid-cols-2 gap-4 mb-4">
      <div><label class="block font-semibold">ë³´ìœ  ê°€ë£¨</label>
        <input type="number" id="own-ê°€ë£¨" class="w-full border rounded p-2" placeholder="0" min="0" />
      </div>
      <div><label class="block font-semibold">ë³´ìœ  ì² ê°•ì¬</label>
        <input type="number" id="own-ì² ê°•ì¬" class="w-full border rounded p-2" placeholder="0" min="0" />
      </div>
    </div>
    <button onclick="calculateResearch()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 rounded-lg">ê³„ì‚°í•˜ê¸°</button>
  </div>
  <script>
    function sendHeightToParent() {
      const height = document.body.scrollHeight + 10;
      window.parent.postMessage({ type: "FRAME_CHANGE", height }, "*");
    }

    // í˜ì´ì§€ ìµœì´ˆ ë¡œë“œ ì‹œ
    window.addEventListener("load", () => {
      setTimeout(sendHeightToParent, 100); // ì•½ê°„ì˜ ë Œë”ë§ ëŒ€ê¸°
    });
    
    function loadPage(page) {
      const isMobile = window.innerWidth <= 768;
      const height = isMobile ? "550px" : "345px"
        window.location.href = page;
      window.parent.postMessage({ type: "SET_FRAME_SIZE", height: height, width: "100%"}, "*");
    }
  </script>
  <script>
    const researchData = {
      "I": [
        { level: 1, ê°€ë£¨: 16, ì² ê°•ì¬: 5000, ì‹œê°„: "0d 08:00:00" },
        { level: 2, ê°€ë£¨: 25, ì² ê°•ì¬: 8000, ì‹œê°„: "0d 12:48:00" },
        { level: 3, ê°€ë£¨: 41, ì² ê°•ì¬: 13000, ì‹œê°„: "0d 20:48:00" },
        { level: 4, ê°€ë£¨: 68, ì² ê°•ì¬: 21000, ì‹œê°„: "1d 10:24:00" },
        { level: 5, ê°€ë£¨: 102, ì² ê°•ì¬: 33000, ì‹œê°„: "2d 06:00:00" },
      ],
      "II-A": [
        { level: 1, ê°€ë£¨: 40, ì² ê°•ì¬: 10000, ì‹œê°„: "0d 20:00:00" },
        { level: 2, ê°€ë£¨: 56, ì² ê°•ì¬: 14000, ì‹œê°„: "1d 04:00:00" },
        { level: 3, ê°€ë£¨: 74, ì² ê°•ì¬: 18000, ì‹œê°„: "1d 13:00:00" },
        { level: 4, ê°€ë£¨: 102, ì² ê°•ì¬: 25000, ì‹œê°„: "2d 03:00:00" },
        { level: 5, ê°€ë£¨: 136, ì² ê°•ì¬: 24000, ì‹œê°„: "2d 20:00:00" },
        { level: 6, ê°€ë£¨: 184, ì² ê°•ì¬: 46000, ì‹œê°„: "3d 20:00:00" },
        { level: 7, ê°€ë£¨: 248, ì² ê°•ì¬: 62000, ì‹œê°„: "5d 04:00:00" },
        { level: 8, ê°€ë£¨: 334, ì² ê°•ì¬: 83000, ì‹œê°„: "6d 23:00:00" },
      ],
      "II-B": [
        { level: 1, ê°€ë£¨: 40, ì² ê°•ì¬: 10000, ì‹œê°„: "0d 20:00:00" },
        { level: 2, ê°€ë£¨: 56, ì² ê°•ì¬: 14000, ì‹œê°„: "1d 04:00:00" },
        { level: 3, ê°€ë£¨: 74, ì² ê°•ì¬: 18000, ì‹œê°„: "1d 13:00:00" },
        { level: 4, ê°€ë£¨: 102, ì² ê°•ì¬: 25000, ì‹œê°„: "2d 03:00:00" },
        { level: 5, ê°€ë£¨: 136, ì² ê°•ì¬: 24000, ì‹œê°„: "2d 20:00:00" },
        { level: 6, ê°€ë£¨: 184, ì² ê°•ì¬: 46000, ì‹œê°„: "3d 20:00:00" },
        { level: 7, ê°€ë£¨: 248, ì² ê°•ì¬: 62000, ì‹œê°„: "5d 04:00:00" },
        { level: 8, ê°€ë£¨: 334, ì² ê°•ì¬: 83000, ì‹œê°„: "6d 23:00:00" },
      ],
      "III": [
        { level: 1, ê°€ë£¨: 83, ì² ê°•ì¬: 23000, ì‹œê°„: "1d 05:20:17" },
        { level: 2, ê°€ë£¨: 102, ì² ê°•ì¬: 28000, ì‹œê°„: "1d 12:05:08" },
        { level: 3, ê°€ë£¨: 125, ì² ê°•ì¬: 34000, ì‹œê°„: "1d 20:00:25" },
        { level: 4, ê°€ë£¨: 150, ì² ê°•ì¬: 41000, ì‹œê°„: "2d 04:48:30" },
        { level: 5, ê°€ë£¨: 184, ì² ê°•ì¬: 51000, ì‹œê°„: "2d 16:32:37" },
        { level: 6, ê°€ë£¨: 225, ì² ê°•ì¬: 62000, ì‹œê°„: "3d 07:12:45" },
        { level: 7, ê°€ë£¨: 276, ì² ê°•ì¬: 76000, ì‹œê°„: "4d 00:58:56" },
        { level: 8, ê°€ë£¨: 334, ì² ê°•ì¬: 93000, ì‹œê°„: "4d 21:21:08" },
        { level: 9, ê°€ë£¨: 418, ì² ê°•ì¬: 110000, ì‹œê°„: "6d 02:41:25" },
        { level: 10, ê°€ë£¨: 502, ì² ê°•ì¬: 130000, ì‹œê°„: "7d 08:01:42" },
        { level: 11, ê°€ë£¨: 602, ì² ê°•ì¬: 160000, ì‹œê°„: "8d 19:14:02" },
        { level: 12, ê°€ë£¨: 744, ì² ê°•ì¬: 200000, ì‹œê°„: "10d 21:06:31" },
      ],
      "IV-A": [
        { level: 1, ê°€ë£¨: 54, ì² ê°•ì¬: 15000, ì‹œê°„: "0d 18:55:40" },
        { level: 2, ê°€ë£¨: 66, ì² ê°•ì¬: 18000, ì‹œê°„: "0d 23:16:52" },
        { level: 3, ê°€ë£¨: 81, ì² ê°•ì¬: 22000, ì‹œê°„: "1d 04:23:30" },
        { level: 4, ê°€ë£¨: 97, ì² ê°•ì¬: 27000, ì‹œê°„: "1d 10:04:12" },
        { level: 5, ê°€ë£¨: 118, ì² ê°•ì¬: 33000, ì‹œê°„: "1d 17:38:28" },
        { level: 6, ê°€ë£¨: 145, ì² ê°•ì¬: 40000, ì‹œê°„: "2d 03:06:18" },
        { level: 7, ê°€ë£¨: 178, ì² ê°•ì¬: 49000, ì‹œê°„: "2d 14:27:42" },
        { level: 8, ê°€ë£¨: 216, ì² ê°•ì¬: 60000, ì‹œê°„: "3d 03:42:20" },
        { level: 9, ê°€ë£¨: 270, ì² ê°•ì¬: 75000, ì‹œê°„: "3d 22:38:20" },
        { level: 10, ê°€ë£¨: 324, ì² ê°•ì¬: 90000, ì‹œê°„: "4d 17:34:00" },
        { level: 11, ê°€ë£¨: 388, ì² ê°•ì¬: 100000, ì‹œê°„: "5d 16:16:48" },
        { level: 12, ê°€ë£¨: 480, ì² ê°•ì¬: 130000, ì‹œê°„: "7d 00:27:26" },
      ],
      "IV-B": [
        { level: 1, ê°€ë£¨: 54, ì² ê°•ì¬: 15000, ì‹œê°„: "0d 18:55:40" },
        { level: 2, ê°€ë£¨: 66, ì² ê°•ì¬: 18000, ì‹œê°„: "0d 23:16:52" },
        { level: 3, ê°€ë£¨: 81, ì² ê°•ì¬: 22000, ì‹œê°„: "1d 04:23:30" },
        { level: 4, ê°€ë£¨: 97, ì² ê°•ì¬: 27000, ì‹œê°„: "1d 10:04:12" },
        { level: 5, ê°€ë£¨: 118, ì² ê°•ì¬: 33000, ì‹œê°„: "1d 17:38:28" },
        { level: 6, ê°€ë£¨: 145, ì² ê°•ì¬: 40000, ì‹œê°„: "2d 03:06:18" },
        { level: 7, ê°€ë£¨: 178, ì² ê°•ì¬: 49000, ì‹œê°„: "2d 14:27:42" },
        { level: 8, ê°€ë£¨: 216, ì² ê°•ì¬: 60000, ì‹œê°„: "3d 03:42:20" },
        { level: 9, ê°€ë£¨: 270, ì² ê°•ì¬: 75000, ì‹œê°„: "3d 22:38:20" },
        { level: 10, ê°€ë£¨: 324, ì² ê°•ì¬: 90000, ì‹œê°„: "4d 17:34:00" },
        { level: 11, ê°€ë£¨: 388, ì² ê°•ì¬: 100000, ì‹œê°„: "5d 16:16:48" },
        { level: 12, ê°€ë£¨: 480, ì² ê°•ì¬: 130000, ì‹œê°„: "7d 00:27:26" },
      ],
      "V": [
        { level: 1, ê°€ë£¨: 2236, ì² ê°•ì¬: 1000000, ì‹œê°„: "54d 23:50:14" },
      ],
      "Healing": [
        { level: 1, ê°€ë£¨: 102, ì² ê°•ì¬: 30000, ì‹œê°„: "2d 02:00:00" },
        { level: 2, ê°€ë£¨: 137, ì² ê°•ì¬: 40000, ì‹œê°„: "2d 19:30:00" },
        { level: 3, ê°€ë£¨: 188, ì² ê°•ì¬: 55000, ì‹œê°„: "3d 20:30:00" },
        { level: 4, ê°€ë£¨: 255, ì² ê°•ì¬: 75000, ì‹œê°„: "5d 05:00:00" },
        { level: 5, ê°€ë£¨: 341, ì² ê°•ì¬: 100000, ì‹œê°„: "6d 23:30:00" },
        { level: 6, ê°€ë£¨: 459, ì² ê°•ì¬: 130000, ì‹œê°„: "9d 09:00:00" },
        { level: 7, ê°€ë£¨: 612, ì² ê°•ì¬: 180000, ì‹œê°„: "12d 12:00:00" },
        { level: 8, ê°€ë£¨: 836, ì² ê°•ì¬: 240000, ì‹œê°„: "17d 02:00:00" },
        { level: 9, ê°€ë£¨: 1122, ì² ê°•ì¬: 330000, ì‹œê°„: "22d 22:00:00" },
        { level: 10, ê°€ë£¨: 1530, ì² ê°•ì¬: 450000, ì‹œê°„: "31d 06:00:00" },
      ],
      "Training": [
        { level: 1, ê°€ë£¨: 102, ì² ê°•ì¬: 30000, ì‹œê°„: "2d 02:00:00" },
        { level: 2, ê°€ë£¨: 137, ì² ê°•ì¬: 40000, ì‹œê°„: "2d 19:30:00" },
        { level: 3, ê°€ë£¨: 188, ì² ê°•ì¬: 55000, ì‹œê°„: "3d 20:30:00" },
        { level: 4, ê°€ë£¨: 255, ì² ê°•ì¬: 75000, ì‹œê°„: "5d 05:00:00" },
        { level: 5, ê°€ë£¨: 341, ì² ê°•ì¬: 100000, ì‹œê°„: "6d 23:30:00" },
        { level: 6, ê°€ë£¨: 459, ì² ê°•ì¬: 130000, ì‹œê°„: "9d 09:00:00" },
        { level: 7, ê°€ë£¨: 612, ì² ê°•ì¬: 180000, ì‹œê°„: "12d 12:00:00" },
        { level: 8, ê°€ë£¨: 836, ì² ê°•ì¬: 240000, ì‹œê°„: "17d 02:00:00" },
        { level: 9, ê°€ë£¨: 1122, ì² ê°•ì¬: 330000, ì‹œê°„: "22d 22:00:00" },
        { level: 10, ê°€ë£¨: 1530, ì² ê°•ì¬: 450000, ì‹œê°„: "31d 06:00:00" },
      ],
      "HealingTime": [
        { level: 1, ê°€ë£¨: 51, ì² ê°•ì¬: 15000, ì‹œê°„: "1d 01:00:00" },
        { level: 2, ê°€ë£¨: 68, ì² ê°•ì¬: 20000, ì‹œê°„: "1d 09:45:00" },
        { level: 3, ê°€ë£¨: 94, ì² ê°•ì¬: 27000, ì‹œê°„: "1d 22:15:00" },
        { level: 4, ê°€ë£¨: 127, ì² ê°•ì¬: 37000, ì‹œê°„: "2d 14:30:00" },
        { level: 5, ê°€ë£¨: 170, ì² ê°•ì¬: 50000, ì‹œê°„: "3d 11:45:00" },
        { level: 6, ê°€ë£¨: 229, ì² ê°•ì¬: 67000, ì‹œê°„: "4d 16:30:00" },
        { level: 7, ê°€ë£¨: 306, ì² ê°•ì¬: 90000, ì‹œê°„: "6d 06:00:00" },
        { level: 8, ê°€ë£¨: 418, ì² ê°•ì¬: 120000, ì‹œê°„: "8d 13:00:00" },
        { level: 9, ê°€ë£¨: 561, ì² ê°•ì¬: 160000, ì‹œê°„: "11d 11:00:00" },
        { level: 10, ê°€ë£¨: 765, ì² ê°•ì¬: 220000, ì‹œê°„: "15d 15:00:00" },
      ]
    };

    let researchList = []; // ì „ì—­ ë³€ìˆ˜ë¡œ ì„ ì–¸
    
    function updateResearchList() {
      const chkInf = document.getElementById("chkInf");
      const chkLan = document.getElementById("chkLan");
      const chkMask = document.getElementById("chkMask");

      researchList = Object.entries(researchData).map(([key, value]) => {
        let label = {
          "I": "ë¶ˆê½ƒ ë¶€ëŒ€",
          "II-A": "íŒŒê´´ë ¥ ì—°êµ¬",
          "II-B" : "HP ì—°êµ¬",
          "III" : "ë¶ˆê½ƒ êµ°ë‹¨",
          "IV-A" : "ê³µê²©ë ¥ ì—°êµ¬",
          "IV-B" : "ë°©ì–´ë ¥ ì—°êµ¬",
          "V" : "í—¬ë¦¬ì˜¤ìŠ¤ ë³‘ì‚¬",
          "Healing" : "ì¹˜ë£Œ ì—°êµ¬",
          "Training" : "í›ˆë ¨ ì—°êµ¬",
          "HealingTime" : "êµ¬ê¸‰ ì—°êµ¬",
        }[key];

        switch (key) {
          case "II-A":
            if (chkInf.checked) label = "ë¶ˆê½ƒ ê³µê²©";
            else if (chkLan.checked) label = "ë¶ˆì˜ ëŒê²©";
            else if (chkMask.checked) label = "ìˆ˜ì •ì˜ ì‹œì•¼";
            break;
          case "II-B":
            if (chkInf.checked) label = "ë¶ˆê½ƒ ë°©íŒ¨";
            else if (chkLan.checked) label = "ë¶ˆì˜ ë°©ì–´";
            else if (chkMask.checked) label = "ìˆ˜ì • ê°‘ì˜·";
            break;
          case "IV-A":
            if (chkInf.checked) label = "ë¶ˆê½ƒ ë„ë¼";
            else if (chkLan.checked) label = "ë¶ˆì˜ ì°½";
            else if (chkMask.checked) label = "ìˆ˜ì • í™”ì‚´";
            break;
          case "IV-B":
            if (chkInf.checked) label = "ë¶ˆê½ƒ ìˆ˜í˜¸";
            else if (chkLan.checked) label = "ë¶ˆì˜ ìˆ˜í˜¸";
            else if (chkMask.checked) label = "ìˆ˜ì •ì˜ ê°€í˜¸";
            break;
          default:
            break;
        }

        return {
          key,
          label,
          max: Math.max(...value.map(v => v.level))
        };
      });
    }

    function createLevelOptions(max) {
      return Array.from({ length: max + 1 }, (_, i) => `<option value="${i}">${i}</option>`).join('');
    }

    function renderResearchCards() {
      const container = document.getElementById("researchGrid");
      container.innerHTML = ""; // Clear previous content
      researchList.forEach(item => {
        const div = document.createElement("div");
        div.innerHTML = `
          <div class="border p-2 rounded bg-purple-50 text-xs">
            <label for="check-${item.key}" class="flex items-center text-sm font-semibold mb-1">
              <input type="checkbox" id="check-${item.key}" class="mr-1 w-4 h-4 ">${item.label}
            </label>
            <div class="flex items-center gap-2 mb-1">
              <label class="text-sm whitespace-nowrap">í˜„ì¬</label>
              <select id="current-${item.key}" class="w-full border rounded py-1 px-2 text-sm">
                ${createLevelOptions(item.max)}
              </select>
            </div>
            <div class="flex items-center gap-2 mb-1">
              <label class="text-sm whitespace-nowrap">ëª©í‘œ</label>
              <select id="target-${item.key}" class="w-full border rounded py-1 px-2 text-sm">
                ${createLevelOptions(item.max)}
              </select>
            </div>
          </div>
        `;
        container.appendChild(div);

        // ì—¬ê¸°ì„œ JSë¡œ ì´ë²¤íŠ¸ë¥¼ ì—°ê²°
        const currentSelect = div.querySelector(`#current-${item.key}`);
        const targetSelect = div.querySelector(`#target-${item.key}`);
        currentSelect.addEventListener("change", () => {
          let nextValue = parseInt(currentSelect.value) + 1;
          if (nextValue > item.max) nextValue = item.max; // ìµœëŒ€ê°’ ì´ˆê³¼ ë°©ì§€
          targetSelect.value = nextValue;
        });
      });
    }

    function handleCheck(toggleId) {
      const chkInf = document.getElementById("chkInf");
      const chkLan = document.getElementById("chkLan");
      const chkMask = document.getElementById("chkMask");

      if (toggleId === "chkInf" && chkInf.checked) {
        chkLan.checked = false;
        chkMask.checked = false;
      } else if (toggleId === "chkLan" && chkLan.checked) {
        chkInf.checked = false;
        chkMask.checked = false;
      } else if (toggleId === "chkMask" && chkMask.checked) {
        chkInf.checked = false;
        chkLan.checked = false;
      }

      updateResearchList();
      renderResearchCards();
    }

    function handleVPCheck(toggleId) {
      const chkVP10 = document.getElementById("chkVP10");
      const chkVP15 = document.getElementById("chkVP15");

      if (toggleId === "chkVP10" && chkVP10.checked) {
        chkVP15.checked = false;
      } else if (toggleId === "chkVP15" && chkVP15.checked) {
        chkVP10.checked = false;
      }
    }

    function formatTime(sec) {
      const d = Math.floor(sec / 86400);
      sec %= 86400;
      const h = Math.floor(sec / 3600);
      sec %= 3600;
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      return `${d}d ${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
    }

    function parseTimeToSeconds(timeStr) {
      const [d, hms] = timeStr.split(" ");
      const [h, m, s] = hms.split(":").map(Number);
      return (parseInt(d) || 0) * 86400 + h * 3600 + m * 60 + s;
    }

    function calculateResearch() {
      let total = { ê°€ë£¨: 0, ì² ê°•ì¬: 0, ì‹œê°„: 0 };
      let rows = "";

      let factor = (parseFloat(document.getElementById("speedPercent").value) || 0) * 0.01 + 1;

      if (document.getElementById("chkVP10").checked) factor += 0.10;
      if (document.getElementById("chkVP15").checked) factor += 0.15;
      if (document.getElementById("chkServerBuff").checked) factor += 0.10;

      researchList.forEach(item => {
        const checked = document.getElementById(`check-${item.key}`).checked;
        if (!checked) return;

        const cur = parseInt(document.getElementById(`current-${item.key}`).value);
        const tgt = parseInt(document.getElementById(`target-${item.key}`).value);
        if (cur >= tgt) return;

        const data = researchData[item.key];
        const subtotal = { ê°€ë£¨: 0, ì² ê°•ì¬: 0, ì‹œê°„: 0 };

        for (let i = cur + 1; i <= tgt; i++) {
          const row = data.find(r => r.level === i);
          if (!row) continue;
          subtotal.ê°€ë£¨ += row.ê°€ë£¨ || 0;
          subtotal.ì² ê°•ì¬ += row.ì² ê°•ì¬ || 0;
          subtotal.ì‹œê°„ += parseTimeToSeconds(row.ì‹œê°„ || 0);
        }

        total.ê°€ë£¨ += subtotal.ê°€ë£¨;
        total.ì² ê°•ì¬ += subtotal.ì² ê°•ì¬;
        total.ì‹œê°„ += subtotal.ì‹œê°„;

        rows += `
          <tr class="text-center">
            <td class="border p-1">${item.label}</td>
            <td class="border p-1">${cur} â†’ ${tgt}</td>
            <td class="border p-1">${subtotal.ê°€ë£¨.toLocaleString()}</td>
            <td class="border p-1">${subtotal.ì² ê°•ì¬.toLocaleString()}</td>
             <td class="border p-1">${formatTime(Math.round(subtotal.ì‹œê°„ / factor))}</td>
          </tr>`;
      });

      const owned = {
        ê°€ë£¨: parseFloat(document.getElementById("own-ê°€ë£¨").value) || 0,
        ì² ê°•ì¬: parseFloat(document.getElementById("own-ì² ê°•ì¬").value) || 0,
      };

      rows += `
        <tr class="text-center font-bold bg-purple-100">
          <td class="border p-1" colspan="2">ì´í•©</td>
          <td class="border p-1">${total.ê°€ë£¨.toLocaleString()}</td>
          <td class="border p-1">${total.ì² ê°•ì¬.toLocaleString()}</td>
          <td class="border p-1">${formatTime(Math.round(total.ì‹œê°„ / factor))}</td>
        </tr>
        <tr class="text-center font-bold bg-orange-50">
          <td class="border p-1" colspan="2">ë³´ìœ ëŸ‰</td>
          <td class="border p-1">${owned.ê°€ë£¨.toLocaleString()}</td>
          <td class="border p-1">${owned.ì² ê°•ì¬.toLocaleString()}</td>
          <td class="border p-1"></td>
        </tr>
        <tr class="text-center font-bold bg-red-50">
          <td class="border p-1" colspan="2">ê³¼ë¶€ì¡±</td>
          <td class="border p-1">${(owned.ê°€ë£¨ - total.ê°€ë£¨).toLocaleString()}</td>
          <td class="border p-1">${(owned.ì² ê°•ì¬ - total.ì² ê°•ì¬).toLocaleString()}</td>
          <td class="border p-1"></td>
        </tr>
      `;

      const resultHTML = `
        <table class="w-full table-auto border text-sm text-center mt-4">
          <thead class="bg-gray-100">
            <tr>
              <th class="border p-1">ì—°êµ¬</th>
              <th class="border p-1">ë ˆë²¨</th>
              <th class="border p-1">ë¶ˆìˆ˜ê°€ë£¨</th>
              <th class="border p-1">ì² ê°•ì¬</th>
              <th class="border p-1">ì†Œìš”ì‹œê°„</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      `;
      window.parent.postMessage({ type: "RESULT_POPUP", html: resultHTML }, "*");
    }

    // ìµœì´ˆ ì‹¤í–‰
    updateResearchList();
    renderResearchCards();
    sendHeightToParent();
  </script>
  <script>
    document.addEventListener("contextmenu", event => event.preventDefault());
    document.addEventListener("keydown", function (e) {
      if (e.key === "F12" || (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "J")) ||
        (e.ctrlKey && (e.key === "U" || e.key === "S"))) 
      {
        e.preventDefault();
      }
    });
  </script>
</body>
</html>
