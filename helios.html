<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ïó∞Íµ¨ Í≥ÑÏÇ∞Í∏∞</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-2 font-sans text-sm">
  <div class="max-w-6xl mx-auto bg-white p-2 rounded-xl shadow-md">
    <h1 class="text-2xl font-bold text-gray-800 mb-6">üß™ Ìó¨Î¶¨Ïò§Ïä§ Ïó∞Íµ¨ Í≥ÑÏÇ∞Í∏∞</h1>
    <!-- ÏÑ§Î™Ö Ï∂îÍ∞Ä -->
    <div class="text-gray-600 mb-4 text-center text-sm">
      <div class="grid grid-cols-6 gap-x-4 px-0">
        <div class="flex items-center text-sm font-semibold leading-tight">
          <input type="checkbox" id="chkInf" checked = true onchange="handleCheck('chkInf')" class="mr-1 w-4 h-4" /> Î∞©Ìå®Î≥ë
        </div>
        <div class="flex items-center text-sm font-semibold leading-tight">
          <input type="checkbox" id="chkLan" onchange="handleCheck('chkLan')" class="mr-1 w-4 h-4" /> Ï∞ΩÎ≥ë
        </div>
        <div class="flex items-center text-sm font-semibold leading-tight">
          <input type="checkbox" id="chkMask" onchange="handleCheck('chkMask')" class="mr-1 w-4 h-4" /> Í∂ÅÎ≥ë
        </div>
      </div>
    </div>
    
    <div class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-6" id="researchGrid"></div>
    <div class="grid grid-cols-2 gap-4 mb-4">
      <div><label class="block font-semibold">Î≥¥Ïú† Í∞ÄÎ£®</label>
        <input type="number" id="own-Í∞ÄÎ£®" class="w-full border rounded p-2" />
      </div>
      <div><label class="block font-semibold">Î≥¥Ïú† Ï≤†Í∞ïÏû¨</label>
        <input type="number" id="own-Ï≤†Í∞ïÏû¨" class="w-full border rounded p-2" />
      </div>
    </div>
    <button onclick="calculateResearch()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 rounded-lg">Í≥ÑÏÇ∞ÌïòÍ∏∞</button>
  </div>

  <script>
    function loadPage(page) {
      const isMobile = window.innerWidth <= 768;
      let isHeight = isMobile ? "550px" : "345px"
      window.location.href = page;
      window.parent.postMessage({ type: "SET_FRAME_SIZE", height: isHeight, width: "100%"}, "*");
    }
    
    const researchData = {
      "I": [
        { level: 1, Í∞ÄÎ£®: 16, Ï≤†Í∞ïÏû¨: 5000 },
        { level: 2, Í∞ÄÎ£®: 25, Ï≤†Í∞ïÏû¨: 8000 },
        { level: 3, Í∞ÄÎ£®: 41, Ï≤†Í∞ïÏû¨: 13000 },
        { level: 4, Í∞ÄÎ£®: 68, Ï≤†Í∞ïÏû¨: 21000 },
        { level: 5, Í∞ÄÎ£®: 102, Ï≤†Í∞ïÏû¨: 33000 },
      ],
      "II-A": [
        { level: 1, Í∞ÄÎ£®: 40, Ï≤†Í∞ïÏû¨: 10000 },
        { level: 2, Í∞ÄÎ£®: 56, Ï≤†Í∞ïÏû¨: 14000 },
        { level: 3, Í∞ÄÎ£®: 74, Ï≤†Í∞ïÏû¨: 18000 },
        { level: 4, Í∞ÄÎ£®: 102, Ï≤†Í∞ïÏû¨: 25000 },
        { level: 5, Í∞ÄÎ£®: 136, Ï≤†Í∞ïÏû¨: 24000 },
        { level: 6, Í∞ÄÎ£®: 184, Ï≤†Í∞ïÏû¨: 46000 },
        { level: 7, Í∞ÄÎ£®: 248, Ï≤†Í∞ïÏû¨: 62000 },
        { level: 8, Í∞ÄÎ£®: 334, Ï≤†Í∞ïÏû¨: 83000 },
      ],
      "II-B": [
        { level: 1, Í∞ÄÎ£®: 40, Ï≤†Í∞ïÏû¨: 10000 },
        { level: 2, Í∞ÄÎ£®: 56, Ï≤†Í∞ïÏû¨: 14000 },
        { level: 3, Í∞ÄÎ£®: 74, Ï≤†Í∞ïÏû¨: 18000 },
        { level: 4, Í∞ÄÎ£®: 102, Ï≤†Í∞ïÏû¨: 25000 },
        { level: 5, Í∞ÄÎ£®: 136, Ï≤†Í∞ïÏû¨: 24000 },
        { level: 6, Í∞ÄÎ£®: 184, Ï≤†Í∞ïÏû¨: 46000 },
        { level: 7, Í∞ÄÎ£®: 248, Ï≤†Í∞ïÏû¨: 62000 },
        { level: 8, Í∞ÄÎ£®: 334, Ï≤†Í∞ïÏû¨: 83000 },
      ],
      "III": [
        { level: 1, Í∞ÄÎ£®: 83, Ï≤†Í∞ïÏû¨: 23000 },
        { level: 2, Í∞ÄÎ£®: 102, Ï≤†Í∞ïÏû¨: 28000 },
        { level: 3, Í∞ÄÎ£®: 125, Ï≤†Í∞ïÏû¨: 34000 },
        { level: 4, Í∞ÄÎ£®: 150, Ï≤†Í∞ïÏû¨: 41000 },
        { level: 5, Í∞ÄÎ£®: 184, Ï≤†Í∞ïÏû¨: 51000 },
        { level: 6, Í∞ÄÎ£®: 225, Ï≤†Í∞ïÏû¨: 62000 },
        { level: 7, Í∞ÄÎ£®: 276, Ï≤†Í∞ïÏû¨: 76000 },
        { level: 8, Í∞ÄÎ£®: 334, Ï≤†Í∞ïÏû¨: 93000 },
        { level: 9, Í∞ÄÎ£®: 418, Ï≤†Í∞ïÏû¨: 110000 },
        { level: 10, Í∞ÄÎ£®: 502, Ï≤†Í∞ïÏû¨: 130000 },
        { level: 11, Í∞ÄÎ£®: 602, Ï≤†Í∞ïÏû¨: 160000 },
        { level: 12, Í∞ÄÎ£®: 744, Ï≤†Í∞ïÏû¨: 200000 },
      ],
      "IV-A": [
        { level: 1, Í∞ÄÎ£®: 54, Ï≤†Í∞ïÏû¨: 15000 },
        { level: 2, Í∞ÄÎ£®: 66, Ï≤†Í∞ïÏû¨: 18000 },
        { level: 3, Í∞ÄÎ£®: 81, Ï≤†Í∞ïÏû¨: 22000 },
        { level: 4, Í∞ÄÎ£®: 97, Ï≤†Í∞ïÏû¨: 27000 },
        { level: 5, Í∞ÄÎ£®: 118, Ï≤†Í∞ïÏû¨: 33000 },
        { level: 6, Í∞ÄÎ£®: 145, Ï≤†Í∞ïÏû¨: 40000 },
        { level: 7, Í∞ÄÎ£®: 178, Ï≤†Í∞ïÏû¨: 49000 },
        { level: 8, Í∞ÄÎ£®: 216, Ï≤†Í∞ïÏû¨: 60000 },
        { level: 9, Í∞ÄÎ£®: 270, Ï≤†Í∞ïÏû¨: 75000 },
        { level: 10, Í∞ÄÎ£®: 324, Ï≤†Í∞ïÏû¨: 90000 },
        { level: 11, Í∞ÄÎ£®: 388, Ï≤†Í∞ïÏû¨: 100000 },
        { level: 12, Í∞ÄÎ£®: 480, Ï≤†Í∞ïÏû¨: 130000 },
      ],
      "IV-B": [
        { level: 1, Í∞ÄÎ£®: 54, Ï≤†Í∞ïÏû¨: 15000 },
        { level: 2, Í∞ÄÎ£®: 66, Ï≤†Í∞ïÏû¨: 18000 },
        { level: 3, Í∞ÄÎ£®: 81, Ï≤†Í∞ïÏû¨: 22000 },
        { level: 4, Í∞ÄÎ£®: 97, Ï≤†Í∞ïÏû¨: 27000 },
        { level: 5, Í∞ÄÎ£®: 118, Ï≤†Í∞ïÏû¨: 33000 },
        { level: 6, Í∞ÄÎ£®: 145, Ï≤†Í∞ïÏû¨: 40000 },
        { level: 7, Í∞ÄÎ£®: 178, Ï≤†Í∞ïÏû¨: 49000 },
        { level: 8, Í∞ÄÎ£®: 216, Ï≤†Í∞ïÏû¨: 60000 },
        { level: 9, Í∞ÄÎ£®: 270, Ï≤†Í∞ïÏû¨: 75000 },
        { level: 10, Í∞ÄÎ£®: 324, Ï≤†Í∞ïÏû¨: 90000 },
        { level: 11, Í∞ÄÎ£®: 388, Ï≤†Í∞ïÏû¨: 100000 },
        { level: 12, Í∞ÄÎ£®: 480, Ï≤†Í∞ïÏû¨: 130000 },
      ],
      "V": [
        { level: 1, Í∞ÄÎ£®: 2236, Ï≤†Í∞ïÏû¨: 1000000 },
      ],
      "Healing": [
        { level: 1, Í∞ÄÎ£®: 102, Ï≤†Í∞ïÏû¨: 30000 },
        { level: 2, Í∞ÄÎ£®: 137, Ï≤†Í∞ïÏû¨: 40000 },
        { level: 3, Í∞ÄÎ£®: 188, Ï≤†Í∞ïÏû¨: 55000 },
        { level: 4, Í∞ÄÎ£®: 255, Ï≤†Í∞ïÏû¨: 75000 },
        { level: 5, Í∞ÄÎ£®: 341, Ï≤†Í∞ïÏû¨: 100000 },
        { level: 6, Í∞ÄÎ£®: 459, Ï≤†Í∞ïÏû¨: 130000 },
        { level: 7, Í∞ÄÎ£®: 612, Ï≤†Í∞ïÏû¨: 180000 },
        { level: 8, Í∞ÄÎ£®: 836, Ï≤†Í∞ïÏû¨: 240000 },
        { level: 9, Í∞ÄÎ£®: 1122, Ï≤†Í∞ïÏû¨: 330000 },
        { level: 10, Í∞ÄÎ£®: 1530, Ï≤†Í∞ïÏû¨: 450000 },
      ],
      "Training": [
        { level: 1, Í∞ÄÎ£®: 102, Ï≤†Í∞ïÏû¨: 30000 },
        { level: 2, Í∞ÄÎ£®: 137, Ï≤†Í∞ïÏû¨: 40000 },
        { level: 3, Í∞ÄÎ£®: 188, Ï≤†Í∞ïÏû¨: 55000 },
        { level: 4, Í∞ÄÎ£®: 255, Ï≤†Í∞ïÏû¨: 75000 },
        { level: 5, Í∞ÄÎ£®: 341, Ï≤†Í∞ïÏû¨: 100000 },
        { level: 6, Í∞ÄÎ£®: 459, Ï≤†Í∞ïÏû¨: 130000 },
        { level: 7, Í∞ÄÎ£®: 612, Ï≤†Í∞ïÏû¨: 180000 },
        { level: 8, Í∞ÄÎ£®: 836, Ï≤†Í∞ïÏû¨: 240000 },
        { level: 9, Í∞ÄÎ£®: 1122, Ï≤†Í∞ïÏû¨: 330000 },
        { level: 10, Í∞ÄÎ£®: 1530, Ï≤†Í∞ïÏû¨: 450000 },
      ],
      "HealingTime": [
        { level: 1, Í∞ÄÎ£®: 51, Ï≤†Í∞ïÏû¨: 15000 },
        { level: 2, Í∞ÄÎ£®: 68, Ï≤†Í∞ïÏû¨: 20000 },
        { level: 3, Í∞ÄÎ£®: 94, Ï≤†Í∞ïÏû¨: 27000 },
        { level: 4, Í∞ÄÎ£®: 127, Ï≤†Í∞ïÏû¨: 37000 },
        { level: 5, Í∞ÄÎ£®: 170, Ï≤†Í∞ïÏû¨: 50000 },
        { level: 6, Í∞ÄÎ£®: 229, Ï≤†Í∞ïÏû¨: 67000 },
        { level: 7, Í∞ÄÎ£®: 306, Ï≤†Í∞ïÏû¨: 90000 },
        { level: 8, Í∞ÄÎ£®: 418, Ï≤†Í∞ïÏû¨: 120000 },
        { level: 9, Í∞ÄÎ£®: 561, Ï≤†Í∞ïÏû¨: 160000 },
        { level: 10, Í∞ÄÎ£®: 765, Ï≤†Í∞ïÏû¨: 220000 },
      ]
    };

    let researchList = []; // Ï†ÑÏó≠ Î≥ÄÏàòÎ°ú ÏÑ†Ïñ∏
    
    function updateResearchList() {
      const chkInf = document.getElementById("chkInf");
      const chkLan = document.getElementById("chkLan");
      const chkMask = document.getElementById("chkMask");

      researchList = Object.entries(researchData).map(([key, value]) => {
        let label = {
          "I": "Î∂àÍΩÉ Î∂ÄÎåÄ",
          "II-A": "ÌååÍ¥¥Î†• Ïó∞Íµ¨",
          "II-B" : "HP Ïó∞Íµ¨",
          "III" : "Î∂àÍΩÉ Íµ∞Îã®",
          "IV-A" : "Í≥µÍ≤©Î†• Ïó∞Íµ¨",
          "IV-B" : "Î∞©Ïñ¥Î†• Ïó∞Íµ¨",
          "V" : "Ìó¨Î¶¨Ïò§Ïä§ Î≥ëÏÇ¨",
          "Healing" : "ÏπòÎ£å Ïó∞Íµ¨",
          "Training" : "ÌõàÎ†® Ïó∞Íµ¨",
          "HealingTime" : "Íµ¨Í∏â Ïó∞Íµ¨",
        }[key];

        switch (key) {
          case "II-A":
            if (chkInf.checked) label = "Î∂àÍΩÉ Í≥µÍ≤©";
            else if (chkLan.checked) label = "Î∂àÏùò ÎèåÍ≤©";
            else if (chkMask.checked) label = "ÏàòÏ†ïÏùò ÏãúÏïº";
            break;
          case "II-B":
            if (chkInf.checked) label = "Î∂àÍΩÉ Î∞©Ìå®";
            else if (chkLan.checked) label = "Î∂àÏùò Î∞©Ïñ¥";
            else if (chkMask.checked) label = "ÏàòÏ†ï Í∞ëÏò∑";
            break;
          case "IV-A":
            if (chkInf.checked) label = "Î∂àÍΩÉ ÎèÑÎÅº";
            else if (chkLan.checked) label = "Î∂àÏùò Ï∞Ω";
            else if (chkMask.checked) label = "ÏàòÏ†ï ÌôîÏÇ¥";
            break;
          case "IV-B":
            if (chkInf.checked) label = "Î∂àÍΩÉ ÏàòÌò∏";
            else if (chkLan.checked) label = "Î∂àÏùò ÏàòÌò∏";
            else if (chkMask.checked) label = "ÏàòÏ†ïÏùò Í∞ÄÌò∏";
            break;
          default:
            break;
        }

        return {
          key,
          label,
          max: Math.max(...value.map(v => v.level))
        };
      });
    }

    function createLevelOptions(max) {
      return Array.from({ length: max + 1 }, (_, i) => `<option value="${i}">${i}</option>`).join('');
    }

    function renderResearchCards() {
      const container = document.getElementById("researchGrid");
      container.innerHTML = ""; // Clear previous content
      researchList.forEach(item => {
        const div = document.createElement("div");
        div.innerHTML = `
          <div class="border p-2 rounded bg-purple-50 text-xs">
            <label for="check-${item.key}" class="flex items-center text-sm font-semibold mb-1">
              <input type="checkbox" id="check-${item.key}" class="mr-1 w-4 h-4 ">${item.label}
            </label>
            <div class="flex items-center gap-2 mb-1">
              <label class="text-sm whitespace-nowrap">Current</label>
              <select id="current-${item.key}" class="w-full border rounded py-1 px-2 text-sm">
                ${createLevelOptions(item.max)}
              </select>
            </div>
            <div class="flex items-center gap-2 mb-1">
              <label class="text-sm whitespace-nowrap">Target</label>
              <select id="target-${item.key}" class="w-full border rounded py-1 px-2 text-sm">
                ${createLevelOptions(item.max)}
              </select>
            </div>
          </div>
        `;
        container.appendChild(div);
      });
    }

    function handleCheck(toggleId) {
      const chkInf = document.getElementById("chkInf");
      const chkLan = document.getElementById("chkLan");
      const chkMask = document.getElementById("chkMask");

      if (toggleId === "chkInf" && chkInf.checked) {
        chkLan.checked = false;
        chkMask.checked = false;
      } else if (toggleId === "chkLan" && chkLan.checked) {
        chkInf.checked = false;
        chkMask.checked = false;
      } else if (toggleId === "chkMask" && chkMask.checked) {
        chkInf.checked = false;
        chkLan.checked = false;
      }

      updateResearchList();
      renderResearchCards();
    }

    function calculateResearch() {
      let total = { Í∞ÄÎ£®: 0, Ï≤†Í∞ïÏû¨: 0 };
      let rows = "";

      researchList.forEach(item => {
        const checked = document.getElementById(`check-${item.key}`).checked;
        if (!checked) return;

        const cur = parseInt(document.getElementById(`current-${item.key}`).value);
        const tgt = parseInt(document.getElementById(`target-${item.key}`).value);
        if (cur >= tgt) return;

        const data = researchData[item.key];
        const subtotal = { Í∞ÄÎ£®: 0, Ï≤†Í∞ïÏû¨: 0 };

        for (let i = cur + 1; i <= tgt; i++) {
          const row = data.find(r => r.level === i);
          if (!row) continue;
          subtotal.Í∞ÄÎ£® += row.Í∞ÄÎ£® || 0;
          subtotal.Ï≤†Í∞ïÏû¨ += row.Ï≤†Í∞ïÏû¨ || 0;
        }

        total.Í∞ÄÎ£® += subtotal.Í∞ÄÎ£®;
        total.Ï≤†Í∞ïÏû¨ += subtotal.Ï≤†Í∞ïÏû¨;

        rows += `
          <tr class="text-center">
            <td class="border p-1">${item.label}</td>
            <td class="border p-1">${cur} ‚Üí ${tgt}</td>
            <td class="border p-1">${subtotal.Í∞ÄÎ£®.toLocaleString()}</td>
            <td class="border p-1">${subtotal.Ï≤†Í∞ïÏû¨.toLocaleString()}</td>
          </tr>`;
      });

      const owned = {
        Í∞ÄÎ£®: parseFloat(document.getElementById("own-Í∞ÄÎ£®").value) || 0,
        Ï≤†Í∞ïÏû¨: parseFloat(document.getElementById("own-Ï≤†Í∞ïÏû¨").value) || 0,
      };

      rows += `
        <tr class="text-center font-bold bg-purple-100">
          <td class="border p-1" colspan="2">Total</td>
          <td class="border p-1">${total.Í∞ÄÎ£®.toLocaleString()}</td>
          <td class="border p-1">${total.Ï≤†Í∞ïÏû¨.toLocaleString()}</td>
        </tr>
        <tr class="text-center font-bold bg-orange-50">
          <td class="border p-1" colspan="2">Stock</td>
          <td class="border p-1">${owned.Í∞ÄÎ£®.toLocaleString()}</td>
          <td class="border p-1">${owned.Ï≤†Í∞ïÏû¨.toLocaleString()}</td>
        </tr>
        <tr class="text-center font-bold bg-red-50">
          <td class="border p-1" colspan="2">Required quantity</td>
          <td class="border p-1">${(owned.Í∞ÄÎ£® - total.Í∞ÄÎ£®).toLocaleString()}</td>
          <td class="border p-1">${(owned.Ï≤†Í∞ïÏû¨ - total.Ï≤†Í∞ïÏû¨).toLocaleString()}</td>
        </tr>
      `;

      const resultHTML = `
        <table class="w-full table-auto border text-sm text-center mt-4">
          <thead class="bg-gray-100">
            <tr>
              <th class="border p-1">Ïó∞Íµ¨</th>
              <th class="border p-1">Î†àÎ≤®</th>
              <th class="border p-1">Î∂àÏàòÍ∞ÄÎ£®</th>
              <th class="border p-1">Ï≤†Í∞ïÏû¨</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      `;
      window.parent.postMessage({ type: "RESULT_POPUP", html: resultHTML }, "*");
    }

    // ÏµúÏ¥à Ïã§Ìñâ
    updateResearchList();
    renderResearchCards();
  </script>
  <script>
    document.addEventListener("contextmenu", event => event.preventDefault());
    document.addEventListener("keydown", function (e) {
      if (e.key === "F12" || (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "J")) ||
        (e.ctrlKey && (e.key === "U" || e.key === "S"))) 
      {
        e.preventDefault();
      }
    });
  </script>
</body>
</html>
