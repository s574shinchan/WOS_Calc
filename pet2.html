<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>í« ê³„ì‚°ê¸° Â· Card UI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* âœ… ë‹¤í¬ëª¨ë“œ (ê¸°ì¡´ í´ë˜ìŠ¤ëª… ìœ ì§€) */
    body.dark-mode{ background:#121212; color:#f0f0f0; }
    .dark-mode .border{ border-color:#444 !important; }
    .dark-mode .bg-white{ background:#2c2c2c !important; color:#f0f0f0 !important; }
    .dark-mode .bg-gray-100{ background:#1e1e1e !important; }
    .dark-mode .text-gray-800,.dark-mode .text-gray-700,.dark-mode .text-gray-600{ color:#dddddd !important; }
    .dark-mode .text-blue-700{ color:#66b0ff !important; }
    .dark-mode .text-blue-600{ color:#80caff !important; }
    .dark-mode .text-orange-500{ color:#ffa94d !important; }
    .dark-mode .text-green-600{ color:#79e68c !important; }
    .dark-mode .text-red-500{ color:#ff8080 !important; }
    .dark-mode .text-gray-500{ color:#aaa !important; }
    .dark-mode table{ background:#2c2c2c; color:#f0f0f0; }
    .dark-mode th,.dark-mode td{ border-color:#444 !important; }
    .dark-mode .card{ background:#2b2b2b !important; border-color:#3a3a3a !important; }
    .glass{ backdrop-filter:saturate(180%) blur(6px); }
  </style>
  <script>
    // âœ… ê¸°ì¡´ ë‹¤í¬ëª¨ë“œ ìƒíƒœ ìœ ì§€ ìŠ¤í¬ë¦½íŠ¸ í˜¸í™˜
    window.addEventListener('DOMContentLoaded',()=>{
      if(localStorage.getItem('darkMode')==='true'){ document.body.classList.add('dark-mode'); }
    });
  </script>
</head>
<body class="bg-gray-100 text-sm">
  <!-- Header -->
  <header class="sticky top-0 z-30 bg-white/80 dark:bg-slate-900/80 glass border-b border-slate-200">
    <div class="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <h1 class="text-lg font-semibold">ğŸ¾ í« ê³„ì‚°ê¸° <span class="ml-2 text-xs font-medium px-2 py-0.5 rounded-full bg-pink-100 text-pink-700">Card UI</span></h1>
      </div>
      <label class="inline-flex items-center gap-2 cursor-pointer select-none">
        <span class="text-sm">Dark</span>
        <input id="darkToggle" type="checkbox" class="peer sr-only">
        <span class="h-6 w-11 rounded-full bg-slate-300 peer-checked:bg-pink-500 relative transition">
          <span class="absolute top-0.5 left-0.5 h-5 w-5 rounded-full bg-white shadow transition peer-checked:left-5"></span>
        </span>
      </label>
    </div>
  </header>

  <!-- Main -->
  <main class="mx-auto max-w-7xl p-4 md:p-6 grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6">
    <!-- Card: ì„ íƒ/ê·¸ë¦¬ë“œ -->
    <section class="card bg-white border border-slate-200 rounded-2xl shadow-sm p-4 md:p-6 lg:col-span-2">
      <h2 class="text-base md:text-lg font-semibold mb-1">í« ì„ íƒ</h2>
      <p class="text-gray-600 mb-4">ì²´í¬í•œ í«ë§Œ ê³„ì‚°ë©ë‹ˆë‹¤. ê° í«ì˜ í˜„ì¬/ëª©í‘œ ë ˆë²¨ì„ ì§€ì •í•˜ì„¸ìš”.</p>
      <div id="petGrid" class="grid grid-cols-2 md:grid-cols-3 gap-3"></div>
    </section>

    <!-- Card: ë³´ìœ ì¬ë£Œ & ì•¡ì…˜ -->
    <section class="card bg-white border border-slate-200 rounded-2xl shadow-sm p-4 md:p-6">
      <h2 class="text-base md:text-lg font-semibold mb-3">ë³´ìœ  ì¬ë£Œ</h2>
      <div class="grid grid-cols-2 gap-3">
        <div><label class="block text-sm font-medium">í«ë¨¹ì´</label><input type="number" id="own-í«ë¨¹ì´" class="w-full border rounded-xl px-3 py-2" placeholder="0" min="0" /></div>
        <div><label class="block text-sm font-medium">ì¡°ë ¨ë§¤ë‰´ì–¼</label><input type="number" id="own-ì¡°ë ¨ë§¤ë‰´ì–¼" class="w-full border rounded-xl px-3 py-2" placeholder="0" min="0" /></div>
        <div><label class="block text-sm font-medium">í™œë ¥ì˜ì•½</label><input type="number" id="own-í™œë ¥ì˜ì•½" class="w-full border rounded-xl px-3 py-2" placeholder="0" min="0" /></div>
        <div><label class="block text-sm font-medium">ê°•í™”í˜ˆì²­</label><input type="number" id="own-ê°•í™”í˜ˆì²­" class="w-full border rounded-xl px-3 py-2" placeholder="0" min="0" /></div>
      </div>
      <div class="flex flex-wrap gap-3 mt-4">
        <button id="btnCalc" class="inline-flex items-center gap-2 rounded-xl bg-pink-600 hover:bg-pink-700 text-white px-4 py-2">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 12h16M12 4v16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          ê³„ì‚°í•˜ê¸°
        </button>
        <button id="btnClear" class="inline-flex items-center gap-2 rounded-xl border border-slate-300 px-4 py-2 hover:bg-slate-50">ì´ˆê¸°í™”</button>
      </div>
    </section>

    <!-- Card: ê²°ê³¼ -->
    <section class="card bg-white border border-slate-200 rounded-2xl shadow-sm p-4 md:p-6 lg:col-span-3">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-base md:text-lg font-semibold">ê²°ê³¼</h2>
        <span id="selCount" class="text-xs px-2 py-1 rounded-full bg-slate-100 text-slate-600">ì„ íƒ 0</span>
      </div>
      <div class="overflow-x-auto rounded-xl border border-slate-200">
        <table class="w-full table-auto text-sm text-center">
          <thead class="bg-gray-50">
            <tr>
              <th class="border p-2">ë“±ê¸‰</th>
              <th class="border p-2">ë ˆë²¨</th>
              <th class="border p-2">í«ë¨¹ì´</th>
              <th class="border p-2">ì¡°ë ¨ë§¤ë‰´ì–¼</th>
              <th class="border p-2">í™œë ¥ì˜ì•½</th>
              <th class="border p-2">ê°•í™”í˜ˆì²­</th>
            </tr>
          </thead>
          <tbody id="resultBody"></tbody>
          <tfoot>
            <tr class="font-bold bg-pink-50" id="rowTotal"></tr>
            <tr class="font-bold bg-orange-50" id="rowOwned"></tr>
            <tr class="font-bold bg-red-50" id="rowDef"></tr>
          </tfoot>
        </table>
      </div>
    </section>
  </main>

  <footer class="mx-auto max-w-7xl px-4 pb-8 pt-2 text-center text-xs text-slate-500">
    <p>Â© WOS ê³„ì‚°ê¸° â€” Pet Card UI</p>
  </footer>

  <script>
    // ===== ë‹¤í¬ëª¨ë“œ í† ê¸€ (ê¸°ì¡´ key ìœ ì§€)
    const darkToggle = document.getElementById('darkToggle');
    darkToggle.checked = document.body.classList.contains('dark-mode');
    darkToggle.addEventListener('change', ()=>{
      document.body.classList.toggle('dark-mode', darkToggle.checked);
      localStorage.setItem('darkMode', darkToggle.checked ? 'true' : 'false');
    });

    // ===== ê¸°ì¡´ ë¡œì§ì—ì„œ ê°€ì ¸ì˜¨ ë“±ê¸‰/ë¼ë²¨/ë§µ êµ¬ì¡° ìœ ì§€ =====
    const grades = [
      "ê¸°ê°„í† ","ë§¤ë¨¸ë“œ","í˜¸ë‘ì´","ì½”ë¿”ì†Œ","ê³ ë¦´ë¼","ë™êµ´ì‚¬ì",
      "í‘í‘œë²”","í°ë¿”ì‚¬ìŠ´",
      "í‹°íƒ€ë‹ˆìŠ¤","í…Œì´í¼",
      "ì‚¬í–¥ì†Œ","ë¶ê·¹ëŠ‘ëŒ€",
      "í•˜ì´ì—ë‚˜"
    ];
    const gradeLabels = {
      "ê¸°ê°„í† ":"SSR","ë§¤ë¨¸ë“œ":"SSR","í˜¸ë‘ì´":"SSR","ì½”ë¿”ì†Œ":"SSR","ê³ ë¦´ë¼":"SSR","ë™êµ´ì‚¬ì":"SSR",
      "í‘í‘œë²”":"SR","í°ë¿”ì‚¬ìŠ´":"SR",
      "í‹°íƒ€ë‹ˆìŠ¤":"R","í…Œì´í¼":"R",
      "ì‚¬í–¥ì†Œ":"N","ë¶ê·¹ëŠ‘ëŒ€":"N",
      "í•˜ì´ì—ë‚˜":"UnKnown"
    };
    const petGrid = document.getElementById('petGrid');
    let petDataMap = {};

    // ===== CSV ë¡œë” (ê¸°ì¡´ í•¨ìˆ˜ ìœ ì§€) =====
    async function fetchPetCSV(gradeKey){
      const url = `https://raw.githubusercontent.com/s574shinchan/WOS_Calc/main/data/Pet/Pet_${gradeKey}.csv`;
      const res = await fetch(url);
      const text = await res.text();
      const lines = text.trim().split("
");
      const headers = lines[0].split(",");
      const data = lines.slice(1).map(line=>{
        const values = line.split(",");
        const obj = {}; headers.forEach((h,i)=>obj[h.trim()] = (values[i]?.trim() ?? "0"));
        return obj;
      });
      return data;
    }

    // ===== UI ë¹Œë“œ (ì¹´ë“œ ë‚´ë¶€) â€“ ê¸°ì¡´ ë¡œì§ í˜¸í™˜ =====
    async function loadPetUI(){
      let checkedCount = 0;
      for(const grade of grades){
        const gradeKey = gradeLabels[grade];
        const displayGrade = gradeKey === 'UnKnown' ? 'í•˜ì´ì—ë‚˜' : grade;
        try{
          const data = await fetchPetCSV(gradeKey);
          if(!data || !data.length) continue;
          petDataMap[grade] = data;
          const petNames = [...new Set(data.map(d=>d['ì´ë¦„']))];
          petNames.forEach((petName, index)=>{
            const petId = `${grade}-${index}`;
            const petLevels = data.filter(d=>d['ì´ë¦„']===petName).map(d=>d['ë ˆë²¨']);
            const card = document.createElement('div');
            card.className = 'rounded-2xl border border-slate-200 p-3 bg-white dark:bg-slate-900';
            card.innerHTML = `
              <label class="flex items-center gap-2 text-sm font-semibold mb-2">
                <input type="checkbox" id="pet-check-${petId}" class="w-4 h-4 accent-pink-500" />
                <span>${displayGrade} Â· ${petName}</span>
              </label>
              <div class="grid grid-cols-2 gap-2">
                <label class="text-xs flex items-center gap-2"><span class="w-10 text-right">í˜„ì¬</span>
                  <select id="pet-cur-${petId}" class="w-full border rounded-lg py-1.5 px-2 text-sm">
                    ${petLevels.map(lv=>`<option value="${lv}">${lv}</option>`).join('')}
                  </select>
                </label>
                <label class="text-xs flex items-center gap-2"><span class="w-10 text-right">ëª©í‘œ</span>
                  <select id="pet-tgt-${petId}" class="w-full border rounded-lg py-1.5 px-2 text-sm">
                    ${petLevels.map(lv=>`<option value="${lv}">${lv}</option>`).join('')}
                  </select>
                </label>
              </div>`;
            petGrid.appendChild(card);
            const curSelect = card.querySelector(`#pet-cur-${petId}`);
            const tgtSelect = card.querySelector(`#pet-tgt-${petId}`);
            const chk = card.querySelector(`#pet-check-${petId}`);
            curSelect.addEventListener('change',()=>{ tgtSelect.value = curSelect.value; });
            chk.addEventListener('change',()=>{
              checkedCount += chk.checked ? 1 : -1; if(checkedCount<0) checkedCount=0;
              document.getElementById('selCount').textContent = `ì„ íƒ ${checkedCount}`;
            });
          });
        }catch(e){ console.warn('CSV ë¡œë“œ ì‹¤íŒ¨:', grade, e); }
      }
    }

    // ===== ê³„ì‚° (ê¸°ì¡´ ì•Œê³ ë¦¬ì¦˜ ìœ ì§€, ê²°ê³¼ë¥¼ ì¹´ë“œ í‘œì— ë Œë”) =====
    function calculatePet(){
      let total = { í«ë¨¹ì´:0, ì¡°ë ¨ë§¤ë‰´ì–¼:0, í™œë ¥ì˜ì•½:0, ê°•í™”í˜ˆì²­:0 };
      let rowsHTML = '';

      grades.forEach(grade=>{
        const data = petDataMap[grade]; if(!data) return;
        const petNames = [...new Set(data.map(d=>d['ì´ë¦„']))];
        petNames.forEach((petName,index)=>{
          const petId = `${grade}-${index}`;
          const isChecked = document.getElementById(`pet-check-${petId}`)?.checked; if(!isChecked) return;
          const cur = document.getElementById(`pet-cur-${petId}`).value;
          const tgt = document.getElementById(`pet-tgt-${petId}`).value;
          const filtered = data.filter(d=>d['ì´ë¦„']===petName);
          const levels = filtered.map(d=>d['ë ˆë²¨']);
          const start = levels.indexOf(cur);
          const end   = levels.indexOf(tgt);
          if(start===-1 || end===-1 || start>=end){
            rowsHTML += `<tr><td class="border p-2" colspan="6">âš ï¸ ${grade}(${petName}) ì„ íƒ ì˜¤ë¥˜</td></tr>`; return;
          }
          const sub = { í«ë¨¹ì´:0, ì¡°ë ¨ë§¤ë‰´ì–¼:0, í™œë ¥ì˜ì•½:0, ê°•í™”í˜ˆì²­:0 };
          for(let i=start+1;i<=end;i++){
            sub['í«ë¨¹ì´'] += parseFloat(filtered[i]['í«ë¨¹ì´']||'0');
            sub['ì¡°ë ¨ë§¤ë‰´ì–¼'] += parseFloat(filtered[i]['ì¡°ë ¨ë§¤ë‰´ì–¼']||'0');
            sub['í™œë ¥ì˜ì•½'] += parseFloat(filtered[i]['í™œë ¥ì˜ì•½']||'0');
            sub['ê°•í™”í˜ˆì²­'] += parseFloat(filtered[i]['ê°•í™”í˜ˆì²­']||'0');
          }
          total['í«ë¨¹ì´'] += sub['í«ë¨¹ì´'];
          total['ì¡°ë ¨ë§¤ë‰´ì–¼'] += sub['ì¡°ë ¨ë§¤ë‰´ì–¼'];
          total['í™œë ¥ì˜ì•½'] += sub['í™œë ¥ì˜ì•½'];
          total['ê°•í™”í˜ˆì²­'] += sub['ê°•í™”í˜ˆì²­'];
          rowsHTML += `
            <tr class="text-center">
              <td class="border p-2">${grade}</td>
              <td class="border p-2">${cur} â†’ ${tgt}</td>
              <td class="border p-2">${sub['í«ë¨¹ì´'].toLocaleString()}</td>
              <td class="border p-2">${sub['ì¡°ë ¨ë§¤ë‰´ì–¼'].toLocaleString()}</td>
              <td class="border p-2">${sub['í™œë ¥ì˜ì•½'].toLocaleString()}</td>
              <td class="border p-2">${sub['ê°•í™”í˜ˆì²­'].toLocaleString()}</td>
            </tr>`;
        });
      });

      const own = {
        í«ë¨¹ì´: parseFloat(document.getElementById('own-í«ë¨¹ì´').value)||0,
        ì¡°ë ¨ë§¤ë‰´ì–¼: parseFloat(document.getElementById('own-ì¡°ë ¨ë§¤ë‰´ì–¼').value)||0,
        í™œë ¥ì˜ì•½: parseFloat(document.getElementById('own-í™œë ¥ì˜ì•½').value)||0,
        ê°•í™”í˜ˆì²­: parseFloat(document.getElementById('own-ê°•í™”í˜ˆì²­').value)||0,
      };

      document.getElementById('resultBody').innerHTML = rowsHTML || `<tr><td class='border p-3 text-center' colspan='6'>ì„ íƒëœ í«ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
      const rowTotal = document.getElementById('rowTotal');
      rowTotal.innerHTML = `
        <td class='border p-2' colspan='2'>ì´í•©</td>
        <td class='border p-2'>${total['í«ë¨¹ì´'].toLocaleString()}</td>
        <td class='border p-2'>${total['ì¡°ë ¨ë§¤ë‰´ì–¼'].toLocaleString()}</td>
        <td class='border p-2'>${total['í™œë ¥ì˜ì•½'].toLocaleString()}</td>
        <td class='border p-2'>${total['ê°•í™”í˜ˆì²­'].toLocaleString()}</td>`;
      const rowOwned = document.getElementById('rowOwned');
      rowOwned.innerHTML = `
        <td class='border p-2' colspan='2'>ë³´ìœ ëŸ‰</td>
        <td class='border p-2'>${own['í«ë¨¹ì´'].toLocaleString()}</td>
        <td class='border p-2'>${own['ì¡°ë ¨ë§¤ë‰´ì–¼'].toLocaleString()}</td>
        <td class='border p-2'>${own['í™œë ¥ì˜ì•½'].toLocaleString()}</td>
        <td class='border p-2'>${own['ê°•í™”í˜ˆì²­'].toLocaleString()}</td>`;
      const rowDef = document.getElementById('rowDef');
      rowDef.innerHTML = `
        <td class='border p-2' colspan='2'>ê³¼ë¶€ì¡±</td>
        <td class='border p-2'>${(own['í«ë¨¹ì´']-total['í«ë¨¹ì´']).toLocaleString()}</td>
        <td class='border p-2'>${(own['ì¡°ë ¨ë§¤ë‰´ì–¼']-total['ì¡°ë ¨ë§¤ë‰´ì–¼']).toLocaleString()}</td>
        <td class='border p-2'>${(own['í™œë ¥ì˜ì•½']-total['í™œë ¥ì˜ì•½']).toLocaleString()}</td>
        <td class='border p-2'>${(own['ê°•í™”í˜ˆì²­']-total['ê°•í™”í˜ˆì²­']).toLocaleString()}</td>`;
    }

    document.getElementById('btnCalc').addEventListener('click', calculatePet);
    document.getElementById('btnClear').addEventListener('click', ()=>{
      ['own-í«ë¨¹ì´','own-ì¡°ë ¨ë§¤ë‰´ì–¼','own-í™œë ¥ì˜ì•½','own-ê°•í™”í˜ˆì²­'].forEach(id=>{ const el=document.getElementById(id); if(el) el.value='0'; });
      document.getElementById('resultBody').innerHTML='';
      document.getElementById('rowTotal').innerHTML='';
      document.getElementById('rowOwned').innerHTML='';
      document.getElementById('rowDef').innerHTML='';
      document.getElementById('selCount').textContent = 'ì„ íƒ 0';
      // ì²´í¬ í•´ì œ
      document.querySelectorAll('#petGrid input[type=checkbox]').forEach(ch=>ch.checked=false);
    });

    // ì´ˆê¸° ë¹Œë“œ
    loadPetUI();
  </script>
  <script>
    // F12, Ctrl+Shift+I, Ctrl+U ë“± ë°©ì§€
    document.onkeydown = function (e) {
      if (
        e.keyCode === 123 || // F12
        (e.ctrlKey && e.shiftKey && e.keyCode === 73) || // Ctrl+Shift+I
        (e.ctrlKey && e.shiftKey && e.keyCode === 74) || // Ctrl+Shift+J
        (e.ctrlKey && e.keyCode === 85) // Ctrl+U
      ) {
        e.preventDefault();
        return false;
      }
    };
  
    // ìš°í´ë¦­ ë°©ì§€
    document.addEventListener("contextmenu", (e) => e.preventDefault());
  </script>  
</body>
</html>
